<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>Setting up a Distributed Version of Warp 10 - Warp10 Documentation</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>

  <style>
    body {
      background-color: #eeeeee;
    }
  </style>


  <link rel="stylesheet" href="/assets/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/font-awesome.min.css">
  <link rel="stylesheet" href="/assets/https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />

  <script src="/assets/webcomponents-lite.js"></script>
  <script src="/assets/jquery.js"></script>
  <script src="/assets/bootstrap.js"></script>

  <link rel="import" href="/assets/warp10-components.html">

  <!--
  <script src="http://localhost:8000/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="http://localhost:8000/bower_components/jquery/dist/jquery.js"></script>
  <script src="http://localhost:8000/bower_components/bootstrap/dist/js/bootstrap.js"></script>
  <link   rel="import" href="http://localhost:8000/bower_components/polymer/polymer.html">
  <link   rel="import" href="http://localhost:8000/bower_components/warp10-navbar/warp10-navbar.html">
  <link   rel="import" href="http://localhost:8000/bower_components/warp10-quantum/warp10-conf.html">
  <link   rel="import" href="http://localhost:8000/bower_components/warp10-quantum/warp10-quantum-widget.html">
  -->

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/docs/css/warp10.css">
  <link rel="stylesheet" href="/docs/css/warp10-navbar.css">
  <!-- Pygments Github CSS -->
  <link rel="stylesheet" href="/docs/css/syntax.css">

  <style>
    :host {
      display: block;
    }
    .top-10 { margin-top:10px; }
    h4 {
      font-weight: bold;
    }
    .list-group-item {
      cursor: pointer;
    }
  </style>
</head>

<body>
  
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <!--
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    -->
      <a class="navbar-brand" href="/docs">
        <div class="navbar-id">
          <div class="navbar-id-icon">
            <span id="icon-CityzenData" class="icon-CityzenData"></span>
          </div>
          <div class="navbar-id-name">
            Warp 10
          </div>
        </div>
      </a>
    </div>
    <div class="collapse navbar-nav navbar-collapse navbar-right">
      <div class="form-inline">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></div>
          <input id="search_box" class="form-control" style="vertical-align: middle" >
        </div>
      </div>
    </div>
  </div>
</nav>
<div class="navbar-separator" > </div>

<warp10-conf conf="doc"></warp10-conf>

<div id="mainbody">

  <div class="container top-10" id="main-container">
    <div class="row">
      <button type="button" class="navbar-toggle toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false">
  <span class="sr-only">Toggle navigation</span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
</button>
<div id="sidebar" class="col-sm-3 collapse">

  <div class="panel-group" id="side-menu">

    <div id="panel-home" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-home">
        <span class="glyphicon glyphicon-home"></span>Home</a>
    </h4>
  </div>
  <div id="collapse-home" class="panel-collapse collapse ">
    <div class="list-group">

      <a class="list-group-item" href="/docs/introduction/platform">Overview</a>

      <a class="list-group-item" href="/docs/introduction/concepts">Concepts</a>

      <a class="list-group-item" href="/docs/introduction/history">History</a>

      <a class="list-group-item" href="/docs/introduction/team">Team</a>

      <a class="list-group-item" href="/docs/introduction/versions">Versions</a>

    </div>

  </div>
</div>


    <div id="panel-howto" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-howto">
        <span class="glyphicon glyphicon-education"></span>How-to
      </a>
    </h4>
  </div>
  <div id="collapse-howto" class="panel-collapse collapse  in ">
    <div class="list-group">

      <a class="list-group-item" href="/docs/getting-started">Getting started</a>

      <a class="list-group-item" href="/docs/howto/data-modeling">Data modeling</a>

      <a class="list-group-item" href="/docs/howto/migrate-from">Migrate from</a>
      <div class="list-group-item">Tutorials</div>
      <div class="list-group">
        <a class="list-group-item" href="/docs/howto/intro-bucketize">BUCKETIZE</a>
        <a class="list-group-item" href="/docs/howto/intro-reduce">REDUCE</a>
      </div>

      <a class="list-group-item" href="/docs/howto/pushing-data">Pushing data</a>
      <div class="list-group">
        <a class="list-group-item" href="/docs/howto/websocket-push">Using WebSockets</a>
        <a class="list-group-item" href="/docs/howto/collecting-tools">Using metrics collecting tools</a>
      </div>

      <a class="list-group-item" href="/docs/howto/accessing-data">Accessing data</a>

      <a class="list-group-item" href="/docs/howto/fetching-data">Fetching data</a>

      <a class="list-group-item" href="/docs/howto/create-a-udf">Create and deploy one User Defined Function</a>
      
      <a class="list-group-item" href="/docs/howto/create-a-warpscript-extension">Create a WarpScript extension</a>

      <a class="list-group-item" href="/docs/howto/connect-zeppelin">Connect Warp&nbsp;10 to Apache Zeppelin</a>


      <a class="list-group-item" href="/howto/monitoring-warp-10-using-warp-10">Monitoring Warp&nbsp;10</a>
    </div>

  </div>
</div>


    <div id="panel-tutorial" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-apis">
        <span class="glyphicon glyphicon-tasks"></span>APIs
      </a>
    </h4>
  </div>
  <div id="collapse-apis" class="panel-collapse collapse ">
    <div class="list-group">
      <a class="list-group-item" href="/docs/apis/">Overview</a>

      <a class="list-group-item" href="/docs/apis/warpscript">WarpScript</a>

      <a class="list-group-item" href="/docs/apis/fetch">Fetch</a>

      <a class="list-group-item" href="/docs/apis/ingress">Ingress</a>

      <a class="list-group-item" href="/docs/apis/delete">Delete</a>

      <a class="list-group-item" href="/docs/apis/gts-input-format">GTS input format</a>

      <a class="list-group-item" href="/docs/apis/gts-output-format">GTS output format</a>

    </div>

  </div>
</div>


    <div id="panel-reference" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-reference">
        <span class="glyphicon glyphicon-cog"></span>WarpScript</a>
    </h4>
  </div>
  <div id="collapse-reference" class="panel-collapse collapse ">
    <div class="list-group">
      <a class="list-group-item" href="/docs/reference/">Overview</a>

      <div class="list-group-item">
        <a href="/docs/reference/reference">Reference</a>
      </div>
      <div class="list-group" id="collapse-reference-list">
        <a class="list-group-item" href="/docs/reference/reference#frameworks">Frameworks</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-constant">Constant</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-math">Mathematical</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-standalone">Standalone</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-lists-maps">Lists &amp; maps</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-logic">Logic</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-stack">Stack</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-platform">Platform</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-gts">Geo Time Series<sup>Â®</sup></a>
        <a class="list-group-item" href="/docs/reference/reference#functions-bucketized-gts">Bucketized GTS</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-geo">Geo-related</a>
      </div>
      <a class="list-group-item" href="/docs/reference/miscellaneous">Miscellaneous functions</a>
      <a class="list-group-item" href="/docs/reference/processing">Working with Processing</a>
    </div>
  </div>
</div>


    <div id="panel-tools" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-tools">
        <span class="glyphicon glyphicon-wrench"></span>Tools</a>
    </h4>
  </div>
  <div id="collapse-tools" class="panel-collapse collapse ">
    <div class="list-group">
      <div class="list-group-item">
        <a href="/tools/github_repositories">Github repositories</a>
      </div>
      <div class="list-group" id="collapse-git-list">
        <a class="list-group-item" href="/tools/github_repositories#Platform">Platform</a>
        <a class="list-group-item" href="/tools/github_repositories#Batch">Batch</a>
        <a class="list-group-item" href="/tools/github_repositories#Stream">Stream</a>
        <a class="list-group-item" href="/tools/github_repositories#Inputs">Input plugins</a>
        <a class="list-group-item" href="/tools/github_repositories#Outputs">Output plugins</a>
        <a class="list-group-item" href="/tools/github_repositories#Interpreters">Interpreters</a>
        <a class="list-group-item" href="/tools/github_repositories#IoT">IoT</a>
        <a class="list-group-item" href="/tools/github_repositories#UDFs">WarpScript UDFs</a>
        <a class="list-group-item" href="/tools/github_repositories#Extensions">WarpScript extensions</a>
        <a class="list-group-item" href="/tools/github_repositories#Websites">Websites</a>
        <a class="list-group-item" href="/tools/github_repositories#External">External contributions</a>
      </div>
      <a class="list-group-item" href="/docs/tools/worf">Worf</a>
      <a class="list-group-item" href="/docs/tools/quantum">Quantum</a>
      <a class="list-group-item" href="/docs/tools/trl">Token Revocation List</a>

    </div>

  </div>
</div>


    <div id="panel-support" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a href="/docs/introduction/support/">
        <span class="glyphicon glyphicon-ok-circle"></span>Support
      </a>
    </h4>
  </div>
</div>



  </div>

</div>

      <div class="col-sm-9">
        <h1>Setting up a Distributed Version of Warp 10</h1>
        <p>By carefully following the instructions on this page you should have a working Warp 10 distributed platform in no time.</p>

<p>A Warp 10 distributed platform is called a <em>cell</em>, throughout this guide we will consider that your cell is named <code>prod</code>.</p>

<h1 id="configuring-zookeeper">Configuring ZooKeeper</h1>

<p>We highly recommend you use a single ZooKeeper ensemble for Kafka, Hadoop, HBase and Warp 10, this makes the ops side of things simpler.</p>

<p>Our best practice is also to isolate the various znodes hierarchies under dedicated root znodes.</p>

<p>Here are the <code>znodes</code> you should create in your ZooKeeper:</p>

<pre><code>/zk

/zk/kafka
/zk/kafka/prod

/zk/warp
/zk/warp/prod
/zk/warp/prod/services
/zk/warp/prod/plasma

/zk/hbase
/zk/hbase/prod
</code></pre>

<p>We add a <code>/zk</code> prefix to all znodes so we recognize a znode path when we see one.</p>

<p>We assume no authentication is performed by Warp 10, HBase or Kafka when connecting to ZooKeeper, so everyone should be able to write to the above znodes.</p>

<h1 id="configuring-kafka">Configuring Kafka</h1>

<p>Warp 10 relies on several Kafka topics to exchange messages between its various components.</p>

<p>Remember that the parallelism unit when consuming Kafka topics is the partition so adjust the number of partitions of the various topics so you achieve the expected parallelism (based on thread count configured) in your consumers.</p>

<p>The Kafka producers ensure that messages for a given Geo Time Series are always sent to the same partition.</p>

<p>A Kafka topic is created using the <code>kafka-topics.sh</code> tool provided by Kafka.</p>

<h2 id="metadata-topic"><code>metadata</code> topic</h2>

<p>This topic is populated by <code>ingress</code> whenever new Geo Time Series are encountered, when their attributes are modified or when a complete GTS is deleted. It is consumed by <code>directory</code> to update the GTS register and by <code>ingress</code> to update their GTS cache.</p>

<p>This topic must be consumed using a dedicated <code>groupid</code> per <code>ingress</code> and per <code>directory</code>.</p>

<h2 id="data-topic"><code>data</code> topic</h2>

<p>This topic is populated by <code>ingress</code> when new data is pushed for a Geo Time Series or when a deletion request is made. This serialization of updates and deletes in the same topic (and same partition for a given GTS) is there to ensure the order of those operations.</p>

<p>The <code>data</code> topic is consumed by <code>store</code> which persists the updates in HBase and performs calls to the <code>BulkDeleteEndpoint</code> for deletes. The data is also consumed by <code>plasmaBE</code>.</p>

<p>The <code>groupid</code> used to consume this topic is common to all <code>store</code> instances. The <code>plasmaBE</code> instances also share a common <code>groupid</code>.</p>

<h2 id="throttling-topic"><code>throttling</code> topic</h2>

<p>This topic is populated and consumed by <code>ingress</code>, it conveys estimators of updated Geo Time Series so the throttling mechanism on all <code>ingress</code> sees a converged view of the active data streams. This topic is consumed using a dedicated <code>groupid</code> per <code>ingress</code>.</p>

<h2 id="webcall-topic"><code>webcall</code> topic</h2>

<p>This topic is used by <code>egress</code> whenever the <code>WEBCALL</code> function is called to push a request which will be handled by an instance of <code>webcall</code>. It must be consumed using a single <code>groupid</code> among all <code>webcall</code> instances.</p>

<h2 id="runner-topic"><code>runner</code> topic</h2>

<p>This topic is used by <code>runner</code> instances to push script execution requests. It is consumed by <code>worker</code> instances which should all use an identical <code>groupid</code>.</p>

<h2 id="plasmafexx-topics"><code>plasmafeXX</code> topics</h2>

<p>There is one such topic defined per <code>plasmaFE</code> instance. These topics are used by <code>plasmaBE</code> instances to push the data to which clients subscribed. Each topic is consumed by a single <code>plasmaFE</code> instance.</p>

<h1 id="configuring-hbase">Configuring HBase</h1>

<p>A Warp 10 instance uses a single table for storing both metadata and datapoints. This table is created using the HBase shell command in file <a href="https://github.com/cityzendata/warp10-platform/blob/master/etc/continuum.hbase">continuum.hbase</a>.</p>

<h1 id="deploying-warp-10">Deploying Warp 10</h1>

<p>Warp 10 is configured using a single configuration file which defines properties. The <a href="https://github.com/cityzendata/warp10-platform/blob/master/etc/conf-distributed.template">template config file</a> is extensively commented and we invite you to carefully read all those comments when configuring a given component.</p>

<p>Warp 10 makes a heavy use of cryptographic hash functions and encryption and relies on a set of keys being defined in the configuration, these keys are mandatory and cannot be changed once they have been used. Treat those keys as you would your most precious secrets.</p>

<p>Once your keys are set you can generate write and read tokens using the <a href="/docs/tools/worf">Worf</a> tool. Generate a pair of such tokens now as you will need them to test the Warp 10 components later.</p>

<p>The components should be deployed in the order specified below. Note that <code>plasma</code> is optional, only deploy it if you want to support the streaming (WebSocket) endpoints.</p>

<p>An instance of Warp 10 can run multiple components, refer to the resources each component requires when selecting which ones to run together.</p>

<p>As a best practice, <code>egress</code>, <code>directory</code>, <code>store</code> and <code>ingress</code> should be run in their own JVM. <code>webcall</code> and <code>runner</code> can be colocated with <code>egress</code>.</p>

<p>A Warp 10 instance is started using</p>

<pre><code>java ${JAVA_OPTS} -cp warp10-x.y.z.jar io.warp10.WarpDist path/to/warp.config
</code></pre>

<h2 id="deploying-ingress">Deploying ingress</h2>

<p><code>ingress</code> is CPU and network bound and in a lesser way also memory bound (depending on the size of the cache you have configured).</p>

<p>Once <code>ingress</code> is deployed and started it will listen on port <em>8882</em>. You can push test data to <code>ingress</code> using:</p>

<pre><code>curl -H 'X-Warp10-Token: WRITE_TOKEN' --data-binary '// test{} T' http://host:8882/api/v0/update
</code></pre>

<p>By checking the <code>metadata</code> and <code>data</code> topics in Kafka, you should see that one message arrived in each of those topics. If this is the case, then your <code>ingress</code> deployment is a success.</p>

<h2 id="deploying-directory">Deploying directory</h2>

<p><code>directory</code> is memory bound.</p>

<p>When <code>directory</code> is started, it should read metadatas in HBase and populate its Geo Time Series registry, then it will consume the <code>metadata</code> topic and update its registry accordingly.</p>

<p>If you check Kafka, you should see that the message you identified above has been consumed using the <code>groupid</code> of your <code>directory</code>. You can also scan the table in HBase for the <code>m</code> column family, it should have an entry.</p>

<h2 id="deploying-store">Deploying store</h2>

<p><code>store</code> is CPU and network bound.</p>

<p>Once started, <code>store</code> will consume the <code>data</code> topic and populate HBase or proceed with deletions. Check Kafka and confirm that the <code>data</code> topic is being consumed. You can also scan the <code>v</code> column family in the HBase table to confirm there is an entry.</p>

<h2 id="deploying-egress">Deploying egress</h2>

<p><code>egress</code> is memory and network bound.</p>

<p>Once started, <code>egress</code> will listen on port <em>8881</em> for incoming requests. You can check that your <code>egress</code> instance is working by running the following command:</p>

<pre><code>curl --data-binary "[ 'READ_TOKEN' 'test' {} NOW -1 ] FETCH" http://host:8881/api/v0/exec
</code></pre>

<p>which should return a Geo Time Series object with a single datapoint.</p>

<p>Congratulations, you now have a working Warp 10 distributed platform!</p>

<h2 id="deploying-webcall">Deploying webcall</h2>

<p><code>webcall</code> does not consume any particular resources, it must have access to the sites allowed in <code>WEBCALL</code> calls.</p>

<p>Check that the <code>webcall</code> topic is indeed consumed after issueing a <a href="http://www.warp10.io/reference/functions/function_WEBCALL">WEBCALL</a> call to <code>egress</code>.</p>

<h2 id="deploying-plasma">Deploying Plasma</h2>

<p><code>plasmaBE</code> is network bound as it consumes the whole <code>data</code> topic. <code>plasmaFE</code> may become network bound if many subscriptions are done.</p>

<p><code>PlasmaFE</code> listens on port <em>8884</em>.</p>

<p>You can test <code>plasma</code> by using this <a href="https://github.com/cityzendata/warp10-platform/blob/master/warp10/src/main/python/plasma-pull.py">Python script</a> and pushing data to <code>ingress</code>.</p>

<h2 id="deploying-runner">Deploying runner</h2>

<p>The <code>runner</code> component can be configured to assume one of several roles. In the <code>standalone</code> role, the <code>runner</code> instance will schedule the scripts and will submit them to the configured <code>egress</code> endpoint. In the <code>scheduler</code> role, <code>runner</code> will schedule the scripts and push execution requests into the <code>runner</code> Kafka topic. And last, in the <code>worker</code> role, <code>runner</code> consumes the <code>runner</code> Kafka topic and executes the requests on the configured <code>egress</code>.</p>

<p>To test <code>runner</code>, deploy a script in a subdirectory of the configured script directory in a sub-sub directory with the expected script periodicity, <em>i.e.</em></p>

<pre><code>testing/60000/foo.mc2
</code></pre>

<p>for a script which should be executed every 60s.</p>

<h2 id="deploying-fetcher">Deploying fetcher</h2>

<p><code>fetcher</code> is network bound.</p>

<p>Testing <code>fetcher</code> is out of scope of this guide, please refer to the warp10-pig tutorial for more infos.</p>

      </div>
    </div>
  </div>
  

<!-- Footer -->
<footer>

  <hr>

  <div id="contact" class="container text-center">
    <!-- Footer -->
    <a class="webicons" href="https://twitter.com/CityzenData" target="_blank">
      <footer>
        <div id="contact" class="container text-center">
      <div class="webicon twitter"></div>
      <div class="webicon_text twitter">@CityzenData</div>
    </a>
    <a class="webicons" href="mailto:contact@cityzendata.com" target="_blank">
      <div class="webicon mail"></div>
      <div class="webicon_text mail">contact@cityzendata.com</div>
    </a>
  </div>

  <div class="container text-center top-margin">
    Copyright &copy; 2016 Cityzen Data
  </div>
  <div class="container text-center">
    <a href="/docs/introduction/legal">Legal</a>
  </div>

</footer>

<script>
    var template = document.querySelector('template[is="dom-bind"]');
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: 'e3f0d4e7cfac4e1065a92f60b3ec28d1',
indexName: 'warp10',
inputSelector: '#search_box'
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43780642-5', 'auto');
  ga('send', 'pageview');

</script>

<!-- Start of Async Drift Code -->
<script>
!function() {
  var t;
  if (t = window.driftt = window.drift = window.driftt || [], !t.init) return t.invoked ? void (window.console && console.error && console.error("Drift snippet included twice.")) : (t.invoked = !0, 
  t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
  t.factory = function(e) {
    return function() {
      var n;
      return n = Array.prototype.slice.call(arguments), n.unshift(e), t.push(n), t;
    };
  }, t.methods.forEach(function(e) {
    t[e] = t.factory(e);
  }), t.load = function(t) {
    var e, n, o, i;
    e = 3e5, i = Math.ceil(new Date() / e) * e, o = document.createElement("script"), 
    o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + i + "/" + t + ".js", 
    n = document.getElementsByTagName("script")[0], n.parentNode.insertBefore(o, n);
  });
}();
drift.SNIPPET_VERSION = '0.3.1';
drift.load('pf9x6nb43t24');
</script>
<!-- End of Async Drift Code -->
</body>
</html>
