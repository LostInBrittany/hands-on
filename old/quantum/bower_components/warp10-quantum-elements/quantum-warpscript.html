<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="granite-file-reader" assetpath="../granite-file-reader/"><template><style>:host{display:block;cursor:pointer;}[hidden]{display:none;}</style><slot></slot><input id="fileInput" on-change="_onChange" type="file" accept="{{accept}}" multiple="[[multiple]]" hidden=""></template><script>Polymer({is:'granite-file-reader',properties:{accept:{type:String,value:null},readAs:{type:String,value:'text'},multiple:{type:Boolean,value:!1},debug:{type:Boolean,value:!1}},listeners:{tap:'_onTap'},_onTap:function(a){if(this.debug&&(console.log('[granite-file-reader] _onTap',a.target.localName),console.dir(a)),'granite-file-reader'!=a.target.localName&&'fileInput'!=a.target.id){var b=this.$.fileInput;if(b&&document.createEvent){let a=document.createEvent('MouseEvents');a.initEvent('click',!0,!1),this.debug&&console.log('[granite-file-reader] _onTap - dispatch'),b.dispatchEvent(a)}}},_onChange:function(){if(this.$.fileInput.files){this.debug&&console.log('[granite-file-reader] _onChange',this.$.fileInput.files);for(const a of this.$.fileInput.files){this.debug&&console.log('[granite-file-reader] _onChange',a);let b=new FileReader;switch(b.onloadstart=(a)=>{this.debug&&console.log('[granite-file-reader] firing `load-start` event'),this.fire('load-start',a.target.result)},b.onloadend=(a)=>{this.debug&&console.log('[granite-file-reader] firing `load-end` event'),this.fire('load-end',a.target.result)},b.onerror=(a)=>{this.debug&&console.log('[granite-file-reader] firing `error` event'),this.fire('error',a.target.result),this.clearInput()},b.abort=(a)=>{this.debug&&console.log('[granite-file-reader] firing `abort` event'),this.fire('error',a.target.result),this.clearInput()},b.onload=(a)=>{this.debug&&console.log('[granite-file-reader] firing `load` event',a.target.result),this.fire('file-read',a.target.result),this.fire('load',a.target.result),this.clearInput()},this.readAs){case'binary':b.readAsBinaryString(a);break;case'ArrayBuffer':b.readAsArrayBuffer(a);break;case'dataURL':b.readAsDataURL(a);break;case'text':default:b.readAsText(a);}}}},clearInput:function(){this.debounce('clearInput',()=>{this.$.fileInput.value=''},10)}});</script></dom-module><dom-module id="granite-file-saver" assetpath="../granite-file-saver/"><template><style>:host{display:block;cursor:pointer;}[hidden]{display:none;}</style><slot></slot><a id="hiddenSaver" href$="[[_file]]" download="{{_filename}}" hidden=""></a></template><script>Polymer({is:"granite-file-saver",properties:{payload:{type:Array,value:function(){return[]}},text:{type:String,value:null},mimeType:{type:String,value:"plain/text"},filename:{type:String,value:""},_file:{type:Object,value:null},_filename:{type:String,value:"warpscript.mc2"}},listeners:{tap:"_onTap"},_onTap:function(a){a.stopPropagation();var b;b=this.text?[this.text]:this.payload,this._filename=this.filename?this.filename:"file-"+Date.now().toString();var c=new Blob(b,{type:this.mimeType});null!==this._file&&window.URL.revokeObjectURL(this._file),this._file=window.URL.createObjectURL(c);var d=new MouseEvent("click");this.$.hiddenSaver.dispatchEvent(d)}});</script></dom-module><script type="text/javascript">var module,window,define,renderjson=function(){function a(b,j,k,l,m){var n=k?"":j,o=function(a,b,f,j,k){var o,p=h(j),q=function(){o||d(p.parentNode,o=e(k(),i(m.hide,"disclosure",function(){o.style.display="none",p.style.display="inline"}))),o.style.display="inline",p.style.display="none"};d(p,i(m.show,"disclosure",q),c(j+" syntax",a),i(b,null,q),c(j+" syntax",f));var r=d(h(),g(n.slice(0,-1)),p);return 0<l&&"string"!=j&&q(),r};return null===b?c(null,n,"keyword","null"):void 0===b?c(null,n,"keyword","undefined"):"string"==typeof b&&b.length>m.max_string_length?o("\"",b.substr(0,m.max_string_length)+" ...","\"","string",function(){return d(h("string"),c(null,n,"string",JSON.stringify(b)))}):"object"!=typeof b||0<=[Number,String,Boolean,Date].indexOf(b.constructor)?c(null,n,typeof b,JSON.stringify(b)):b.constructor==Array?0==b.length?c(null,n,"array syntax","[]"):o("["," ... ","]","array",function(){for(var e=d(h("array"),c("array syntax","[",null,"\n")),f=0;f<b.length;f++)d(e,a(m.replacer.call(b,f,b[f]),j+"    ",!1,l-1,m),f==b.length-1?[]:c("syntax",","),g("\n"));return d(e,c(null,j,"array syntax","]")),e}):f(b,m.property_list)?c(null,n,"object syntax","{}"):o("{","...","}","object",function(){var e=d(h("object"),c("object syntax","{",null,"\n"));for(var f in b)var k=f;var n=m.property_list||Object.keys(b);for(var o in m.sort_objects&&(n=n.sort()),n){var f=n[o];f in b&&d(e,c(null,j+"    ","key","\""+f+"\"","object syntax",": "),a(m.replacer.call(b,f,b[f]),j+"    ",!0,l-1,m),f==k?[]:c("syntax",","),g("\n"))}return d(e,c(null,j,"object syntax","}")),e})}var b=Number.MAX_VALUE,c=function(){for(var a=[];arguments.length;)a.push(d(h(Array.prototype.shift.call(arguments)),g(Array.prototype.shift.call(arguments))));return a},d=function(){for(var b=Array.prototype.shift.call(arguments),c=0;c<arguments.length;c++)arguments[c].constructor==Array?d.apply(this,[b].concat(arguments[c])):b.appendChild(arguments[c]);return b},e=function(a,b){return a.insertBefore(b,a.firstChild),a},f=function(a,b){var c=b||Object.keys(a);for(var d in c)if(Object.hasOwnProperty.call(a,c[d]))return!1;return!0},g=function(a){return document.createTextNode(a)},h=function(a){var b=document.createElement("span");return a&&(b.className=a),b},i=function(b,c,d){var e=document.createElement("a");return c&&(e.className=c),e.appendChild(g(b)),e.href="#",e.onclick=function(a){return d(),a&&a.stopPropagation(),!1},e},j=function b(c){var e=Object.assign({},b.options);e.replacer="function"==typeof e.replacer?e.replacer:function(a,b){return b};var f=d(document.createElement("pre"),a(c,"",!1,e.show_to_level,e));return f.className="renderjson",f};return j.set_icons=function(a,b){return j.options.show=a,j.options.hide=b,j},j.set_show_to_level=function(a){return j.options.show_to_level="string"==typeof a&&"all"===a.toLowerCase()?b:a,j},j.set_max_string_length=function(a){return j.options.max_string_length="string"==typeof a&&"none"===a.toLowerCase()?b:a,j},j.set_sort_objects=function(a){return j.options.sort_objects=a,j},j.set_replacer=function(a){return j.options.replacer=a,j},j.set_property_list=function(a){return j.options.property_list=a,j},j.set_show_by_default=function(a){return j.options.show_to_level=a?b:0,j},j.options={},j.set_icons("\u2295","\u2296"),j.set_show_by_default(!1),j.set_sort_objects(!1),j.set_max_string_length("none"),j.set_replacer(void 0),j.set_property_list(void 0),j}();define?define({renderjson:renderjson}):(module||{}).exports=(window||{}).renderjson=renderjson;</script><dom-module id="paper-tab" assetpath="../paper-tabs/"><template><style>:host{@apply --layout-inline;@apply --layout-center;@apply --layout-center-justified;@apply --layout-flex-auto;position:relative;padding:0 12px;overflow:hidden;cursor:pointer;vertical-align:middle;@apply --paper-font-common-base;@apply --paper-tab;}:host(:focus){outline:none;}:host([link]){padding:0;}.tab-content{height:100%;transform:translateZ(0);-webkit-transform:translateZ(0);transition:opacity 0.1s cubic-bezier(0.4, 0.0, 1, 1);@apply --layout-horizontal;@apply --layout-center-center;@apply --layout-flex-auto;@apply --paper-tab-content;}:host(:not(.iron-selected)) > .tab-content{opacity:0.8;@apply --paper-tab-content-unselected;}:host(:focus) .tab-content{opacity:1;font-weight:700;}paper-ripple{color:var(--paper-tab-ink, var(--paper-yellow-a100));}.tab-content > ::slotted(a){@apply --layout-flex-auto;height:100%;}</style><div class="tab-content"><slot></slot></div></template><script>Polymer({is:'paper-tab',behaviors:[Polymer.IronControlState,Polymer.IronButtonState,Polymer.PaperRippleBehavior],properties:{link:{type:Boolean,value:!1,reflectToAttribute:!0}},hostAttributes:{role:'tab'},listeners:{down:'_updateNoink',tap:'_onTap'},attached:function(){this._updateNoink()},get _parentNoink(){var a=Polymer.dom(this).parentNode;return!!a&&!!a.noink},_updateNoink:function(){this.noink=!!this.noink||!!this._parentNoink},_onTap:function(a){if(this.link){var b=this.queryEffectiveChildren('a');if(!b)return;if(a.target===b)return;b.click()}}});</script></dom-module><iron-iconset-svg name="paper-tabs" size="24"><svg><defs><g id="chevron-left"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></g><g id="chevron-right"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></g></defs></svg></iron-iconset-svg><dom-module id="paper-tabs" assetpath="../paper-tabs/"><template><style>:host{@apply --layout;@apply --layout-center;height:48px;font-size:14px;font-weight:500;overflow:hidden;-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);-webkit-tap-highlight-color:transparent;@apply --paper-tabs;}:host(:dir(rtl)){@apply --layout-horizontal-reverse;}#tabsContainer{position:relative;height:100%;white-space:nowrap;overflow:hidden;@apply --layout-flex-auto;@apply --paper-tabs-container;}#tabsContent{height:100%;-moz-flex-basis:auto;-ms-flex-basis:auto;flex-basis:auto;@apply --paper-tabs-content;}#tabsContent.scrollable{position:absolute;white-space:nowrap;}#tabsContent:not(.scrollable),
      #tabsContent.scrollable.fit-container{@apply --layout-horizontal;}#tabsContent.scrollable.fit-container{min-width:100%;}#tabsContent.scrollable.fit-container > ::slotted(*){-ms-flex:1 0 auto;-webkit-flex:1 0 auto;flex:1 0 auto;}.hidden{display:none;}.not-visible{opacity:0;cursor:default;}paper-icon-button{width:48px;height:48px;padding:12px;margin:0 4px;}#selectionBar{position:absolute;height:0;bottom:0;left:0;right:0;border-bottom:2px solid var(--paper-tabs-selection-bar-color, var(--paper-yellow-a100));-webkit-transform:scale(0);transform:scale(0);-webkit-transform-origin:left center;transform-origin:left center;transition:-webkit-transform;transition:transform;@apply --paper-tabs-selection-bar;}#selectionBar.align-bottom{top:0;bottom:auto;}#selectionBar.expand{transition-duration:0.15s;transition-timing-function:cubic-bezier(0.4, 0.0, 1, 1);}#selectionBar.contract{transition-duration:0.18s;transition-timing-function:cubic-bezier(0.0, 0.0, 0.2, 1);}#tabsContent > ::slotted(:not(#selectionBar)){height:100%;}</style><paper-icon-button icon="paper-tabs:chevron-left" class$="[[_computeScrollButtonClass(_leftHidden, scrollable, hideScrollButtons)]]" on-up="_onScrollButtonUp" on-down="_onLeftScrollButtonDown" tabindex="-1"></paper-icon-button><div id="tabsContainer" on-track="_scroll" on-down="_down"><div id="tabsContent" class$="[[_computeTabsContentClass(scrollable, fitContainer)]]"><div id="selectionBar" class$="[[_computeSelectionBarClass(noBar, alignBottom)]]" on-transitionend="_onBarTransitionEnd"></div><slot></slot></div></div><paper-icon-button icon="paper-tabs:chevron-right" class$="[[_computeScrollButtonClass(_rightHidden, scrollable, hideScrollButtons)]]" on-up="_onScrollButtonUp" on-down="_onRightScrollButtonDown" tabindex="-1"></paper-icon-button></template><script>Polymer({is:'paper-tabs',behaviors:[Polymer.IronResizableBehavior,Polymer.IronMenubarBehavior],properties:{noink:{type:Boolean,value:!1,observer:'_noinkChanged'},noBar:{type:Boolean,value:!1},noSlide:{type:Boolean,value:!1},scrollable:{type:Boolean,value:!1},fitContainer:{type:Boolean,value:!1},disableDrag:{type:Boolean,value:!1},hideScrollButtons:{type:Boolean,value:!1},alignBottom:{type:Boolean,value:!1},selectable:{type:String,value:'paper-tab'},autoselect:{type:Boolean,value:!1},autoselectDelay:{type:Number,value:0},_step:{type:Number,value:10},_holdDelay:{type:Number,value:1},_leftHidden:{type:Boolean,value:!1},_rightHidden:{type:Boolean,value:!1},_previousTab:{type:Object}},hostAttributes:{role:'tablist'},listeners:{"iron-resize":'_onTabSizingChanged',"iron-items-changed":'_onTabSizingChanged',"iron-select":'_onIronSelect',"iron-deselect":'_onIronDeselect'},keyBindings:{"left:keyup right:keyup":'_onArrowKeyup'},created:function(){this._holdJob=null,this._pendingActivationItem=void 0,this._pendingActivationTimeout=void 0,this._bindDelayedActivationHandler=this._delayedActivationHandler.bind(this),this.addEventListener('blur',this._onBlurCapture.bind(this),!0)},ready:function(){this.setScrollDirection('y',this.$.tabsContainer)},detached:function(){this._cancelPendingActivation()},_noinkChanged:function(a){var b=Polymer.dom(this).querySelectorAll('paper-tab');b.forEach(a?this._setNoinkAttribute:this._removeNoinkAttribute)},_setNoinkAttribute:function(a){a.setAttribute('noink','')},_removeNoinkAttribute:function(a){a.removeAttribute('noink')},_computeScrollButtonClass:function(a,b,c){return!b||c?'hidden':a?'not-visible':''},_computeTabsContentClass:function(a,b){return a?'scrollable'+(b?' fit-container':''):' fit-container'},_computeSelectionBarClass:function(a,b){if(a)return'hidden';return b?'align-bottom':''},_onTabSizingChanged:function(){this.debounce('_onTabSizingChanged',function(){this._scroll(),this._tabChanged(this.selectedItem)},10)},_onIronSelect:function(a){this._tabChanged(a.detail.item,this._previousTab),this._previousTab=a.detail.item,this.cancelDebouncer('tab-changed')},_onIronDeselect:function(){this.debounce('tab-changed',function(){this._tabChanged(null,this._previousTab),this._previousTab=null},1)},_activateHandler:function(){this._cancelPendingActivation(),Polymer.IronMenuBehaviorImpl._activateHandler.apply(this,arguments)},_scheduleActivation:function(a,b){this._pendingActivationItem=a,this._pendingActivationTimeout=this.async(this._bindDelayedActivationHandler,b)},_delayedActivationHandler:function(){var a=this._pendingActivationItem;this._pendingActivationItem=void 0,this._pendingActivationTimeout=void 0,a.fire(this.activateEvent,null,{bubbles:!0,cancelable:!0})},_cancelPendingActivation:function(){this._pendingActivationTimeout!==void 0&&(this.cancelAsync(this._pendingActivationTimeout),this._pendingActivationItem=void 0,this._pendingActivationTimeout=void 0)},_onArrowKeyup:function(){this.autoselect&&this._scheduleActivation(this.focusedItem,this.autoselectDelay)},_onBlurCapture:function(a){a.target===this._pendingActivationItem&&this._cancelPendingActivation()},get _tabContainerScrollSize(){return Math.max(0,this.$.tabsContainer.scrollWidth-this.$.tabsContainer.offsetWidth)},_scroll:function(a,b){if(this.scrollable){var c=b&&-b.ddx||0;this._affectScroll(c)}},_down:function(){this.async(function(){this._defaultFocusAsync&&(this.cancelAsync(this._defaultFocusAsync),this._defaultFocusAsync=null)},1)},_affectScroll:function(a){this.$.tabsContainer.scrollLeft+=a;var b=this.$.tabsContainer.scrollLeft;this._leftHidden=0===b,this._rightHidden=b===this._tabContainerScrollSize},_onLeftScrollButtonDown:function(){this._scrollToLeft(),this._holdJob=setInterval(this._scrollToLeft.bind(this),this._holdDelay)},_onRightScrollButtonDown:function(){this._scrollToRight(),this._holdJob=setInterval(this._scrollToRight.bind(this),this._holdDelay)},_onScrollButtonUp:function(){clearInterval(this._holdJob),this._holdJob=null},_scrollToLeft:function(){this._affectScroll(-this._step)},_scrollToRight:function(){this._affectScroll(this._step)},_tabChanged:function(a,b){if(!a)return this.$.selectionBar.classList.remove('expand'),this.$.selectionBar.classList.remove('contract'),void this._positionBar(0,0);var c=this.$.tabsContent.getBoundingClientRect(),d=c.width,e=a.getBoundingClientRect(),f=e.left-c.left;if(this._pos={width:this._calcPercent(e.width,d),left:this._calcPercent(f,d)},this.noSlide||null==b)return this.$.selectionBar.classList.remove('expand'),this.$.selectionBar.classList.remove('contract'),void this._positionBar(this._pos.width,this._pos.left);var g=b.getBoundingClientRect(),h=this.items.indexOf(b),i=this.items.indexOf(a),j=5;this.$.selectionBar.classList.add('expand');var k=h<i,l=this._isRTL;l&&(k=!k),k?this._positionBar(this._calcPercent(e.left+e.width-g.left,d)-j,this._left):this._positionBar(this._calcPercent(g.left+g.width-e.left,d)-j,this._calcPercent(f,d)+j),this.scrollable&&this._scrollToSelectedIfNeeded(e.width,f)},_scrollToSelectedIfNeeded:function(a,b){var c=b-this.$.tabsContainer.scrollLeft;0>c?this.$.tabsContainer.scrollLeft+=c:(c+=a-this.$.tabsContainer.offsetWidth,0<c&&(this.$.tabsContainer.scrollLeft+=c))},_calcPercent:function(a,b){return 100*a/b},_positionBar:function(a,b){a=a||0,b=b||0,this._width=a,this._left=b,this.transform('translateX('+b+'%) scaleX('+a/100+')',this.$.selectionBar)},_onBarTransitionEnd:function(){var a=this.$.selectionBar.classList;a.contains('expand')?(a.remove('expand'),a.add('contract'),this._positionBar(this._pos.width,this._pos.left)):a.contains('contract')&&a.remove('contract')}});</script></dom-module><dom-module id="quantum-response-container"><template><style>:host{}.right{float:right;}.response-panel{min-height:20px;padding:19px;margin-bottom:20px;background-color:#002240;border:1px solid #e3e3e3;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05);box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05);}.response-panel div{color:white;}.line{width:100%;font-size:12px;font-family:monospace;}.line-number{float:left;width:30px;text-align:right;color:white;}.line-content-container{float:left;width:100%;margin-left:-30px;}.line-content{margin-left:50px;color:white;word-wrap:break-word;}.clearfix:before, .clearfix:after{content:" ";display:table;}.clearfix:after{clear:both;}.renderjson{font-size:1.2em;}.renderjson .disclosure{font-size:1.2em;color:white;}.renderjson .syntax{color:lightgrey;}.renderjson .string{color:white;}.renderjson .number{color:cornflowerblue;}.renderjson .boolean{color:orangered;}.renderjson .key{color:green;}.renderjson .keyword{color:darkgreen;}.renderjson a{color:white;text-decoration:none;}paper-tabs{background-color:var(--app-primary-color);color:#fff;--paper-tabs-selection-bar-color:white;--paper-tab-ink:white;}</style><template is="dom-if" if="{{showResponse}}"><div class="toolbar"><div class="space-right">Full JSON</div><paper-toggle-button checked="{{_fullJson}}"></paper-toggle-button></div><h4>Response:</h4><div class="response-panel"><div class="right" on-click="hide">X</div><div class="clearfix"></div><template is="dom-repeat" items="{{data}}" as="line"><div class="line"><div class="line-number">{{index}}:</div><div class="line-content-container"><div class="line-content">{{stringify(line, _fullJson)}}</div></div></div><div class="clearfix"></div></template></div></template></template><script>class QuantumResponseContainer extends Polymer.Element{static get is(){return'quantum-response-container'}static get properties(){return{reponse:{type:Array,observer:'responseChanged'},debug:{type:Boolean,value:!1},_fullJson:{type:Boolean,value:!1}}}static get observers(){return['responseChanged(reponse.*)']}ready(){super.ready(),this.showResponse=!1,this.data=[],this.selected=0}connectedCallback(){super.connectedCallback(),this.responseChanged()}responseChanged(){return this.debug&&console.log('[quantum-response-container] responseChanged',this.response),null===this.response||void 0===this.response?void(this.showResponse=!1):void(this.data=this.response,this.debug&&console.log('[quantum-response-container] responseChanged',this.data),this.showResponse=void 0!==this.data&&null!==this.data,window.setTimeout(()=>{this.root.querySelector('#jsonTree')}))}hide(){this.showResponse=!1}stringify(a,b){return looseJSON.stringify(a,b)}}customElements.define(QuantumResponseContainer.is,QuantumResponseContainer);</script></dom-module><script>(function(e){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=e();else if("function"===typeof define&&define.amd)define([],e);else{var t;t="undefined"===typeof window?"undefined"===typeof global?"undefined"===typeof self?this:self:global:window,t.PouchDB=e()}})(function(){var e=String.fromCharCode,t=Math.min,n=Math.max,s=Math.ceil,r=Math.floor,o=Math.abs,a;return function d(c,e,t){function r(s,o){if(!e[s]){if(!c[s]){var i="function"==typeof require&&require;if(!o&&i)return i(s,!0);if(n)return n(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var p=e[s]={exports:{}};c[s][0].call(p.exports,function(t){var e=c[s][1][t];return r(e?e:t)},p,p.exports,d,c,e,t)}return e[s].exports}for(var n="function"==typeof require&&require,s=0;s<t.length;s++)r(t[s]);return r}({1:[function(e,t){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var n=[],s=-1;++s<t;)n[s]=arguments[s];return e.call(this,n)}return e.call(this,[])}}},{}],2:[function(e,t,n){(function(s){function r(){var e;try{e=n.storage.debug}catch(t){}return!e&&"undefined"!==typeof s&&"env"in s&&(e=s.env.DEBUG),e}n=t.exports=e(3),n.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!!t){var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"===e||(r++,"%c"===e&&(o=r))}),e.splice(o,0,s)}},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(t){}},n.load=r,n.useColors=function(){return"undefined"!==typeof window&&window.process&&"renderer"===window.process.type||("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.enable(r())}).call(this,e(9))},{3:3,9:9}],3:[function(e,t,n){function s(e){var t=0,s;for(s in e)t=(t<<5)-t+e.charCodeAt(s),t|=0;return n.colors[o(t)%n.colors.length]}function r(e){function t(){if(t.enabled){var e=t,s=+new Date,o=s-(r||s);e.diff=o,e.prev=r,e.curr=s,r=s;for(var a=Array(arguments.length),d=0;d<a.length;d++)a[d]=arguments[d];a[0]=n.coerce(a[0]),"string"!==typeof a[0]&&a.unshift("%O");var i=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,s){if("%%"===t)return t;i++;var r=n.formatters[s];if("function"===typeof r){var o=a[i];t=r.call(e,o),a.splice(i,1),i--}return t}),n.formatArgs.call(e,a);var c=t.log||n.log||console.log.bind(console);c.apply(e,a)}}var r;return t.namespace=e,t.enabled=n.enabled(e),t.useColors=n.useColors(),t.color=s(e),t.destroy=a,"function"===typeof n.init&&n.init(t),n.instances.push(t),t}function a(){var e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}n=t.exports=r.debug=r["default"]=r,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e),n.names=[],n.skips=[];var t=("string"===typeof e?e:"").split(/[\s,]+/),s=t.length,r;for(r=0;r<s;r++)t[r]&&(e=t[r].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(r=0;r<n.instances.length;r++){var o=n.instances[r];o.enabled=n.enabled(o.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;var t,s;for(t=0,s=n.skips.length;t<s;t++)if(n.skips[t].test(e))return!1;for(t=0,s=n.names.length;t<s;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e(8),n.instances=[],n.names=[],n.skips=[],n.formatters={}},{8:8}],4:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"===typeof e}function r(e){return"number"===typeof e}function o(e){return"object"===typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,r,d,c,i;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length))if(t=arguments[1],t instanceof Error)throw t;else{var l=new Error("Uncaught, unspecified \"error\" event. ("+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:d=Array.prototype.slice.call(arguments,1),n.apply(this,d);}else if(o(n))for(d=Array.prototype.slice.call(arguments,1),i=n.slice(),r=i.length,c=0;c<r;c++)i[c].apply(this,d);return!0},n.prototype.addListener=function(e,t){var r;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,r,a,d;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||s(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(d=a;0<d--;)if(n[d]===t||n[d].listener&&n[d].listener===t){r=d;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],s(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t){(function(e){"use strict";function n(){l=!0;for(var e=c.length,t,n;e;){for(n=c,c=[],t=-1;++t<e;)n[t]();e=c.length}l=!1}var s=e.MutationObserver||e.WebKitMutationObserver,r;if(s){var o=0,a=new s(n),i=e.document.createTextNode("");a.observe(i,{characterData:!0}),r=function(){i.data=o=++o%2}}else if(!e.setImmediate&&"undefined"!==typeof e.MessageChannel){var d=new e.MessageChannel;d.port1.onmessage=n,r=function(){d.port2.postMessage(0)}}else r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};var c=[],l;t.exports=function(e){1!==c.push(e)||l||r()}}).call(this,"undefined"===typeof global?"undefined"===typeof self?"undefined"===typeof window?{}:window:self:global)},{}],6:[function(e,t){t.exports="function"===typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],7:[function(e,t){"use strict";function n(){}function s(e){if("function"!==typeof e)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,e!==n&&d(this,e)}function r(e,t,n){this.promise=e,"function"===typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"===typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function o(t,e,n){i(function(){var s;try{s=e(n)}catch(n){return l.reject(t,n)}s===t?l.reject(t,new TypeError("Cannot resolve promise with itself")):l.resolve(t,s)})}function a(e){var t=e&&e.then;if(e&&("object"===typeof e||"function"===typeof e)&&"function"===typeof t)return function(){t.apply(e,arguments)}}function d(e,t){function n(t){r||(r=!0,l.reject(e,t))}function s(t){r||(r=!0,l.resolve(e,t))}var r=!1,o=c(function(){t(s,n)});"error"===o.status&&n(o.value)}function c(e,t){var n={};try{n.value=e(t),n.status="success"}catch(t){n.status="error",n.value=t}return n}var i=e(5),l={},u=["REJECTED"],p=["FULFILLED"],h=["PENDING"];t.exports=s,s.prototype["catch"]=function(e){return this.then(null,e)},s.prototype.then=function(e,t){if("function"!==typeof e&&this.state===p||"function"!==typeof t&&this.state===u)return this;var s=new this.constructor(n);if(this.state!==h){var a=this.state===p?e:t;o(s,a,this.outcome)}else this.queue.push(new r(s,e,t));return s},r.prototype.callFulfilled=function(e){l.resolve(this.promise,e)},r.prototype.otherCallFulfilled=function(e){o(this.promise,this.onFulfilled,e)},r.prototype.callRejected=function(e){l.reject(this.promise,e)},r.prototype.otherCallRejected=function(e){o(this.promise,this.onRejected,e)},l.resolve=function(e,t){var n=c(a,t);if("error"===n.status)return l.reject(e,n.value);var s=n.value;if(s)d(e,s);else{e.state=p,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},l.reject=function(e,t){e.state=u,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:l.resolve(new this(n),e)},s.reject=function(e){var t=new this(n);return l.reject(t,e)},s.all=function(e){function t(e,t){s.resolve(e).then(function(e){a[t]=e,++d!==r||o||(o=!0,l.resolve(u,a))},function(e){o||(o=!0,l.reject(u,e))})}var s=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=Array(r),d=0,c=-1,u=new this(n);++c<r;)t(e[c],c);return u},s.race=function(e){function t(e){s.resolve(e).then(function(e){o||(o=!0,l.resolve(i,e))},function(e){o||(o=!0,l.reject(i,e))})}var s=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=-1,i=new this(n);++a<r;)t(e[a]);return i}},{5:5}],8:[function(e,t){function n(e){if(e+="",!(100<e.length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();return"years"===n||"year"===n||"yrs"===n||"yr"===n||"y"===n?s*d:"days"===n||"day"===n||"d"===n?s*p:"hours"===n||"hour"===n||"hrs"===n||"hr"===n||"h"===n?s*u:"minutes"===n||"minute"===n||"mins"===n||"min"===n||"m"===n?s*l:"seconds"===n||"second"===n||"secs"===n||"sec"===n||"s"===n?s*c:"milliseconds"===n||"millisecond"===n||"msecs"===n||"msec"===n||"ms"===n?s:void 0}}}function o(e){var t=Math.round;return e>=p?t(e/p)+"d":e>=u?t(e/u)+"h":e>=l?t(e/l)+"m":e>=c?t(e/c)+"s":e+"ms"}function a(e){return i(e,p,"day")||i(e,u,"hour")||i(e,l,"minute")||i(e,c,"second")||e+" ms"}function i(e,t,n){return e<t?void 0:e<1.5*t?r(e/t)+" "+n:s(e/t)+" "+n+"s"}var c=1e3,l=60*c,u=60*l,p=24*u,d=365.25*p;t.exports=function(e,t){t=t||{};var s=typeof e;if("string"===s&&0<e.length)return n(e);if("number"===s&&!1===isNaN(e))return t.long?a(e):o(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t){function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(e){if(p===clearTimeout)return clearTimeout(e);if((p===s||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function a(){_&&m&&(_=!1,m.length?h=m.concat(h):g=-1,h.length&&d())}function d(){if(!_){var e=r(a);_=!0;for(var t=h.length;t;){for(m=h,h=[];++g<t;)m&&m[g].run();g=-1,t=h.length}m=null,_=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function i(){}var l=t.exports={},u,p;(function(){try{u="function"===typeof setTimeout?setTimeout:n}catch(t){u=n}try{p="function"===typeof clearTimeout?clearTimeout:s}catch(t){p=s}})();var h=[],_=!1,g=-1,m;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new c(e,t)),1!==h.length||_||r(d)},c.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=i,l.addListener=i,l.once=i,l.off=i,l.removeListener=i,l.removeAllListeners=i,l.emit=i,l.prependListener=i,l.prependOnceListener=i,l.listeners=function(){return[]},l.binding=function(){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],10:[function(s,r,o){(function(e){if("object"===typeof o)r.exports=e();else if("function"===typeof a&&a.amd)a(e);else{var t;try{t=window}catch(n){t=self}t.SparkMD5=e()}})(function(){"use strict";function r(e,t){var n=e[0],s=e[1],r=e[2],o=e[3];n+=0|(s&r|~s&o)+t[0]-680876936,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[1]-389564586,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[2]+606105819,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[3]-1044525330,s=0|(s<<22|s>>>10)+r,n+=0|(s&r|~s&o)+t[4]-176418897,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[5]+1200080426,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[6]-1473231341,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[7]-45705983,s=0|(s<<22|s>>>10)+r,n+=0|(s&r|~s&o)+t[8]+1770035416,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[9]-1958414417,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[10]-42063,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[11]-1990404162,s=0|(s<<22|s>>>10)+r,n+=0|(s&r|~s&o)+t[12]+1804603682,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[13]-40341101,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[14]-1502002290,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[15]+1236535329,s=0|(s<<22|s>>>10)+r,n+=0|(s&o|r&~o)+t[1]-165796510,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[6]-1069501632,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[11]+643717713,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[0]-373897302,s=0|(s<<20|s>>>12)+r,n+=0|(s&o|r&~o)+t[5]-701558691,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[10]+38016083,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[15]-660478335,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[4]-405537848,s=0|(s<<20|s>>>12)+r,n+=0|(s&o|r&~o)+t[9]+568446438,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[14]-1019803690,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[3]-187363961,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[8]+1163531501,s=0|(s<<20|s>>>12)+r,n+=0|(s&o|r&~o)+t[13]-1444681467,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[2]-51403784,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[7]+1735328473,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[12]-1926607734,s=0|(s<<20|s>>>12)+r,n+=0|(s^r^o)+t[5]-378558,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[8]-2022574463,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[11]+1839030562,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[14]-35309556,s=0|(s<<23|s>>>9)+r,n+=0|(s^r^o)+t[1]-1530992060,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[4]+1272893353,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[7]-155497632,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[10]-1094730640,s=0|(s<<23|s>>>9)+r,n+=0|(s^r^o)+t[13]+681279174,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[0]-358537222,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[3]-722521979,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[6]+76029189,s=0|(s<<23|s>>>9)+r,n+=0|(s^r^o)+t[9]-640364487,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[12]-421815835,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[15]+530742520,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[2]-995338651,s=0|(s<<23|s>>>9)+r,n+=0|(r^(s|~o))+t[0]-198630844,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[7]+1126891415,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[14]-1416354905,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[5]-57434055,s=0|(s<<21|s>>>11)+r,n+=0|(r^(s|~o))+t[12]+1700485571,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[3]-1894986606,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[10]-1051523,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[1]-2054922799,s=0|(s<<21|s>>>11)+r,n+=0|(r^(s|~o))+t[8]+1873313359,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[15]-30611744,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[6]-1560198380,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[13]+1309151649,s=0|(s<<21|s>>>11)+r,n+=0|(r^(s|~o))+t[4]-145523070,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[11]-1120210379,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[2]+718787259,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[9]-343485551,s=0|(s<<21|s>>>11)+r,e[0]=0|n+e[0],e[1]=0|s+e[1],e[2]=0|r+e[2],e[3]=0|o+e[3]}function o(e){var t=[],n;for(n=0;64>n;n+=4)t[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return t}function s(e){var t=[],n;for(n=0;64>n;n+=4)t[n>>2]=e[n]+(e[n+1]<<8)+(e[n+2]<<16)+(e[n+3]<<24);return t}function a(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],s,a,i,d,c,l;for(s=64;s<=t;s+=64)r(n,o(e.substring(s-64,s)));for(e=e.substring(s-64),a=e.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<a;s+=1)i[s>>2]|=e.charCodeAt(s)<<(s%4<<3);if(i[s>>2]|=128<<(s%4<<3),55<s)for(r(n,i),s=0;16>s;s+=1)i[s]=0;return d=8*t,d=d.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(d[2],16),l=parseInt(d[1],16)||0,i[14]=c,i[15]=l,r(n,i),n}function i(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],o,a,i,d,c,l;for(o=64;o<=t;o+=64)r(n,s(e.subarray(o-64,o)));for(e=o-64<t?e.subarray(o-64):new Uint8Array(0),a=e.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<a;o+=1)i[o>>2]|=e[o]<<(o%4<<3);if(i[o>>2]|=128<<(o%4<<3),55<o)for(r(n,i),o=0;16>o;o+=1)i[o]=0;return d=8*t,d=d.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(d[2],16),l=parseInt(d[1],16)||0,i[14]=c,i[15]=l,r(n,i),n}function d(e){var t="",n;for(n=0;4>n;n+=1)t+=f[15&e>>8*n+4]+f[15&e>>8*n];return t}function c(e){var t;for(t=0;t<e.length;t+=1)e[t]=d(e[t]);return e.join("")}function l(e){return /[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e,t){var n=e.length,s=new ArrayBuffer(n),r=new Uint8Array(s),o;for(o=0;o<n;o+=1)r[o]=e.charCodeAt(o);return t?r:s}function p(t){return e.apply(null,new Uint8Array(t))}function h(e,t,n){var s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e)),s.set(new Uint8Array(t),e.byteLength),n?s:s.buffer}function _(t){var n=[],s=t.length,r;for(r=0;r<s-1;r+=2)n.push(parseInt(t.substr(r,2),16));return e.apply(String,n)}function g(){this.reset()}var m=function(e,t){return 4294967295&e+t},f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==c(a("hello"))&&(m=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}),"undefined"===typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(e,s){return e=0|e||0,0>e?n(e+s,0):t(e,s)}ArrayBuffer.prototype.slice=function(t,n){var s=this.byteLength,r=e(t,s),o=s,a,i,d,c;return(void 0!==n&&(o=e(n,s)),r>o)?new ArrayBuffer(0):(a=o-r,i=new ArrayBuffer(a),d=new Uint8Array(i),c=new Uint8Array(this,r,a),d.set(c),i)}}(),g.prototype.append=function(e){return this.appendBinary(l(e)),this},g.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t=this._buff.length,n;for(n=64;n<=t;n+=64)r(this._hash,o(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},g.prototype.end=function(e){var t=this._buff,n=t.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r,o;for(r=0;r<n;r+=1)s[r>>2]|=t.charCodeAt(r)<<(r%4<<3);return this._finish(s,n),o=c(this._hash),e&&(o=_(o)),this.reset(),o},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},g.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(e,t){var n=t,s,o,a;if(e[n>>2]|=128<<(n%4<<3),55<n)for(r(this._hash,e),n=0;16>n;n+=1)e[n]=0;s=8*this._length,s=s.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(s[2],16),a=parseInt(s[1],16)||0,e[14]=o,e[15]=a,r(this._hash,e)},g.hash=function(e,t){return g.hashBinary(l(e),t)},g.hashBinary=function(e,t){var n=a(e),s=c(n);return t?_(s):s},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(e){var t=h(this._buff.buffer,e,!0),n=t.length,o;for(this._length+=e.byteLength,o=64;o<=n;o+=64)r(this._hash,s(t.subarray(o-64,o)));return this._buff=o-64<n?new Uint8Array(t.buffer.slice(o-64)):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(e){var t=this._buff,n=t.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r,o;for(r=0;r<n;r+=1)s[r>>2]|=t[r]<<(r%4<<3);return this._finish(s,n),o=c(this._hash),e&&(o=_(o)),this.reset(),o},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var e=g.prototype.getState.call(this);return e.buff=p(e.buff),e},g.ArrayBuffer.prototype.setState=function(e){return e.buff=u(e.buff,!0),g.prototype.setState.call(this,e)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(e,t){var n=i(new Uint8Array(e)),s=c(n);return t?_(s):s},g})},{}],11:[function(e,t){var n=e(14),s=e(15),r=s;r.v1=n,r.v4=s,t.exports=r},{14:14,15:15}],12:[function(e,t){for(var n=[],s=0;256>s;++s)n[s]=(s+256).toString(16).substr(1);t.exports=function(e,t){var s=t||0,r=n;return r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]+"-"+r[e[s++]]+r[e[s++]]+"-"+r[e[s++]]+r[e[s++]]+"-"+r[e[s++]]+r[e[s++]]+"-"+r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]}},{}],13:[function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var s=new Uint8Array(16);t.exports=function(){return n(s),s}}else{var o=Array(16);t.exports=function(){for(var e=0,t;16>e;e++)0===(3&e)&&(t=4294967296*Math.random()),o[e]=255&t>>>((3&e)<<3);return o}}},{}],14:[function(e,t){var n=e(13),s=e(12),r=0,o=0,a,d;t.exports=function(e,t,c){var l=t&&c||0,i=t||[];e=e||{};var u=e.node||a,p=void 0===e.clockseq?d:e.clockseq;if(null==u||null==p){var h=n();null==u&&(u=a=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=d=16383&(h[6]<<8|h[7]))}var _=void 0===e.msecs?new Date().getTime():e.msecs,g=void 0===e.nsecs?o+1:e.nsecs,m=_-r+(g-o)/1e4;if(0>m&&void 0===e.clockseq&&(p=16383&p+1),(0>m||_>r)&&void 0===e.nsecs&&(g=0),1e4<=g)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");r=_,o=g,d=p,_+=1.22192928e13;var f=(1e4*(268435455&_)+g)%4294967296;i[l++]=255&f>>>24,i[l++]=255&f>>>16,i[l++]=255&f>>>8,i[l++]=255&f;var y=268435455&1e4*(_/4294967296);i[l++]=255&y>>>8,i[l++]=255&y,i[l++]=16|15&y>>>24,i[l++]=255&y>>>16,i[l++]=128|p>>>8,i[l++]=255&p;for(var v=0;6>v;++v)i[l+v]=u[v];return t?t:s(i)}},{12:12,13:13}],15:[function(e,t){var n=e(13),s=e(12);t.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||n)();if(a[6]=64|15&a[6],a[8]=128|63&a[8],t)for(var i=0;16>i;++i)t[o+i]=a[i];return t||s(a)}},{12:12,13:13}],16:[function(e,t,n){"use strict";function s(e,t,n){var s=n[n.length-1];e===s.element&&(n.pop(),s=n[n.length-1]);var r=s.element,o=s.index;if(Array.isArray(r))r.push(e);else if(o===t.length-2){var a=t.pop();r[a]=e}else t.push(e)}n.stringify=function(e){for(var t=[{obj:e}],n="",s,r,o,a,d,i,c,l,u,p,h;s=t.pop();)if(r=s.obj,o=s.prefix||"",a=s.val||"",n+=o,a)n+=a;else if("object"!==typeof r)n+="undefined"===typeof r?null:JSON.stringify(r);else if(null===r)n+="null";else if(Array.isArray(r)){for(t.push({val:"]"}),d=r.length-1;0<=d;d--)i=0===d?"":",",t.push({obj:r[d],prefix:i});t.push({val:"["})}else{for(l in c=[],r)r.hasOwnProperty(l)&&c.push(l);for(t.push({val:"}"}),d=c.length-1;0<=d;d--)u=c[d],p=r[u],h=0<d?",":"",h+=JSON.stringify(u)+":",t.push({obj:p,prefix:h});t.push({val:"{"})}return n},n.parse=function(e){for(var t=[],n=[],r=0,o,a,i,d,c,l,u,p,h;;){if(o=e[r++],"}"===o||"]"===o||"undefined"===typeof o){if(1===t.length)return t.pop();s(t.pop(),t,n);continue}switch(o){case" ":case"\t":case"\n":case":":case",":break;case"n":r+=3,s(null,t,n);break;case"t":r+=3,s(!0,t,n);break;case"f":r+=4,s(!1,t,n);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(a="",r--;;)if(i=e[r++],/[\d\.\-e\+]/.test(i))a+=i;else{r--;break}s(parseFloat(a),t,n);break;case"\"":for(d="",c=void 0,l=0;u=e[r++],"\""!==u||"\\"===c&&1===l%2;)d+=u,c=u,"\\"===c?l++:l=0;s(JSON.parse("\""+d+"\""),t,n);break;case"[":p={element:[],index:t.length},t.push(p.element),n.push(p);break;case"{":h={element:{},index:t.length},t.push(h.element),n.push(h);break;default:throw new Error("unexpectedly reached end of input: "+o);}}}},{}],17:[function(a,i){(function(d){"use strict";function c(e){return e&&"object"===typeof e&&"default"in e?e["default"]:e}function l(e){return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!==typeof Blob&&e instanceof Blob}function u(e){if("function"===typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),s=new Uint8Array(e);return n.set(s),t}function p(e){if(e instanceof ArrayBuffer)return u(e);var t=e.size,n=e.type;return"function"===typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}function h(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&pr.call(n)==hr}function _(e){var t,n,s;if(!e||"object"!==typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,s=e.length;n<s;n++)t[n]=_(e[n]);return t}if(e instanceof Date)return e.toISOString();if(l(e))return p(e);if(!h(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=_(e[n]);"undefined"!==typeof r&&(t[n]=r)}return t}function g(e){var t=!1;return sr(function(n){if(t)throw new Error("once called more than once");else t=!0,e.apply(this,n)})}function m(e){return sr(function(t){t=_(t);var n=this,s="function"===typeof t[t.length-1]&&t.pop(),r=new ur(function(s,r){var o;try{var a=g(function(e,t){e?r(e):s(t)});t.push(a),o=e.apply(n,t),o&&"function"===typeof o.then&&s(o)}catch(t){r(t)}});return s&&r.then(function(e){s(null,e)},s),r})}function f(e,t,n){if(e.constructor.listeners("debug").length){for(var s=["api",e.name,t],r=0;r<n.length-1;r++)s.push(n[r]);e.constructor.emit("debug",s);var o=n[n.length-1];n[n.length-1]=function(n,s){var r=["api",e.name,t];r=r.concat(n?["error",n]:["success",s]),e.constructor.emit("debug",r),o(n,s)}}}function y(e,t){return m(sr(function(n){if(this._closed)return ur.reject(new Error("database is closed"));if(this._destroyed)return ur.reject(new Error("database is destroyed"));var s=this;return f(s,e,n),this.taskqueue.isReady?t.apply(this,n):new ur(function(t,r){s.taskqueue.addTask(function(o){o?r(o):t(s[e].apply(s,n))})})}))}function v(e){return"$"+e}function b(e){return e.substring(1)}function E(){this._store={}}function k(e){if(this._store=new E,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}function q(e,t){for(var n={},s=0,r=t.length,o;s<r;s++)o=t[s],o in e&&(n[o]=e[o]);return n}function S(e){return e}function w(e){return[{ok:e}]}function C(e,n,s){function r(){var e=[];_.forEach(function(t){t.docs.forEach(function(n){e.push({id:t.id,docs:[n]})})}),s(null,{results:e})}function o(){++h===p&&r()}function a(e,t,n){_[e]={id:t,docs:n},o()}function d(){if(!(m>=g.length)){var e=t(m+mr,g.length),n=g.slice(m,e);c(n,m),m+=n.length}}function c(t,s){t.forEach(function(t,r){var o=u.get(t),i=q(o[0],["atts_since","attachments"]);i.open_revs=o.map(function(e){return e.rev}),i.open_revs=i.open_revs.filter(S);var c=S;0===i.open_revs.length&&(delete i.open_revs,c=w),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in n&&(i[e]=n[e])}),e.get(t,i,function(e,n){var o;o=e?[{error:e}]:c(n),a(s+r,t,o),d()})})}var l=n.docs,u=new gr;l.forEach(function(e){u.has(e.id)?u.get(e.id).push(e):u.set(e.id,[e])});var p=u.size,h=0,_=Array(p),g=[];u.forEach(function(e,t){g.push(t)});var m=0;d()}function x(){return"undefined"!==typeof chrome&&"undefined"!==typeof chrome.storage&&"undefined"!==typeof chrome.storage.local}function T(){return fr}function A(t){x()?chrome.storage.onChanged.addListener(function(n){null!=n.db_name&&t.emit(n.dbName.newValue)}):T()&&("undefined"===typeof addEventListener?window.attachEvent("storage",function(n){t.emit(n.key)}):addEventListener("storage",function(n){t.emit(n.key)}))}function L(){or.EventEmitter.call(this),this._listeners={},A(this)}function j(e){if("undefined"!==typeof console&&"function"===typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function O(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:++t,t>n&&(e=n>>1,t=n);var s=Math.random(),r=t-e;return~~(r*s+e)}function D(e){var t=0;return e||(t=2e3),O(e,t)}function I(e,t){j("info","The above "+e+" is totally normal. "+t)}function F(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}function N(e,t){function n(t){for(var n in e)"function"!==typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=F.prototype,new n(t)}function R(e){if("object"!==typeof e){var t=e;e=Tr,e.data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function $(e,t,n){try{return!e(t,n)}catch(e){var s="Filter function threw: "+e.toString();return N(Dr,s)}}function P(e){var t={},n=e.filter&&"function"===typeof e.filter;return t.query=e.query_params,function(s){s.doc||(s.doc={});var r=n&&$(e.filter,s.doc,t);if("object"===typeof r)return r;if(r)return!1;if(!e.include_docs)delete s.doc;else if(!e.attachments)for(var o in s.doc._attachments)s.doc._attachments.hasOwnProperty(o)&&(s.doc._attachments[o].stub=!0);return!0}}function B(e){for(var t=[],n=0,s=e.length;n<s;n++)t=t.concat(e[n]);return t}function M(e){var t;if(e?"string"===typeof e?/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=N(Cr)):t=N(Sr):t=N(wr),t)throw t}function U(e){return"boolean"===typeof e._remote?e._remote:!("function"!==typeof e.type)&&(j("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function W(e,t){return"listenerCount"in e?e.listenerCount(t):or.EventEmitter.listenerCount(e,t)}function H(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function z(e){var t=H(e);return t?t.join("/"):null}function X(e){for(var t=Gr.exec(e),n={},s=14;s--;){var r=Hr[s],o=t[s]||"",a=-1!==["user","password"].indexOf(r);n[r]=a?decodeURIComponent(o):o}return n[zr]={},n[Hr[12]].replace(Xr,function(e,t,s){t&&(n[zr][t]=s)}),n}function G(e,t){var n=[],s=[];for(var r in t)t.hasOwnProperty(r)&&(n.push(r),s.push(t[r]));return n.push(e),Function.apply(null,n).apply(null,s)}function V(e,t,n){return new ur(function(s,r){e.get(t,function(o,a){if(o){if(404!==o.status)return r(o);a={}}var i=a._rev,d=n(a);return d?void(d._id=t,d._rev=i,s(K(e,d,n))):s({updated:!1,rev:i})})})}function K(e,t,n){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(s){if(409!==s.status)throw s;return V(e,t._id,n)})}function Q(){return ir.v4().replace(/-/g,"").toLowerCase()}function J(e){for(var t=e.rev_tree.slice(),n,s,r,o;o=t.pop();){var a=o.ids,d=a[2],c=o.pos;if(d.length){for(var l=0,i=d.length;l<i;l++)t.push({pos:c+1,ids:d[l]});continue}var u=!!a[1].deleted,p=a[0];(!n||(r===u?s===c?n<p:s<c:r))&&(n=p,s=c,r=u)}return s+"-"+n}function Y(e,t){for(var n=e.slice(),s;s=n.pop();)for(var r=s.pos,o=s.ids,a=o[2],d=t(0===a.length,r,o[0],s.ctx,o[1]),c=0,i=a.length;c<i;c++)n.push({pos:r+1,ids:a[c],ctx:d})}function Z(e,t){return e.pos-t.pos}function ee(e){var t=[];Y(e,function(e,n,s,r,o){e&&t.push({rev:n+"-"+s,pos:n,opts:o})}),t.sort(Z).reverse();for(var n=0,s=t.length;n<s;n++)delete t[n].pos;return t}function te(e){for(var t=J(e),n=ee(e.rev_tree),s=[],r=0,o=n.length,a;r<o;r++)a=n[r],a.rev===t||a.opts.deleted||s.push(a.rev);return s}function ne(e){var t=[];return Y(e.rev_tree,function(e,n,s,r,o){"available"!==o.status||e||(t.push(n+"-"+s),o.status="missing")}),t}function se(e){for(var t=[],n=e.slice(),s;s=n.pop();){var r=s.pos,o=s.ids,a=o[0],d=o[1],c=o[2],l=0===c.length,u=s.history?s.history.slice():[];u.push({id:a,opts:d}),l&&t.push({pos:r+1-u.length,ids:u});for(var p=0,i=c.length;p<i;p++)n.push({pos:r+1,ids:c[p],history:u})}return t.reverse()}function re(e,t){return e.pos-t.pos}function oe(e,t,n){for(var s=0,r=e.length,o;s<r;)o=s+r>>>1,0>n(e[o],t)?s=o+1:r=o;return s}function ae(e,t,n){var s=oe(e,t,n);e.splice(s,0,t)}function ie(e,t){for(var n=t,s=e.length,r,o;n<s;n++){var a=e[n],i=[a.id,a.opts,[]];o?(o[2].push(i),o=i):r=o=i}return r}function de(e,t){return e[0]<t[0]?-1:1}function ce(e,t){for(var n=[{tree1:e,tree2:t}],s=!1;0<n.length;){var r=n.pop(),o=r.tree1,a=r.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var d=0;d<a[2].length;d++){if(!o[2][0]){s="new_leaf",o[2][0]=a[2][d];continue}for(var i=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][d][0]&&(n.push({tree1:o[2][c],tree2:a[2][d]}),i=!0);i||(s="new_branch",ae(o[2],a[2][d],de))}}return{conflicts:s,tree:e}}function le(e,t,n){var s=[],r=!1,o=!1,a;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var d=0,i=e.length,c;d<i;d++)if(c=e[d],c.pos===t.pos&&c.ids[0]===t.ids[0])a=ce(c.ids,t.ids),s.push({pos:c.pos,ids:a.tree}),r=r||a.conflicts,o=!0;else if(!0!==n){var l=c.pos<t.pos?c:t,u=c.pos<t.pos?t:c,p=u.pos-l.pos,h=[],_=[];for(_.push({ids:l.ids,diff:p,parent:null,parentIdx:null});0<_.length;){var g=_.pop();if(0===g.diff){g.ids[0]===u.ids[0]&&h.push(g);continue}for(var m=g.ids[2],f=0,y=m.length;f<y;f++)_.push({ids:m[f],diff:g.diff-1,parent:g.ids,parentIdx:f})}var v=h[0];v?(a=ce(v.ids,u.ids),v.parent[2][v.parentIdx]=a.tree,s.push({pos:l.pos,ids:l.ids}),r=r||a.conflicts,o=!0):s.push(c)}else s.push(c);return o||s.push(t),s.sort(re),{tree:s,conflicts:r||"internal_node"}}function ue(e,t){for(var n=se(e),r=0,o=n.length,a,i;r<o;r++){var d=n[r],c=d.ids,l;if(c.length>t){a||(a={});var u=c.length-t;l={pos:d.pos+u,ids:ie(c,u)};for(var p=0,s;p<u;p++)s=d.pos+p+"-"+c[p].id,a[s]=!0}else l={pos:d.pos,ids:ie(c,0)};i=i?le(i,l,!0).tree:[l]}return a&&Y(i,function(e,t,n){delete a[t+"-"+n]}),{tree:i,revs:a?Object.keys(a):[]}}function pe(e,t,n){var s=le(e,t),r=ue(s.tree,n);return{tree:r.tree,stemmedRevs:r.revs,conflicts:s.conflicts}}function he(e,t){for(var n=e.slice(),s=t.split("-"),r=parseInt(s[0],10),o=s[1],a;a=n.pop();){if(a.pos===r&&a.ids[0]===o)return!0;for(var d=a.ids[2],c=0,i=d.length;c<i;c++)n.push({pos:a.pos+1,ids:d[c]})}return!1}function _e(e){return e.ids}function ge(e,t){t||(t=J(e));for(var n=t.substring(t.indexOf("-")+1),s=e.rev_tree.map(_e),r;r=s.pop();){if(r[0]===n)return!!r[1].deleted;s=s.concat(r[2])}}function me(e){return /^_local/.test(e)}function fe(e,t){for(var n=t.rev_tree.slice(),s;s=n.pop();){var r=s.pos,o=s.ids,a=o[0],d=o[1],c=o[2],u=0===c.length,p=s.history?s.history.slice():[];if(p.push({id:a,pos:r,opts:d}),u)for(var h=0,i=p.length;h<i;h++){var _=p[h],g=_.pos+"-"+_.id;if(g===e)return r+"-"+a}for(var m=0,f=c.length;m<f;m++)n.push({pos:r+1,ids:c[m],history:p})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function ye(e,t,n,s){try{e.emit("change",t,n,s)}catch(t){j("error","Error in .on(\"change\", function):",t)}}function ve(e,t,n){function s(){r.cancel()}or.EventEmitter.call(this);var r=this;this.db=e,t=t?_(t):{};var o=t.complete=g(function(t,n){t?0<W(r,"error")&&r.emit("error",t):r.emit("complete",n),r.removeAllListeners(),e.removeListener("destroyed",s)});n&&(r.on("complete",function(e){n(null,e)}),r.on("error",n)),e.once("destroyed",s),t.onChange=function(e,t,n){r.isCancelled||ye(r,e,t,n)};var a=new ur(function(e,n){t.complete=function(t,s){t?n(t):e(s)}});r.once("cancel",function(){e.removeListener("destroyed",s),t.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this["catch"]=a["catch"].bind(a),this.then(function(e){o(null,e)},o),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):r.isCancelled?r.emit("cancel"):r.validateChanges(t)})}function be(e,t,n){var s=[{rev:e._rev}];"all_docs"===n.style&&(s=ee(t.rev_tree).map(function(e){return{rev:e.rev}}));var r={id:t.id,changes:s,doc:e};return ge(t,e._rev)&&(r.deleted=!0),n.conflicts&&(r.doc._conflicts=te(t),!r.doc._conflicts.length&&delete r.doc._conflicts),r}function Ee(e,t){return e<t?-1:e>t?1:0}function ke(e,t){return function(n,s){n||s[0]&&s[0].error?(n=n||s[0],n.docId=t,e(n)):e(null,s.length?s[0]:s)}}function qe(e){for(var t=0,n;t<e.length;t++)if(n=e[t],n._deleted)delete n._attachments;else if(n._attachments)for(var s=Object.keys(n._attachments),r=0,o;r<s.length;r++)o=s[r],n._attachments[o]=q(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}function Se(e,t){var n=Ee(e._id,t._id);if(0!==n)return n;var s=e._revisions?e._revisions.start:0,r=t._revisions?t._revisions.start:0;return Ee(s,r)}function we(e){var n={},s=[];return Y(e,function(e,t,r,o){var a=t+"-"+r;return e&&(n[a]=0),void 0!==o&&s.push({from:o,to:a}),a}),s.reverse(),s.forEach(function(e){n[e.from]=void 0===n[e.from]?1+n[e.to]:t(n[e.from],1+n[e.to])}),n}function Ce(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):0<e.skip?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function xe(e){var t=e._compactionQueue[0],n=t.opts,s=t.callback;e.get("_local/compaction")["catch"](function(){return!1}).then(function(t){t&&t.last_seq&&(n.last_seq=t.last_seq),e._compact(n,function(t,n){t?s(t):s(null,n),rr(function(){e._compactionQueue.shift(),e._compactionQueue.length&&xe(e)})})})}function Te(e){return!("_"!==e.charAt(0))&&e+" is not a valid attachment name, attachment names cannot start with '_'"}function Ae(){or.EventEmitter.call(this)}function Le(){this.isReady=!1,this.failed=!1,this.queue=[]}function je(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var s=De.adapters,r=De.preferredAdapters,o=De.prefix,a=t.adapter;if(!a)for(var d=0;d<r.length;++d){if(a=r[d],"idb"===a&&"websql"in s&&T()&&localStorage["_pouch__websqldb_"+o+e]){j("log","PouchDB is downgrading \""+e+"\" to WebSQL to avoid data loss, because it was already opened with WebSQL.");continue}break}var i=s[a],c=i&&"use_prefix"in i?i.use_prefix:!0;return{name:c?o+e:e,adapter:a}}function Oe(e){function t(t){e.removeListener("closed",n),t||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}function De(e,t){if(!(this instanceof De))return new De(e,t);var n=this;if(t=t||{},e&&"object"===typeof e&&(t=e,e=t.name,delete t.name),this.__opts=t=_(t),n.auto_compaction=t.auto_compaction,n.prefix=De.prefix,"string"!==typeof e)throw new Error("Missing/invalid DB name");var s=(t.prefix||"")+e,r=je(s,t);if(t.name=r.name,t.adapter=t.adapter||r.adapter,n.name=e,n._adapter=t.adapter,De.emit("debug",["adapter","Picked adapter: ",t.adapter]),!De.adapters[t.adapter]||!De.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);Ae.call(n),n.taskqueue=new Le,n.adapter=t.adapter,De.adapters[t.adapter].call(n,t,function(e){return e?n.taskqueue.fail(e):void(Oe(n),n.emit("created",n),De.emit("created",n.name),n.taskqueue.ready(n))})}function Ie(e,t){for(var n=e,s=0,r=t.length,o;s<r&&(o=t[s],n=n[o],!!n);s++);return n}function Fe(e,t){return e<t?-1:e>t?1:0}function Ne(e){for(var t=[],n="",s=0,r=e.length,o;s<r;s++)o=e[s],"."===o?0<s&&"\\"===e[s-1]?n=n.substring(0,n.length-1)+".":(t.push(n),n=""):n+=o;return t.push(n),t}function Re(e){return-1<Qr.indexOf(e)}function $e(e){return Object.keys(e)[0]}function Pe(e){return e[$e(e)]}function Be(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(n){var s=e[n];if("object"!==typeof s&&(s={$eq:s}),Re(n))t[n]=s instanceof Array?s.map(function(e){return Be([e])}):Be([s]);else{var r=t[n]=t[n]||{};Object.keys(s).forEach(function(e){var t=s[e];return"$gt"===e||"$gte"===e?Me(e,t,r):"$lt"===e||"$lte"===e?Ue(e,t,r):"$ne"===e?We(t,r):"$eq"===e?He(t,r):void(r[e]=t)})}})}),t}function Me(e,t,n){"undefined"!==typeof n.$eq||("undefined"===typeof n.$gte?"undefined"===typeof n.$gt?n[e]=t:"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t))}function Ue(e,t,n){"undefined"!==typeof n.$eq||("undefined"===typeof n.$lte?"undefined"===typeof n.$lt?n[e]=t:"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t))}function We(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function He(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function ze(e){var t=_(e),n=!1;"$and"in t&&(t=Be(t.$and),n=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var s=t[n],r=e[s];("object"!==typeof r||null===r)&&(e[s]={$eq:r})}})}),"$not"in t&&(t.$not=Be([t.$not]));for(var s=Object.keys(t),r=0;r<s.length;r++){var o=s[r],a=t[o];"object"!==typeof a||null===a?a={$eq:a}:"$ne"in a&&!n&&(a.$ne=[a.$ne]),t[o]=a}return t}function Xe(e,t,n){for(var s="",r=n-e.length;s.length<r;)s+=t;return s}function Ge(e,t,n){var s=Xe(e,t,n);return s+e}function Ve(e,t){if(e===t)return 0;e=Ke(e),t=Ke(t);var n=rt(e),s=rt(t);if(0!==n-s)return n-s;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return nt(e,t);}return Array.isArray(e)?tt(e,t):st(e,t)}function Ke(e){switch(typeof e){case"undefined":return null;case"number":return e===Infinity||e===-Infinity||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=Array(n);for(var s=0;s<n;s++)e[s]=Ke(t[s])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var r in e={},t)if(t.hasOwnProperty(r)){var o=t[r];"undefined"!==typeof o&&(e[r]=Ke(o))}}}return e}function Qe(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return ot(e);case"string":return e.replace(/\u0002/g,"\x02\x02").replace(/\u0001/g,"\x01\x02").replace(/\u0000/g,"\x01\x01");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),s=-1,r=n.length,o="";if(t)for(;++s<r;)o+=Je(n[s]);else for(;++s<r;){var a=n[s];o+=Je(a)+Je(e[a])}return o;}return""}function Je(e){return e=Ke(e),rt(e)+Zr+Qe(e)+"\0"}function Ye(e,t){var n=t,s="1"===e[t],r;if(s)r=0,t++;else{var o="0"===e[t];t++;var a="",i=e.substring(t,t+Yr),d=parseInt(i,10)+Jr;for(o&&(d=-d),t+=Yr;;){var c=e[t];if("\0"===c)break;else a+=c;t++}a=a.split("."),r=1===a.length?parseInt(a,10):parseFloat(a[0]+"."+a[1]),o&&(r-=10),0!==d&&(r=parseFloat(r+"e"+d))}return{num:r,length:t-n}}function Ze(e,t){var n=e.pop();if(t.length){var s=t[t.length-1];n===s.element&&(t.pop(),s=t[t.length-1]);var r=s.element,o=s.index;if(Array.isArray(r))r.push(n);else if(o===e.length-2){var a=e.pop();r[a]=n}else e.push(n)}}function et(e){for(var t=[],n=[],s=0;;){var r=e[s++];if("\0"===r){if(1===t.length)return t.pop();Ze(t,n);continue}switch(r){case"1":t.push(null);break;case"2":t.push("1"===e[s]),s++;break;case"3":var o=Ye(e,s);t.push(o.num),s+=o.length;break;case"4":for(var a="";;){var i=e[s];if("\0"===i)break;a+=i,s++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"\x01").replace(/\u0002\u0002/g,"\x02"),t.push(a);break;case"5":var d={element:[],index:t.length};t.push(d.element),n.push(d);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r);}}}function tt(e,n){for(var s=t(e.length,n.length),r=0,o;r<s;r++)if(o=Ve(e[r],n[r]),0!==o)return o;return e.length===n.length?0:e.length>n.length?1:-1}function nt(e,t){return e===t?0:e>t?1:-1}function st(e,n){for(var s=Object.keys(e),r=Object.keys(n),o=t(s.length,r.length),a=0,i;a<o;a++){if(i=Ve(s[a],r[a]),0!==i)return i;if(i=Ve(e[s[a]],n[r[a]]),0!==i)return i}return s.length===r.length?0:s.length>r.length?1:-1}function rt(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:3>t?t+2:t+3:Array.isArray(e)?5:void 0}function ot(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),s=0>e,r=s?"0":"2",a=(s?-n:n)-Jr,i=Ge(a.toString(),"0",Yr);r+=Zr+i;var d=o(parseFloat(t[0]));s&&(d=10-d);var c=d.toFixed(20);return c=c.replace(/\.?0+$/,""),r+=Zr+c,r}function at(e){function t(t){return e.map(function(e){var n=$e(e),s=Ne(n),r=Ie(t,s);return r})}return function(e,n){var s=t(e.doc),r=t(n.doc),o=Ve(s,r);return 0===o?Fe(e.doc._id,n.doc._id):o}}function it(e,t,n){if(e=e.filter(function(e){return dt(e.doc,t.selector,n)}),t.sort){var s=at(t.sort);e=e.sort(s),"string"!==typeof t.sort[0]&&"desc"===Pe(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var r=t.skip||0,o=("limit"in t?t.limit:e.length)+r;e=e.slice(r,o)}return e}function dt(e,t,n){return n.every(function(n){var s=t[n],r=Ne(n),o=Ie(e,r);return Re(n)?lt(n,s,e):ct(s,e,r,o)})}function ct(e,t,n,s){return!e||Object.keys(e).every(function(r){var o=e[r];return ut(r,t,o,n,s)})}function lt(e,t,n){return"$or"===e?t.some(function(e){return dt(n,e,Object.keys(e))}):"$not"===e?!dt(n,t,Object.keys(t)):!t.find(function(e){return dt(n,e,Object.keys(e))})}function ut(e,t,n,s,r){if(!eo[e])throw new Error("unknown operator \""+e+"\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all");return eo[e](t,n,s,r)}function pt(e){return"undefined"!==typeof e&&null!==e}function ht(e){return"undefined"!==typeof e}function _t(e,t){var n=t[0],s=t[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(s,10)!==s)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%n===s}function gt(e,t){return t.some(function(t){return e instanceof Array?-1<e.indexOf(t):e===t})}function mt(e,t){return t.every(function(t){return-1<e.indexOf(t)})}function ft(e,t){return e.length===t}function yt(e,t){var n=new RegExp(t);return n.test(e)}function vt(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"===typeof e;case"number":return"number"===typeof e;case"string":return"string"===typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e);}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}function bt(e,t){if("object"!==typeof t)throw new Error("Selector error: expected a JSON object");t=ze(t);var n=it([{doc:e}],{selector:t},Object.keys(t));return n&&1===n.length}function Et(e){return G("\"use strict\";\nreturn "+e+";",{})}function kt(e){var t=["return function(doc) {","  \"use strict\";","  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return G(t,{})}function qt(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var n="string"===typeof e.filter?e.filter:"function";return t(new Error("selector invalid for filter \""+n+"\""))}t()}function St(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"===typeof e.filter&&("_view"===e.filter?e.view=z(e.view):e.filter=z(e.filter))}function wt(e,t){return t.filter&&"string"===typeof t.filter&&!t.doc_ids&&!U(e.db)}function Ct(e,t){var n=t.complete;if("_view"===t.filter){if(!t.view||"string"!==typeof t.view){var s=N(Dr,"`view` filter parameter not found or invalid.");return n(s)}var r=H(t.view);e.db.get("_design/"+r[0],function(s,o){if(e.isCancelled)return n(null,{status:"cancelled"});if(s)return n(R(s));var a=o&&o.views&&o.views[r[1]]&&o.views[r[1]].map;return a?void(t.filter=kt(a),e.doChanges(t)):n(N(kr,o.views?"missing json key: "+r[1]:"missing json key: views"))})}else if(t.selector)t.filter=function(e){return bt(e,t.selector)},e.doChanges(t);else{var o=H(t.filter);e.db.get("_design/"+o[0],function(s,r){if(e.isCancelled)return n(null,{status:"cancelled"});if(s)return n(R(s));var a=r&&r.filters&&r.filters[o[1]];return a?void(t.filter=Et(a),e.doChanges(t)):n(N(kr,r&&r.filters?"missing json key: "+o[1]:"missing json key: filters"))})}}function xt(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function Tt(e){if(!/^\d+-./.test(e))return N(Br);var t=e.indexOf("-"),n=e.substring(0,t),s=e.substring(t+1);return{prefix:parseInt(n,10),id:s}}function At(e,t){for(var n=e.start-e.ids.length+1,s=e.ids,r=[s[0],t,[]],o=1,a=s.length;o<a;o++)r=[s[o],{status:"missing"},[r]];return[{pos:n,ids:r}]}function Lt(e,t){var n={status:"available"},s,r,o;if(e._deleted&&(n.deleted=!0),t){if(e._id||(e._id=Vr()),r=Q(),e._rev){if(o=Tt(e._rev),o.error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,n,[]]]]}],s=o.prefix+1}else e._rev_tree=[{pos:1,ids:[r,n,[]]}],s=1;}else if(e._revisions&&(e._rev_tree=At(e._revisions,n),s=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if(o=Tt(e._rev),o.error)return o;s=o.prefix,r=o.id,e._rev_tree=[{pos:s,ids:[r,n,[]]}]}M(e._id),e._rev=s+"-"+r;var a={metadata:{},data:{}};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var d="_"===i[0];if(d&&!to[i]){var c=N(Or,i);throw c.message=Or.message+": "+i,c}else d&&!no[i]?a.metadata[i.slice(1)]=e[i]:a.data[i]=e[i]}return a}function jt(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n="undefined"===typeof BlobBuilder?"undefined"===typeof MSBlobBuilder?"undefined"===typeof MozBlobBuilder?WebKitBlobBuilder:MozBlobBuilder:MSBlobBuilder:BlobBuilder,s=new n,r=0;r<e.length;r+=1)s.append(e[r]);return s.getBlob(t.type)}}function Ot(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),r=0;r<t;r++)s[r]=e.charCodeAt(r);return n}function Dt(e,t){return jt([Ot(e)],{type:t})}function It(e,t){return Dt(so(e),t)}function Ft(t){for(var n="",s=new Uint8Array(t),r=s.byteLength,o=0;o<r;o++)n+=e(s[o]);return n}function Nt(e,t){if("undefined"===typeof FileReader)return t(Ft(new FileReaderSync().readAsArrayBuffer(e)));var n=new FileReader,s="function"===typeof n.readAsBinaryString;n.onloadend=function(n){var e=n.target.result||"";return s?t(e):void t(Ft(e))},s?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function Rt(e,t){Nt(e,function(e){t(e)})}function $t(e,t){Rt(e,function(e){t(ro(e))})}function Pt(e,t){if("undefined"===typeof FileReader)return t(new FileReaderSync().readAsArrayBuffer(e));var n=new FileReader;n.onloadend=function(n){var e=n.target.result||new ArrayBuffer(0);t(e)},n.readAsArrayBuffer(e)}function Bt(e){return ro(e)}function Mt(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function Ut(e,t,n,s,r){(0<n||s<t.size)&&(t=Mt(t,n,s)),Pt(t,function(t){e.append(t),r()})}function Wt(e,t,n,s,r){(0<n||s<t.length)&&(t=t.substring(n,s)),e.appendBinary(t),r()}function Ht(e,n){function r(){oo(a)}function o(){var e=p.end(!0),t=Bt(e);n(t),p.destroy()}function a(){var t=u*c,n=t+c;u++,u<l?h(p,e,t,n,r):h(p,e,t,n,o)}var i="string"===typeof e,d=i?e.length:e.size,c=t(ao,d),l=s(d/c),u=0,p=i?new cr:new cr.ArrayBuffer,h=i?Wt:Ut;a()}function zt(e){return cr.hash(e)}function Xt(e){try{return so(e)}catch(n){var t=N(Ar,"Attachment is not a valid base64 string");return{error:t}}}function Gt(e,t,n){var s=Xt(e.data);return s.error?n(s.error):void(e.length=s.length,e.data="blob"===t?Dt(s,e.content_type):"base64"===t?ro(s):s,Ht(s,function(t){e.digest="md5-"+t,n()}))}function Vt(e,t,n){Ht(e.data,function(s){e.digest="md5-"+s,e.length=e.data.size||e.data.length||0,"binary"===t?Rt(e.data,function(t){e.data=t,n()}):"base64"===t?$t(e.data,function(t){e.data=t,n()}):n()})}function Kt(e,t,n){return e.stub?n():void("string"===typeof e.data?Gt(e,t,n):Vt(e,t,n))}function Qt(e,t,n){function s(){r++,e.length===r&&(o?n(o):n())}if(!e.length)return n();var r=0,o;e.forEach(function(e){function n(e){o=e,a++,a===r.length&&s()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],a=0;if(!r.length)return s();for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&Kt(e.data._attachments[i],t,n)})}function Jt(e,t,n,s,r,o,a,i){if(he(t.rev_tree,n.metadata.rev))return s[r]=n,o();var d=t.winningRev||J(t),c="deleted"in t?t.deleted:ge(t,d),l="deleted"in n.metadata?n.metadata.deleted:ge(n.metadata),u=/^1-/.test(n.metadata.rev);if(c&&!l&&i&&u){var p=n.data;p._rev=d,p._id=n.metadata.id,n=Lt(p,i)}var h=pe(t.rev_tree,n.metadata.rev_tree[0],e),_=i&&(c&&l&&"new_leaf"!==h.conflicts||!c&&"new_leaf"!==h.conflicts||c&&!l&&"new_branch"===h.conflicts);if(_){var g=N(qr);return s[r]=g,o()}var m=n.metadata.rev;n.metadata.rev_tree=h.tree,n.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var f=J(n.metadata),y=ge(n.metadata,f),v=c===y?0:c<y?-1:1,b;b=m===f?y:ge(n.metadata,m),a(n,f,y,b,!0,v,r,o)}function Yt(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}function Zt(e,t,n,s,r,o,a,i,d){function c(e,t,n){var s=J(e.metadata),r=ge(e.metadata,s);if("was_delete"in i&&r)return o[t]=N(kr,"deleted"),n();var d=u&&Yt(e);if(d){var c=N(qr);return o[t]=c,n()}var l=r?0:1;a(e,s,r,r,!1,l,t,n)}function l(){++h===_&&d&&d()}e=e||1e3;var u=i.new_edits,p=new gr,h=0,_=t.length;t.forEach(function(e,t){if(e._id&&me(e._id)){var s=e._deleted?"_removeLocal":"_putLocal";return void n[s](e,{ctx:r},function(e,n){o[t]=e||n,l()})}var a=e.metadata.id;p.has(a)?(_--,p.get(a).push([e,t])):p.set(a,[[e,t]])}),p.forEach(function(t,n){function r(){++d<t.length?i():l()}function i(){var i=t[d],l=i[0],p=i[1];if(s.has(n))Jt(e,s.get(n),l,o,p,r,a,u);else{var h=pe([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=h.tree,l.stemmedRevs=h.stemmedRevs||[],c(l,p,r)}}var d=0;i()})}function en(e){try{return JSON.parse(e)}catch(t){return lr.parse(e)}}function tn(e){try{return JSON.stringify(e)}catch(t){return lr.stringify(e)}}function nn(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(N(Nr,n,t.type))}}function sn(e,t,n){return{data:tn(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function rn(e){if(!e)return null;var t=en(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function on(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function an(e,t,n,s){n?e?"string"===typeof e?s(It(e,t)):s(e):s(jt([""],{type:t})):e?"string"===typeof e?s(e):Nt(e,function(e){s(ro(e))}):s("")}function dn(e,t,n,s){function r(){++i===a.length&&s&&s()}function o(e,t){var s=e._attachments[t],o=s.digest,a=n.objectStore(uo).get(o);a.onsuccess=function(t){s.body=t.target.result.body,r()}}var a=Object.keys(e._attachments||{});if(!a.length)return s&&s();var i=0;a.forEach(function(n){t.attachments&&t.include_docs?o(e,n):(e._attachments[n].stub=!0,r())})}function cn(e,t){return ur.all(e.map(function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return ur.all(n.map(function(n){var s=e.doc._attachments[n];if("body"in s){var r=s.body,o=s.content_type;return new ur(function(a){an(r,o,t,function(t){e.doc._attachments[n]=vr(q(s,["digest","content_type"]),{data:t}),a()})})}}))}}))}function ln(e,t,n){function s(){c--,c||r()}function r(){o.length&&o.forEach(function(t){var e=d.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::\uFFFF",!1,!1));e.onsuccess=function(n){var e=n.target.result;e||i["delete"](t)}})}var o=[],a=n.objectStore(lo),i=n.objectStore(uo),d=n.objectStore(po),c=e.length;e.forEach(function(e){var n=a.index("_doc_id_rev");n.getKey(t+"::"+e).onsuccess=function(t){var e=t.target.result;if("number"!==typeof e)return s();a["delete"](e);var n=d.index("seq").openCursor(IDBKeyRange.only(e));n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];o.push(n),d["delete"](t.primaryKey),t["continue"]()}else s()}}})}function un(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}function pn(e,t,n,s,r,o){function a(){var e=un(r,[co,lo,uo,_o,po,ho],"readwrite");return e.error?o(e.error):void(k=e.txn,k.onabort=nn(o),k.ontimeout=nn(o),k.oncomplete=p,q=k.objectStore(co),S=k.objectStore(lo),w=k.objectStore(uo),C=k.objectStore(po),x=k.objectStore(ho),x.get(ho).onsuccess=function(t){A=t.target.result,l()},_(function(e){return e?(F=!0,o(e)):void u()}))}function d(){j=!0,l()}function c(){Zt(e.revs_limit,b,s,I,k,D,g,n,d)}function l(){A&&j&&(A.docCount+=O,x.put(A))}function u(){function e(){++n===b.length&&c()}function t(t){var n=rn(t.target.result);n&&I.set(n.id,n),e()}if(b.length)for(var n=0,s=0,r=b.length,o;s<r;s++){if(o=b[s],o._id&&me(o._id)){e();continue}var a=q.get(o.metadata.id);a.onsuccess=t}}function p(){F||(mo.notify(s._meta.name),o(null,D))}function h(e,t){var n=w.get(e);n.onsuccess=function(n){if(!n.target.result){var s=N(Ur,"unknown stub attachment with digest "+e);s.status=412,t(s)}else t()}}function _(e){function t(){++s===n.length&&e(r)}var n=[];if(b.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var s=e.data._attachments[t];s.stub&&n.push(s.digest)})}),!n.length)return e();var s=0,r;n.forEach(function(e){h(e,function(e){e&&!r&&(r=e),t()})})}function g(e,t,n,s,r,o,a,i){e.metadata.winningRev=t,e.metadata.deleted=n;var d=e.data;d._id=e.metadata.id,d._rev=e.metadata.rev,s&&(d._deleted=!0);var c=d._attachments&&Object.keys(d._attachments).length;return c?f(e,t,n,r,a,i):void(O+=o,l(),m(e,t,n,r,a,i))}function m(t,n,r,o,e,a){function i(a){var e=t.stemmedRevs||[];o&&s.auto_compaction&&(e=e.concat(ne(t.metadata))),e&&e.length&&ln(e,t.metadata.id,k),l.seq=a.target.result;var i=sn(l,n,r),c=q.put(i);c.onsuccess=d}function d(){D[e]={ok:!0,id:l.id,rev:l.rev},I.set(t.metadata.id,t.metadata),y(t,l.seq,a)}var c=t.data,l=t.metadata;c._doc_id_rev=l.id+"::"+l.rev,delete c._id,delete c._rev;var u=S.put(c);u.onsuccess=i,u.onerror=function(t){t.preventDefault(),t.stopPropagation();var e=S.index("_doc_id_rev"),n=e.getKey(c._doc_id_rev);n.onsuccess=function(t){var e=S.put(c,t.target.result);e.onsuccess=i}}}function f(e,t,n,s,r,o){function a(){c===l.length&&m(e,t,n,s,r,o)}function i(){c++,a()}var d=e.data,c=0,l=Object.keys(d._attachments);l.forEach(function(n){var s=e.data._attachments[n];if(!s.stub){var r=s.data;delete s.data,s.revpos=parseInt(t,10);var o=s.digest;v(o,r,i)}else c++,a()})}function y(e,t,n){function s(){++o===a.length&&n()}function r(n){var r=e.data._attachments[n].digest,o=C.put({seq:t,digestSeq:r+"::"+t});o.onsuccess=s,o.onerror=function(t){t.preventDefault(),t.stopPropagation(),s()}}var o=0,a=Object.keys(e.data._attachments||{});if(!a.length)return n();for(var d=0;d<a.length;d++)r(a[d])}function v(t,n,s){var e=w.count(t);e.onsuccess=function(r){var e=r.target.result;if(e)return s();var o=w.put({digest:t,body:n});o.onsuccess=s}}for(var b=t.docs,E=0,i=b.length,k,q,S,w,C,x,T,A,L;E<i;E++)(L=b[E],!(L._id&&me(L._id)))&&(L=b[E]=Lt(L,n.new_edits),L.error&&!T&&(T=L));if(T)return o(T);var j=!1,O=0,D=Array(b.length),I=new gr,F=!1,R=s._meta.blobSupport?"blob":"base64";Qt(b,R,function(e){return e?o(e):void a()})}function hn(e,t,n,s,r){function o(t){l=t.target.result,c&&r(c,l,u)}function a(t){c=t.target.result,l&&r(c,l,u)}function i(t){var e=t.target.result;return e?void r([e.key],[e.value],e):r()}var d="function"===typeof e.getAll&&"function"===typeof e.getAllKeys&&1<s&&!n,c,l,u;d?(u={continue:function(){if(!c.length)return r();var n=c[c.length-1],i;if(t&&t.upper)try{i=IDBKeyRange.bound(n,t.upper,!0,t.upperOpen)}catch(t){if("DataError"===t.name&&0===t.code)return r()}else i=IDBKeyRange.lowerBound(n,!0);t=i,c=null,l=null,e.getAll(t,s).onsuccess=o,e.getAllKeys(t,s).onsuccess=a}},e.getAll(t,s).onsuccess=o,e.getAllKeys(t,s).onsuccess=a):n?e.openCursor(t,"prev").onsuccess=i:e.openCursor(t).onsuccess=i}function _n(e,t,n){if("function"===typeof e.getAll)return void(e.getAll(t).onsuccess=n);var s=[];e.openCursor(t).onsuccess=function(t){var e=t.target.result;e?(s.push(e.value),e["continue"]()):n({target:{result:s}})}}function gn(e,t,n){var s=[],r=0;e.forEach(function(o,a){t.get(o).onsuccess=function(t){s[a]=t.target.result?t.target.result:{key:o,error:"not_found"},r++,r===e.length&&n(e,s,{})}})}function mn(e,t,n,s,r){try{if(e&&t)return r?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return r?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return r?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(s)return IDBKeyRange.only(s)}catch(t){return{error:t}}return null}function fn(t,e,n){function s(e,n,s){var r=e.id+"::"+s;q.get(r).onsuccess=function(s){if(n.doc=on(s.target.result),t.conflicts){var r=te(e);r.length&&(n.doc._conflicts=r)}dn(n.doc,t,v)}}function r(e,n){var r={id:n.id,key:n.id,value:{rev:e}},o=n.deleted;o?u&&(S.push(r),r.value.deleted=!0,r.doc=null):0>=p--&&(S.push(r),t.include_docs&&s(n,r,e))}function o(e){for(var t=0,n=e.length,s;t<n&&S.length!==h;t++){if(s=e[t],s.error&&u){S.push(s);continue}var o=rn(s),a=o.winningRev;r(a,o)}}function a(e,t,n){n&&(o(t),S.length<h&&n["continue"]())}function i(){var e={total_rows:w,offset:t.skip,rows:S};t.update_seq&&void 0!==C&&(e.update_seq=C),n(null,e)}var d=!!("startkey"in t)&&t.startkey,c=!!("endkey"in t)&&t.endkey,l=!!("key"in t)&&t.key,u=!!("keys"in t)&&t.keys,p=t.skip||0,h="number"===typeof t.limit?t.limit:-1,_=!1!==t.inclusive_end,g,m;if(!u&&(g=mn(d,c,_,l,t.descending),m=g&&g.error,m&&("DataError"!==m.name||0!==m.code)))return n(N(Nr,m.name,m.message));var f=[co,lo,ho];t.attachments&&f.push(uo);var y=un(e,f,"readonly");if(y.error)return n(y.error);var v=y.txn;v.oncomplete=function(){t.attachments?cn(S,t.binary).then(i):i()},v.onabort=nn(n);var b=v.objectStore(co),E=v.objectStore(lo),k=v.objectStore(ho),q=E.index("_doc_id_rev"),S=[],w,C;return k.get(ho).onsuccess=function(t){w=t.target.result.docCount},t.update_seq&&function(e,t){e.openCursor(null,"prev").onsuccess=function(n){var e=n.target.result,s;return e&&e.key&&(s=e.key),t({target:{result:[s]}})}}(E,function(t){t.target.result&&0<t.target.result.length&&(C=t.target.result[0])}),m||0===h?void 0:u?gn(t.keys,b,a):-1===h?_n(b,g,function(n){var e=n.target.result;t.descending&&(e=e.reverse()),o(e)}):void hn(b,g,t.descending,h+p,a)}function yn(e){return new ur(function(t){var n=jt([""]),s=e.objectStore(go).put(n,"key");s.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||43<=parseInt(e[1],10))},e.onabort=function(n){n.preventDefault(),n.stopPropagation(),t(!1)}})["catch"](function(){return!1})}function vn(e,t){var n=e.objectStore(co).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(n){t(n.target.result)}}function bn(e,t,n,s){try{e(t,n)}catch(e){s.emit("error",e)}}function En(){fo||!yo.length||(fo=!0,yo.shift()())}function kn(e,t,n){yo.push(function(){e(function(e,s){bn(t,e,s,n),fo=!1,rr(function(){En(n)})})}),En()}function qn(e,t,n,s){function r(e,t,n,s){if(n.seq!==t)return s();if(n.winningRev===e._rev)return s(n,e);var r=e._id+"::"+n.winningRev,o=E.get(r);o.onsuccess=function(t){s(n,on(t.target.result))}}function o(t,n,s){if(d&&!d.has(t._id))return s();var o=m.get(t._id);return o?r(t,n,o,s):void(b.get(t._id).onsuccess=function(a){o=rn(a.target.result),m.set(t._id,o),r(t,n,o,s)})}function a(){e.complete(null,{results:p,last_seq:c})}if(e=_(e),e.continuous){var i=n+":"+Vr();return mo.addListener(n,i,t,e),mo.notify(n),{cancel:function(){mo.removeListener(n,i)}}}var d=e.doc_ids&&new _r(e.doc_ids);e.since=e.since||0;var c=e.since,l="limit"in e?e.limit:-1;0===l&&(l=1);var u="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var p=[],h=0,g=P(e),m=new gr,f=[co,lo],y,v,b,E;e.attachments&&f.push(uo);var k=un(s,f,"readonly");if(k.error)return e.complete(k.error);y=k.txn,y.onabort=nn(e.complete),y.oncomplete=function(){!e.continuous&&e.attachments?cn(p).then(a):a()},v=y.objectStore(lo),b=y.objectStore(co),E=v.index("_doc_id_rev");var q=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;hn(v,q,e.descending,l,function(t,n,s){function r(t,n){var s=e.processChange(n,t,e);c=s.seq=t.seq;var r=g(s);return"object"===typeof r?e.complete(r):void(r&&(h++,u&&p.push(s),e.attachments&&e.include_docs?dn(n,e,y,function(){cn([s],e.binary).then(function(){e.onChange(s)})}):e.onChange(s)))}function a(){for(var e=0,t=d.length,n;e<t&&h!==l;e++)if(n=d[e],n){var o=_[e];r(o,n)}h!==l&&s["continue"]()}if(s&&t.length){var d=Array(t.length),_=Array(t.length),m=0;n.forEach(function(e,n){var s=on(e),r=t[n];o(s,r,function(e,s){_[n]=e,d[n]=s,++m===t.length&&a()})})}})}function Sn(e,t){var n=this;kn(function(t){wn(n,e,t)},t,n.constructor)}function wn(e,t,n){function s(e){var t=e.createObjectStore(co,{keyPath:"id"});e.createObjectStore(lo,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(uo,{keyPath:"digest"}),e.createObjectStore(ho,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(go),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(_o,{keyPath:"_id"});var n=e.createObjectStore(po,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}function r(e,t){var n=e.objectStore(co);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var s=e.target.result;if(s){var r=s.value,o=ge(r);r.deletedOrLocal=o?"1":"0",n.put(r),s["continue"]()}else t()}}function o(e){e.createObjectStore(_o,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function a(e,t){var n=e.objectStore(_o),s=e.objectStore(co),r=e.objectStore(lo),o=s.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var a=o.value,i=a.id,d=me(i),c=J(a);if(d){var l=r.index("_doc_id_rev"),u=IDBKeyRange.bound(i+"::",i+"::~",!1,!1),p=l.openCursor(u);p.onsuccess=function(t){if(p=t.target.result,!p)s["delete"](o.primaryKey),o["continue"]();else{var e=p.value;e._doc_id_rev===i+"::"+c&&n.put(e),r["delete"](p.primaryKey),p["continue"]()}}}else o["continue"]()}else t&&t()}}function d(e){var t=e.createObjectStore(po,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function c(e,t){var n=e.objectStore(lo),s=e.objectStore(uo),r=e.objectStore(po),o=s.count();o.onsuccess=function(s){var e=s.target.result;return e?void(n.openCursor().onsuccess=function(n){var e=n.target.result;if(!e)return t();for(var s=e.value,o=e.primaryKey,a=Object.keys(s._attachments||{}),i={},d=0,c;d<a.length;d++)c=s._attachments[a[d]],i[c.digest]=!0;var l=Object.keys(i);for(d=0;d<l.length;d++){var u=l[d];r.put({seq:o,digestSeq:u+"::"+o})}e["continue"]()}):t()}}function l(e){function t(e){return e.data?rn(e):(e.deleted="1"===e.deletedOrLocal,e)}var n=e.objectStore(lo),s=e.objectStore(co),r=s.openCursor();r.onsuccess=function(r){function e(){var e=i.id+"::",t=i.id+"::\uFFFF",s=n.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,t)),r=0;s.onsuccess=function(t){var e=t.target.result;if(!e)return i.seq=r,o();var n=e.primaryKey;n>r&&(r=n),e["continue"]()}}function o(){var e=sn(i,i.winningRev,i.deleted),t=s.put(e);t.onsuccess=function(){a["continue"]()}}var a=r.target.result;if(a){var i=t(a.value);return i.winningRev=i.winningRev||J(i),i.seq?o():void e()}}}var i=t.name,u=null;e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=m(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(n,s,r){pn(t,n,s,e,u,r)},e._get=function(e,t,n){function s(){n(i,{doc:o,metadata:a,ctx:r})}var r=t.ctx,o,a,i;if(!r){var d=un(u,[co,lo,uo],"readonly");if(d.error)return n(d.error);r=d.txn}r.objectStore(co).get(e).onsuccess=function(n){if(a=rn(n.target.result),!a)return i=N(kr,"missing"),s();var e;if(!t.rev){e=a.winningRev;var d=ge(a);if(d)return i=N(kr,"deleted"),s()}else e=t.latest?fe(t.rev,a):t.rev;var c=r.objectStore(lo),l=a.id+"::"+e;c.index("_doc_id_rev").get(l).onsuccess=function(t){return o=t.target.result,o&&(o=on(o)),o?void s():(i=N(kr,"missing"),s())}}},e._getAttachment=function(e,t,n,s,r){var o;if(s.ctx)o=s.ctx;else{var a=un(u,[co,lo,uo],"readonly");if(a.error)return r(a.error);o=a.txn}var i=n.digest,d=n.content_type;o.objectStore(uo).get(i).onsuccess=function(t){var e=t.target.result.body;an(e,d,s.binary,function(e){r(null,e)})}},e._info=function(t){var n=un(u,[ho,lo],"readonly"),s,r;if(n.error)return t(n.error);var o=n.txn;o.objectStore(ho).get(ho).onsuccess=function(t){r=t.target.result.docCount},o.objectStore(lo).openCursor(null,"prev").onsuccess=function(t){var e=t.target.result;s=e?e.key:0},o.oncomplete=function(){t(null,{doc_count:r,update_seq:s,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){fn(e,u,t)},e._changes=function(t){return qn(t,e,i,u)},e._close=function(e){u.close(),vo["delete"](i),e()},e._getRevisionTree=function(e,t){var n=un(u,[co],"readonly");if(n.error)return t(n.error);var s=n.txn,r=s.objectStore(co).get(e);r.onsuccess=function(e){var n=rn(e.target.result);n?t(null,n.rev_tree):t(N(kr))}},e._doCompaction=function(e,t,n){var s=un(u,[co,lo,uo,po],"readwrite");if(s.error)return n(s.error);var r=s.txn,o=r.objectStore(co);o.get(e).onsuccess=function(n){var s=rn(n.target.result);Y(s.rev_tree,function(e,n,s,r,o){-1!==t.indexOf(n+"-"+s)&&(o.status="missing")}),ln(t,e,r);var o=s.winningRev,a=s.deleted;r.objectStore(co).put(sn(s,o,a))},r.onabort=nn(n),r.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=un(u,[_o],"readonly");if(n.error)return t(n.error);var s=n.txn,r=s.objectStore(_o).get(e);r.onerror=nn(t),r.onsuccess=function(n){var e=n.target.result;e?(delete e._doc_id_rev,t(null,e)):t(N(kr))}},e._putLocal=function(e,t,n){"function"===typeof t&&(n=t,t={}),delete e._revisions;var s=e._rev,r=e._id;e._rev=s?"0-"+(parseInt(s.split("-")[1],10)+1):"0-1";var o=t.ctx,a;if(!o){var i=un(u,[_o],"readwrite");if(i.error)return n(i.error);o=i.txn,o.onerror=nn(n),o.oncomplete=function(){a&&n(null,a)}}var d=o.objectStore(_o),c;s?(c=d.get(r),c.onsuccess=function(r){var o=r.target.result;if(!o||o._rev!==s)n(N(qr));else{var i=d.put(e);i.onsuccess=function(){a={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,a)}}}):(c=d.add(e),c.onerror=function(t){n(N(qr)),t.preventDefault(),t.stopPropagation()},c.onsuccess=function(){a={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,a)})},e._removeLocal=function(t,n,s){"function"===typeof n&&(s=n,n={});var e=n.ctx;if(!e){var r=un(u,[_o],"readwrite");if(r.error)return s(r.error);e=r.txn,e.oncomplete=function(){d&&s(null,d)}}var o=t._id,a=e.objectStore(_o),i=a.get(o),d;i.onerror=nn(s),i.onsuccess=function(r){var e=r.target.result;e&&e._rev===t._rev?(a["delete"](o),d={ok:!0,id:o,rev:"0-0"},n.ctx&&s(null,d)):s(N(kr))}},e._destroy=function(e,t){mo.removeAllListeners(i);var n=bo.get(i);n&&n.result&&(n.result.close(),vo["delete"](i));var s=indexedDB.deleteDatabase(i);s.onsuccess=function(){bo["delete"](i),T()&&i in localStorage&&delete localStorage[i],t(null,{ok:!0})},s.onerror=nn(t)};var p=vo.get(i);if(p)return u=p.idb,e._meta=p.global,rr(function(){n(null,e)});var h;h=t.storage?Cn(i,t.storage):indexedDB.open(i,io),bo.set(i,h),h.onupgradeneeded=function(t){function e(){var t=p[h-1];h++,t&&t(u,e)}var n=t.target.result;if(1>t.oldVersion)return s(n);var u=t.currentTarget.transaction;3>t.oldVersion&&o(n),4>t.oldVersion&&d(n);var p=[r,a,c,l],h=t.oldVersion;e()},h.onsuccess=function(t){function s(){"undefined"!==typeof l&&a&&(e._meta={name:i,instanceId:p,blobSupport:l},vo.set(i,{idb:u,global:e._meta}),n(null,e))}function r(){if("undefined"!==typeof c&&"undefined"!==typeof d){var e=i+"_id";e in d?p=d[e]:d[e]=p=Vr(),d.docCount=c,o.objectStore(ho).put(d)}}u=t.target.result,u.onversionchange=function(){u.close(),vo["delete"](i)},u.onabort=function(t){j("error","Database has a global failure",t.target.error),u.close(),vo["delete"](i)};var o=u.transaction([ho,go,co],"readwrite"),a=!1,d,c,l,p;o.objectStore(ho).get(ho).onsuccess=function(t){d=t.target.result||{id:ho},r()},vn(o,function(e){c=e,r()}),Eo||(Eo=yn(o)),Eo.then(function(e){l=e,s()}),o.oncomplete=function(){a=!0,s()},o.onabort=nn(n)},h.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";j("error",e),n(N(Nr,e))}}function Cn(e,t){try{return indexedDB.open(e,{version:io,storage:t})}catch(t){return indexedDB.open(e,io)}}function xn(e){return decodeURIComponent(escape(e))}function Tn(e){return 65>e?e-48:e-55}function An(t,n,s){for(var r="";n<s;)r+=e(Tn(t.charCodeAt(n++))<<4|Tn(t.charCodeAt(n++)));return r}function Ln(t,n,s){for(var r="";n<s;)r+=e(Tn(t.charCodeAt(n+2))<<12|Tn(t.charCodeAt(n+3))<<8|Tn(t.charCodeAt(n))<<4|Tn(t.charCodeAt(n+1))),n+=4;return r}function jn(e,t){return"UTF-8"===t?xn(An(e,0,e.length)):Ln(e,0,e.length)}function On(e){return"'"+e+"'"}function Dn(e){return e.replace(/\u0002/g,"\x02\x02").replace(/\u0001/g,"\x01\x02").replace(/\u0000/g,"\x01\x01")}function In(e){return e.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"\x01").replace(/\u0002\u0002/g,"\x02")}function Fn(e){return delete e._id,delete e._rev,JSON.stringify(e)}function Nn(e,t,n){return e=JSON.parse(e),e._id=t,e._rev=n,e}function Rn(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function $n(e,t,n,s,r){return"SELECT "+e+" FROM "+("string"===typeof t?t:t.join(" JOIN "))+(n?" ON "+n:"")+(s?" WHERE "+("string"===typeof s?s:s.join(" AND ")):"")+(r?" ORDER BY "+r:"")}function Pn(e,t,n){function s(){++o===e.length&&r()}function r(){if(a.length){var e="SELECT DISTINCT digest AS digest FROM "+To+" WHERE seq IN "+Rn(a.length);n.executeSql(e,a,function(e,t){for(var n=[],s=0;s<t.rows.length;s++)n.push(t.rows.item(s).digest);if(n.length){var r="DELETE FROM "+To+" WHERE seq IN ("+a.map(function(){return"?"}).join(",")+")";e.executeSql(r,a,function(e){var t="SELECT digest FROM "+To+" WHERE digest IN ("+n.map(function(){return"?"}).join(",")+")";e.executeSql(t,n,function(e,t){for(var s=new _r,r=0;r<t.rows.length;r++)s.add(t.rows.item(r).digest);n.forEach(function(t){s.has(t)||(e.executeSql("DELETE FROM "+To+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+wo+" WHERE digest=?",[t]))})})})}})}}if(e.length){var o=0,a=[];e.forEach(function(e){n.executeSql("SELECT seq FROM "+So+" WHERE doc_id=? AND rev=?",[t,e],function(e,t){if(!t.rows.length)return s();var n=t.rows.item(0).seq;a.push(n),e.executeSql("DELETE FROM "+So+" WHERE seq=?",[n],s)})})}}function Bn(e){return function(t){j("error","WebSQL threw an error",t);var n=t&&t.constructor.toString().match(/function ([^(]+)/),s=n&&n[1]||t.type,r=t.target||t.message;e(N(Rr,r,s))}}function Mn(e){if("size"in e)return 1e6*e.size;var t="undefined"!==typeof navigator&&/Android/.test(navigator.userAgent);return t?5e6:1}function Un(e,t,n,s,r,o,a){function i(){return E?a(E):void(o.notify(s._name),a(null,y))}function d(e,t){b.executeSql("SELECT count(*) as cnt FROM "+wo+" WHERE digest=?",[e],function(n,s){if(0===s.rows.item(0).cnt){var r=N(Ur,"unknown stub attachment with digest "+e);t(r)}else t()})}function c(e){function t(){++s===n.length&&e(r)}var n=[];if(m.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var s=e.data._attachments[t];s.stub&&n.push(s.digest)})}),!n.length)return e();var s=0,r;n.forEach(function(e){d(e,function(e){e&&!r&&(r=e),t()})})}function l(e,t,n,r,o,a,i,d){function c(){function t(e,t){function s(){return++o===a.length&&t(),!1}function r(t){var r=[n._attachments[t].digest,e];b.executeSql("INSERT INTO "+To+" (digest, seq) VALUES (?,?)",r,s,s)}var o=0,a=Object.keys(n._attachments||{});if(!a.length)return t();for(var d=0;d<a.length;d++)r(a[d])}var n=e.data,s=r?1:0,o=n._id,a=n._rev,i=Fn(n);b.executeSql("INSERT INTO "+So+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",[o,a,i,s],function(e,n){var s=n.insertId;t(s,function(){p(e,s)})},function(){var e=$n("seq",So,null,"doc_id=? AND rev=?");return b.executeSql(e,[o,a],function(e,n){var r=n.rows.item(0).seq;e.executeSql("UPDATE "+So+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",[i,s,o,a],function(e){t(r,function(){p(e,r)})})}),!1})}function l(e){_||(e?(_=e,d(_)):g===m.length&&c())}function u(e){g++,l(e)}function p(n,r){var a=e.metadata.id,c=e.stemmedRevs||[];o&&s.auto_compaction&&(c=ne(e.metadata).concat(c)),c.length&&Pn(c,a,n),e.metadata.seq=r;var l=e.metadata.rev;delete e.metadata.rev;var u=o?"UPDATE "+qo+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+So+" WHERE doc_id="+qo+".id AND rev=?) WHERE id=?":"INSERT INTO "+qo+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",p=tn(e.metadata),h=o?[p,r,t,a]:[a,r,r,p];n.executeSql(u,h,function(){y[i]={ok:!0,id:e.metadata.id,rev:l},v.set(a,e.metadata),d()})}var _=null,g=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var m=Object.keys(e.data._attachments||{});r&&(e.data._deleted=!0),m.forEach(function(n){var s=e.data._attachments[n];if(!s.stub){var r=s.data;delete s.data,s.revpos=parseInt(t,10);var o=s.digest;h(o,r,u)}else g++,l()}),m.length||c()}function u(){Zt(e.revs_limit,m,s,v,b,y,l,n)}function p(e){function t(){++n===m.length&&e()}if(!m.length)return e();var n=0;m.forEach(function(e){if(e._id&&me(e._id))return t();var n=e.metadata.id;b.executeSql("SELECT json FROM "+qo+" WHERE id = ?",[n],function(e,s){if(s.rows.length){var r=en(s.rows.item(0).json);v.set(n,r)}t()})})}function h(e,t,n){var s="SELECT digest FROM "+wo+" WHERE digest=?";b.executeSql(s,[e],function(r,o){return o.rows.length?n():void(s="INSERT INTO "+wo+" (digest, body, escaped) VALUES (?,?,1)",r.executeSql(s,[e,Dn(t)],function(){n()},function(){return n(),!1}))})}var _=n.new_edits,g=t.docs,m=g.map(function(e){if(e._id&&me(e._id))return e;var t=Lt(e,_);return t}),f=m.filter(function(e){return e.error});if(f.length)return a(f[0]);var y=Array(m.length),v=new gr,b,E;Qt(m,"binary",function(e){return e?a(e):void r.transaction(function(e){b=e,c(function(e){e?E=e:p(u)})},Bn(a),i)})}function Wn(e){return e.websql(e.name,e.version,e.description,e.size)}function Hn(e){try{return{db:Wn(e)}}catch(e){return{error:e}}}function zn(e){var t=Ao.get(e.name);return t||(t=Hn(e),Ao.set(e.name,t)),t}function Xn(e,t,n,s,r){function o(){++d===i.length&&r&&r()}function a(e,r){var a=e._attachments[r],i={binary:t.binary,ctx:s};n._getAttachment(e._id,r,a,i,function(t,n){e._attachments[r]=vr(q(a,["digest","content_type"]),{data:n}),o()})}var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var d=0;i.forEach(function(n){t.attachments&&t.include_docs?a(e,n):(e._attachments[n].stub=!0,o())})}function Gn(e,t){function n(){T()&&(window.localStorage["_pouch__websqldb_"+y._name]=!0),t(null,y)}function s(e,t){e.executeSql(Io),e.executeSql("ALTER TABLE "+So+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(Oo),e.executeSql("ALTER TABLE "+qo+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+qo+" (local, id)");e.executeSql("SELECT "+qo+".winningseq AS seq, "+qo+".json AS metadata FROM "+So+" JOIN "+qo+" ON "+So+".seq = "+qo+".winningseq",[],function(e,n){for(var s=[],r=[],o=0;o<n.rows.length;o++){var a=n.rows.item(o),i=a.seq,d=JSON.parse(a.metadata);ge(d)&&s.push(i),me(d.id)&&r.push(d.id)}e.executeSql("UPDATE "+qo+"SET local = 1 WHERE id IN "+Rn(r.length),r,function(){e.executeSql("UPDATE "+So+" SET deleted = 1 WHERE seq IN "+Rn(s.length),s,t)})})})})}function r(e,t){e.executeSql("CREATE TABLE IF NOT EXISTS "+Co+" (id UNIQUE, rev, json)",[],function(){e.executeSql("SELECT "+qo+".id AS id, "+So+".json AS data FROM "+So+" JOIN "+qo+" ON "+So+".seq = "+qo+".winningseq WHERE local = 1",[],function(e,n){function s(){if(!r.length)return t(e);var n=r.shift(),o=JSON.parse(n.data)._rev;e.executeSql("INSERT INTO "+Co+" (id, rev, json) VALUES (?,?,?)",[n.id,o,n.data],function(e){e.executeSql("DELETE FROM "+qo+" WHERE id=?",[n.id],function(e){e.executeSql("DELETE FROM "+So+" WHERE seq=?",[n.seq],function(){s()})})})}for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o));s()})})}function o(e,t){function n(n){function s(){if(!n.length)return t(e);var r=n.shift(),o=jn(r.hex,k),a=o.lastIndexOf("::"),i=o.substring(0,a),d=o.substring(a+2);e.executeSql("UPDATE "+So+" SET doc_id=?, rev=? WHERE doc_id_rev=?",[i,d,o],function(){s()})}s()}e.executeSql("ALTER TABLE "+So+" ADD COLUMN doc_id",[],function(e){e.executeSql("ALTER TABLE "+So+" ADD COLUMN rev",[],function(e){e.executeSql(Do,[],function(e){e.executeSql("SELECT hex(doc_id_rev) as hex FROM "+So,[],function(e,t){for(var s=[],r=0;r<t.rows.length;r++)s.push(t.rows.item(r));n(s)})})})})}function a(e,t){function n(e){e.executeSql("SELECT COUNT(*) AS cnt FROM "+wo,[],function(e,n){function s(){var n=$n($o+", "+qo+".id AS id",[qo,So],Ro,null,qo+".id ");n+=" LIMIT "+a+" OFFSET "+o,o+=a,e.executeSql(n,[],function(e,n){function r(e,t){var n=o[e]=o[e]||[];-1===n.indexOf(t)&&n.push(t)}if(!n.rows.length)return t(e);for(var o={},a=0;a<n.rows.length;a++)for(var i=n.rows.item(a),d=Nn(i.data,i.id,i.rev),c=Object.keys(d._attachments||{}),l=0,u;l<c.length;l++)u=d._attachments[c[l]],r(u.digest,i.seq);var p=[];if(Object.keys(o).forEach(function(e){var t=o[e];t.forEach(function(t){p.push([e,t])})}),!p.length)return s();var h=0;p.forEach(function(t){e.executeSql("INSERT INTO "+To+" (digest, seq) VALUES (?,?)",t,function(){++h===p.length&&s()})})})}var r=n.rows.item(0).cnt;if(!r)return t(e);var o=0,a=10;s()})}e.executeSql("CREATE TABLE IF NOT EXISTS "+To+" (digest, seq INTEGER)",[],function(e){e.executeSql(No,[],function(e){e.executeSql(Fo,[],n)})})}function d(e,t){e.executeSql("ALTER TABLE "+wo+" ADD COLUMN escaped TINYINT(1) DEFAULT 0",[],t)}function c(e,t){e.executeSql("ALTER TABLE "+qo+" ADD COLUMN max_seq INTEGER",[],function(e){e.executeSql("UPDATE "+qo+" SET max_seq=(SELECT MAX(seq) FROM "+So+" WHERE doc_id=id)",[],function(e){e.executeSql("CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+qo+" (max_seq)",[],t)})})}function i(e,t){e.executeSql("SELECT HEX(\"a\") AS hex",[],function(e,n){var s=n.rows.item(0).hex;k=2===s.length?"UTF-8":"UTF-16",t()})}function l(){for(;0<E.length;){var e=E.pop();e(null,v)}}function u(e,t){if(0===t){e.executeSql("CREATE TABLE IF NOT EXISTS "+wo+" (digest UNIQUE, escaped TINYINT(1), body BLOB)"),e.executeSql("CREATE TABLE IF NOT EXISTS "+Co+" (id UNIQUE, rev, json)"),e.executeSql("CREATE TABLE IF NOT EXISTS "+To+" (digest, seq INTEGER)",[],function(){e.executeSql(Fo),e.executeSql(No)}),e.executeSql("CREATE TABLE IF NOT EXISTS "+qo+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",[],function(){e.executeSql(Io),e.executeSql("CREATE TABLE IF NOT EXISTS "+So+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",[],function(){e.executeSql(Oo),e.executeSql(Do),e.executeSql("CREATE TABLE IF NOT EXISTS "+xo+" (dbid, db_version INTEGER)",[],function(){v=Vr();var t=[ko,v];e.executeSql("INSERT INTO "+xo+" (db_version, dbid) VALUES (?,?)",t,function(){l()})})})})}else{var n=function(){t<ko&&e.executeSql("UPDATE "+xo+" SET db_version = "+ko);e.executeSql("SELECT dbid FROM "+xo,[],function(e,t){v=t.rows.item(0).dbid,l()})},u=[s,r,o,a,d,c,n],p=t,i=function(e){u[p-1](e,i),p++};i(e)}}function p(e){e.executeSql("SELECT sql FROM sqlite_master WHERE tbl_name = "+xo,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+xo,[],function(e,t){var n=t.rows.item(0).db_version;u(e,n)}):e.executeSql("ALTER TABLE "+xo+" ADD COLUMN db_version INTEGER",[],function(){u(e,1)}):u(e,0)})}function h(e,t){e.executeSql("SELECT MAX(seq) AS seq FROM "+So,[],function(e,n){var s=n.rows.item(0).seq||0;t(s)})}function g(e,t){var n=$n("COUNT("+qo+".id) AS 'num'",[qo,So],Ro,So+".deleted=0");e.executeSql(n,[],function(e,n){t(n.rows.item(0).num)})}function f(e,t,n,s,r){var o=$n($o,[qo,So],Ro,qo+".id=?");e.executeSql(o,[t],function(e,t){if(!t.rows.length){var o=N(kr,"missing");return r(o)}var a=t.rows.item(0),i=en(a.metadata);s(fe(n,i))})}var y=this,v=null,b=Mn(e),E=[],k;y._name=e.name;var q=vr({},e,{version:jo,description:e.name,size:b}),S=zn(q);if(S.error)return Bn(t)(S.error);var w=S.db;"function"!==typeof w.readTransaction&&(w.readTransaction=w.transaction),function(){w.transaction(function(e){i(e,function(){p(e)})},Bn(t),n)}(),y._remote=!1,y.type=function(){return"websql"},y._id=m(function(e){e(null,v)}),y._info=function(e){var t,n;w.readTransaction(function(e){h(e,function(e){t=e}),g(e,function(e){n=e})},Bn(e),function(){e(null,{doc_count:n,update_seq:t,websql_encoding:k})})},y._bulkDocs=function(t,n,s){Un(e,t,n,y,w,Lo,s)},y._get=function(e,t,n){function s(e){n(e,{doc:o,metadata:i,ctx:r})}var r=t.ctx,o,i;if(!r)return w.readTransaction(function(s){y._get(e,vr({ctx:s},t),n)});var a,d;if(!t.rev)a=$n($o,[qo,So],Ro,qo+".id=?"),d=[e];else{if(t.latest)return void f(r,e,t.rev,function(s){t.latest=!1,t.rev=s,y._get(e,t,n)},s);a=$n($o,[qo,So],qo+".id="+So+".doc_id",[So+".doc_id=?",So+".rev=?"]),d=[e,t.rev]}r.executeSql(a,d,function(e,n){if(!n.rows.length){var r=N(kr,"missing");return s(r)}var a=n.rows.item(0);if(i=en(a.metadata),a.deleted&&!t.rev){var d=N(kr,"deleted");return s(d)}o=Nn(a.data,i.id,a.rev),s()})},y._allDocs=function(e,t){var n=[],s=!!("startkey"in e)&&e.startkey,r=!!("endkey"in e)&&e.endkey,o=!!("key"in e)&&e.key,a=!!("keys"in e)&&e.keys,i=!!("descending"in e)&&e.descending,d="limit"in e?e.limit:-1,c="skip"in e?e.skip:0,l=!1!==e.inclusive_end,u=[],p=[],_,m;if(a){var f=[],v="";a.forEach(function(e){-1===f.indexOf(e)&&(f.push(e),v+="?,")}),v=v.substring(0,v.length-1),p.push(qo+".id IN ("+v+")"),u=u.concat(f)}else if(!1!==o)p.push(qo+".id = ?"),u.push(o);else if(!1!==s||!1!==r){if(!1!==s&&(p.push(qo+".id "+(i?"<=":">=")+" ?"),u.push(s)),!1!==r){var b=i?">":"<";l&&(b+="="),p.push(qo+".id "+b+" ?"),u.push(r)}!1!==o&&(p.push(qo+".id = ?"),u.push(o))}a||p.push(So+".deleted = 0"),w.readTransaction(function(t){if(g(t,function(e){_=e}),e.update_seq&&h(t,function(e){m=e}),0!==d){var s=$n($o,[qo,So],Ro,p,qo+".id "+(i?"DESC":"ASC"));s+=" LIMIT "+d+" OFFSET "+c,t.executeSql(s,u,function(t,s){for(var r=0,o=s.rows.length;r<o;r++){var i=s.rows.item(r),d=en(i.metadata),c=d.id,l=Nn(i.data,c,i.rev),u=l._rev,p={id:c,key:c,value:{rev:u}};if(e.include_docs){if(p.doc=l,p.doc._rev=u,e.conflicts){var h=te(d);h.length&&(p.doc._conflicts=h)}Xn(p.doc,e,y,t)}if(i.deleted)if(a)p.value.deleted=!0,p.doc=null;else continue;if(!a)n.push(p);else{var _=a.indexOf(c,_);do n[_]=p,_=a.indexOf(c,_+1);while(-1<_&&_<a.length)}}a&&a.forEach(function(e,t){n[t]||(n[t]={key:e,error:"not_found"})})})}},Bn(t),function(){var s={total_rows:_,offset:e.skip,rows:n};e.update_seq&&(s.update_seq=m),t(null,s)})},y._changes=function(e){if(e=_(e),e.continuous){var t=y._name+":"+Vr();return Lo.addListener(y._name,t,y,e),Lo.notify(y._name),{cancel:function(){Lo.removeListener(y._name,t)}}}var n=e.descending;e.since=e.since&&!n?e.since:0;var s="limit"in e?e.limit:-1;0===s&&(s=1);var r="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var o=[],a=0;(function(){var t=["maxSeq > ?"],i=[e.since];e.doc_ids&&(t.push(qo+".id IN "+Rn(e.doc_ids.length)),i=i.concat(e.doc_ids));var d="maxSeq "+(n?"DESC":"ASC"),c=$n(qo+".json AS metadata, "+qo+".max_seq AS maxSeq, "+So+".json AS winningDoc, "+So+".rev AS winningRev ",qo+" JOIN "+So,qo+".id="+So+".doc_id AND "+qo+".winningseq="+So+".seq",t,d),l=P(e);e.view||e.filter||(c+=" LIMIT "+s);var u=e.since||0;w.readTransaction(function(t){t.executeSql(c,i,function(t,n){function d(t){return function(){e.onChange(t)}}for(var c=0,i=n.rows.length;c<i;c++){var p=n.rows.item(c),h=en(p.metadata);u=p.maxSeq;var _=Nn(p.winningDoc,h.id,p.winningRev),g=e.processChange(_,h,e);g.seq=p.maxSeq;var m=l(g);if("object"===typeof m)return e.complete(m);if(m&&(a++,r&&o.push(g),e.attachments&&e.include_docs?Xn(_,e,y,t,d(g)):d(g)()),a===s)break}})},Bn(e.complete),function(){e.continuous||e.complete(null,{results:o,last_seq:u})})})()},y._close=function(e){e()},y._getAttachment=function(e,t,n,s,r){var o=s.ctx,a=n.digest,i=n.content_type,d;o.executeSql("SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+wo+" WHERE digest=?",[a],function(e,t){var n=t.rows.item(0),o=n.escaped?In(n.body):jn(n.body,k);d=s.binary?Dt(o,i):ro(o),r(null,d)})},y._getRevisionTree=function(e,t){w.readTransaction(function(n){n.executeSql("SELECT json AS metadata FROM "+qo+" WHERE id = ?",[e],function(e,n){if(!n.rows.length)t(N(kr));else{var s=en(n.rows.item(0).metadata);t(null,s.rev_tree)}})})},y._doCompaction=function(e,t,n){return t.length?void w.transaction(function(n){n.executeSql("SELECT json AS metadata FROM "+qo+" WHERE id = ?",[e],function(n,s){var r=en(s.rows.item(0).metadata);Y(r.rev_tree,function(e,n,s,r,o){-1!==t.indexOf(n+"-"+s)&&(o.status="missing")});n.executeSql("UPDATE "+qo+" SET json = ? WHERE id = ?",[tn(r),e])}),Pn(t,e,n)},Bn(n),function(){n()}):n()},y._getLocal=function(e,t){w.readTransaction(function(n){n.executeSql("SELECT json, rev FROM "+Co+" WHERE id=?",[e],function(n,s){if(s.rows.length){var r=s.rows.item(0),o=Nn(r.json,e,r.rev);t(null,o)}else t(N(kr))})})},y._putLocal=function(e,t,n){function s(e){var s,c;r?(s="UPDATE "+Co+" SET rev=?, json=? WHERE id=? AND rev=?",c=[a,i,o,r]):(s="INSERT INTO "+Co+" (id, rev, json) VALUES (?,?,?)",c=[o,a,i]),e.executeSql(s,c,function(e,s){s.rowsAffected?(d={ok:!0,id:o,rev:a},t.ctx&&n(null,d)):n(N(qr))},function(){return n(N(qr)),!1})}"function"===typeof t&&(n=t,t={}),delete e._revisions;var r=e._rev,o=e._id,a;a=r?e._rev="0-"+(parseInt(r.split("-")[1],10)+1):e._rev="0-1";var i=Fn(e),d;t.ctx?s(t.ctx):w.transaction(s,Bn(n),function(){d&&n(null,d)})},y._removeLocal=function(e,t,n){function s(s){var o=[e._id,e._rev];s.executeSql("DELETE FROM "+Co+" WHERE id=? AND rev=?",o,function(s,o){return o.rowsAffected?void(r={ok:!0,id:e._id,rev:"0-0"},t.ctx&&n(null,r)):n(N(kr))})}"function"===typeof t&&(n=t,t={});var r;t.ctx?s(t.ctx):w.transaction(s,Bn(n),function(){r&&n(null,r)})},y._destroy=function(e,t){Lo.removeAllListeners(y._name),w.transaction(function(e){[qo,So,wo,xo,Co,To].forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},Bn(t),function(){T()&&(delete window.localStorage["_pouch__websqldb_"+y._name],delete window.localStorage[y._name]),t(null,{ok:!0})})}}function Vn(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}function Kn(){if("undefined"===typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=T(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var n=Vn();return e&&(localStorage[t]=n?"1":"0"),n}function Qn(e,t,n,s){return openDatabase(e,t,n,s)}function Jn(e,t){j("warn","WebSQL is deprecated and will be removed in future releases of PouchDB. Please migrate to IndexedDB: https://pouchdb.com/2018/01/23/pouchdb-6.4.2.html");var n=vr({websql:Qn},e);Gn.call(this,n,t)}function Yn(){for(var e={},t=new ur(function(t,n){e.resolve=t,e.reject=n}),n=Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return e.promise=t,ur.resolve().then(function(){return fetch.apply(null,n)}).then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)}),e}function Zn(e,t){var n=new Headers,s={method:e.method,credentials:"include",headers:n},r,o,a;return e.json&&(n.set("Accept","application/json"),n.set("Content-Type",e.headers["Content-Type"]||"application/json")),s.body=e.body&&e.processData&&"string"!==typeof e.body?JSON.stringify(e.body):"body"in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&n.set(t,e.headers[t])}),r=Yn(e.url,s),0<e.timeout&&(o=setTimeout(function(){r.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),r.promise.then(function(t){return a={statusCode:t.status},0<e.timeout&&clearTimeout(o),200<=a.statusCode&&300>a.statusCode?e.binary?t.blob():t.text():t.json()}).then(function(e){200<=a.statusCode&&300>a.statusCode?t(null,a,e):(e.status=a.statusCode,t(e))})["catch"](function(e){e||(e=new Error("canceled")),t(e)}),{abort:r.reject}}function es(e,t){var n=!1,s=function(){n=!0,a.abort(),o()},r={abort:function(){a.abort(),o()}},o=function(){clearTimeout(i),r.abort=function(){},a&&(a.onprogress=void 0,a.upload&&(a.upload.onprogress=void 0),a.onreadystatechange=void 0,a=void 0)},a,i;a=e.xhr?new e.xhr:new XMLHttpRequest;try{a.open(e.method,e.url)}catch(e){return t(new Error(e.name||"Url is invalid"))}for(var d in a.withCredentials=!("withCredentials"in e)||e.withCredentials,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!==typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(a.responseType="arraybuffer"),"body"in e||(e.body=null),e.headers)e.headers.hasOwnProperty(d)&&a.setRequestHeader(d,e.headers[d]);return 0<e.timeout&&(i=setTimeout(s,e.timeout),a.onprogress=function(){clearTimeout(i),4!==a.readyState&&(i=setTimeout(s,e.timeout))},"undefined"!==typeof a.upload&&(a.upload.onprogress=a.onprogress)),a.onreadystatechange=function(){if(4===a.readyState){var s={statusCode:a.status};if(200<=a.status&&300>a.status){var r;r=e.binary?jt([a.response||""],{type:a.getResponseHeader("Content-Type")}):a.responseText,t(null,s,r)}else{var i={};if(n)i=new Error("ETIMEDOUT"),i.code="ETIMEDOUT";else if("string"===typeof a.response&&""!==a.response)try{i=JSON.parse(a.response)}catch(t){}i.status=a.status,t(i)}o()}},e.body&&e.body instanceof Blob?Pt(e.body,function(e){a.send(e)}):a.send(e.body),r}function ts(e,t){return Po||e.xhr?es(e,t):Zn(e,t)}function ns(){return""}function ss(e,t){function n(t,n,s){if(!e.binary&&e.json&&"string"===typeof t)try{t=JSON.parse(t)}catch(t){return s(t)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?R(e):e})),e.binary,s(null,t,n)}e=_(e);return e=vr({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},e),e.json&&(!e.binary&&(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),ts(e,function(s,r,o){if(s)return t(R(s));var a=r.headers&&r.headers["content-type"],i=o||ns(),d;if(!e.binary&&(e.json||!e.processData)&&"object"!==typeof i&&(/json/.test(a)||/^[\s]*\{/.test(i)&&/\}[\s]*$/.test(i)))try{i=JSON.parse(i.toString())}catch(t){}200<=r.statusCode&&300>r.statusCode?n(i,r,t):(d=R(i),d.status=r.statusCode,t(d))})}function rs(e,t){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",s=-1!==n.indexOf("safari")&&-1===n.indexOf("chrome"),r=-1!==n.indexOf("msie"),o=-1!==n.indexOf("trident"),a=-1!==n.indexOf("edge"),i=s||(r||o||a)&&"GET"===e.method,d=!("cache"in e)||e.cache,c=/^blob:/.test(e.url);if(!c&&(i||!d)){var l=-1!==e.url.indexOf("?");e.url+=(l?"&":"?")+"_nonce="+Date.now()}return ss(e,t)}function os(e,t){return new ur(function(n,s){function r(){c++,e[l++]().then(a,i)}function o(){++u===p?h?s(h):n():d()}function a(){c--,o()}function i(e){c--,h=h||e,o()}function d(){for(;c<t&&l<p;)r()}var c=0,l=0,u=0,p=e.length,h;d()})}function as(e){var t=e.doc||e.ok,n=t._attachments;n&&Object.keys(n).forEach(function(e){var t=n[e];t.data=It(t.data,t.content_type)})}function is(e){return /^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function ds(e){return e._attachments&&Object.keys(e._attachments)?ur.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&"string"!==typeof n.data)return new ur(function(e){$t(n.data,e)}).then(function(e){n.data=e})})):ur.resolve()}function cs(e){if(!e.prefix)return!1;var t=X(e.prefix).protocol;return"http"===t||"https"===t}function ls(e,t){if(cs(t)){var n=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(n)}var s=X(e);(s.user||s.password)&&(s.auth={username:s.user,password:s.password});var r=s.path.replace(/(^\/|\/$)/g,"").split("/");return s.db=r.pop(),-1===s.db.indexOf("%")&&(s.db=encodeURIComponent(s.db)),s.path=r.join("/"),s}function us(e,t){return ps(e,e.db+"/"+t)}function ps(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function hs(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function _s(e,n){function r(e,t,n){var s=(e||{}).ajax||{},r=vr(_(p),s,t),o=_(p.headers||{});return r.headers=vr(o,s.headers,t.headers||{}),c.constructor.listeners("debug").length&&c.constructor.emit("debug",["http",r.method,r.url]),c._ajax(r,n)}function o(e,t){return new ur(function(n,s){r(e,t,function(e,t){return e?s(e):void n(t)})})}function a(e,t){return y(e,sr(function(n){i().then(function(){return t.apply(this,n)})["catch"](function(t){var e=n.pop();e(t)})}))}function i(){if(e.skipSetup||e.skip_setup)return ur.resolve();if(f)return f;return f=o({},{method:"GET",url:u})["catch"](function(e){return e&&e.status&&404===e.status?(I(404,"PouchDB is just detecting if the remote exists."),o({},{method:"PUT",url:u})):ur.reject(e)})["catch"](function(e){return e&&e.status&&412===e.status||ur.reject(e)}),f["catch"](function(){f=null}),f}function d(e){return e.split("/").map(encodeURIComponent).join("/")}var c=this,l=ls(e.name,e),u=us(l,"");e=_(e);var p=e.ajax||{};if(e.auth||l.auth){var h=e.auth||l.auth,g=h.username+":"+h.password,m=ro(unescape(encodeURIComponent(g)));p.headers=p.headers||{},p.headers.Authorization="Basic "+m}c._ajax=rs;var f;rr(function(){n(null,c)}),c._remote=!0,c.type=function(){return"http"},c.id=a("id",function(e){r({},{method:"GET",url:ps(l,"")},function(t,n){var s=n&&n.uuid?n.uuid+l.db:us(l,"");e(null,s)})}),c.request=a("request",function(e,t){e.url=us(l,e.url),r({},e,t)}),c.compact=a("compact",function(e,t){"function"===typeof e&&(t=e,e={}),e=_(e),r(e,{url:us(l,"_compact"),method:"POST"},function(){function n(){c.info(function(s,r){r&&!r.compact_running?t(null,{ok:!0}):setTimeout(n,e.interval||200)})}n()})}),c.bulkGet=y("bulkGet",function(e,n){function o(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),r(e,{url:us(l,"_bulk_get"+hs(n)),method:"POST",body:{docs:e.docs}},function(n,s){!n&&e.attachments&&e.binary&&s.results.forEach(function(e){e.docs.forEach(as)}),t(n,s)})}function a(){function r(e){return function(t,s){l[e]=s.results,++c===a&&n(null,{results:B(l)})}}for(var o=Mo,a=s(e.docs.length/o),c=0,l=Array(a),u=0,i;u<a;u++)i=q(e,["revs","attachments","binary","latest"]),i.ajax=p,i.docs=e.docs.slice(u*o,t(e.docs.length,(u+1)*o)),C(d,i,r(u))}var d=this,i=ps(l,""),c=Ho[i];"boolean"===typeof c?c?o(n):a():o(function(e,t){e?(Ho[i]=!1,I(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),a()):(Ho[i]=!0,n(null,t))})}),c._info=function(e){i().then(function(){r({},{method:"GET",url:us(l,"")},function(t,n){return t?e(t):void(n.host=us(l,""),e(null,n))})})["catch"](e)},c.get=a("get",function(t,e,n){function s(t){function n(n){var r=s[n],a=is(t._id)+"/"+d(n)+"?rev="+t._rev;return o(e,{method:"GET",url:us(l,a),binary:!0}).then(function(t){return e.binary?t:new ur(function(e){$t(t,e)})}).then(function(e){delete r.stub,delete r.length,r.data=e})}var s=t._attachments,r=s&&Object.keys(s);if(s&&r.length){var a=r.map(function(e){return function(){return n(e)}});return os(a,5)}}function r(e){return Array.isArray(e)?ur.all(e.map(function(e){if(e.ok)return s(e.ok)})):s(e)}"function"===typeof e&&(n=e,e={}),e=_(e);var a={};e.revs&&(a.revs=!0),e.revs_info&&(a.revs_info=!0),e.latest&&(a.latest=!0),e.open_revs&&("all"!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),a.open_revs=e.open_revs),e.rev&&(a.rev=e.rev),e.conflicts&&(a.conflicts=e.conflicts),e.update_seq&&(a.update_seq=e.update_seq),t=is(t);var i={method:"GET",url:us(l,t+hs(a))};o(e,i).then(function(t){return ur.resolve().then(function(){if(e.attachments)return r(t)}).then(function(){n(null,t)})})["catch"](function(s){s.docId=t,n(s)})}),c.remove=a("remove",function(e,t,n,s){var o;"string"===typeof t?(o={_id:e,_rev:t},"function"===typeof n&&(s=n,n={})):(o=e,"function"===typeof t?(s=t,n={}):(s=n,n=t));var a=o._rev||n.rev;r(n,{method:"DELETE",url:us(l,is(o._id))+"?rev="+a},s)}),c.getAttachment=a("getAttachment",function(e,t,n,s){"function"===typeof n&&(s=n,n={});var o=n.rev?"?rev="+n.rev:"",a=us(l,is(e))+"/"+d(t)+o;r(n,{method:"GET",url:a,binary:!0},s)}),c.removeAttachment=a("removeAttachment",function(e,t,n,s){var o=us(l,is(e)+"/"+d(t))+"?rev="+n;r({},{method:"DELETE",url:o},s)}),c.putAttachment=a("putAttachment",function(e,t,n,s,o,a){"function"===typeof o&&(a=o,o=s,s=n,n=null);var i=is(e)+"/"+d(t),c=us(l,i);if(n&&(c+="?rev="+n),"string"===typeof s){var u;try{u=so(s)}catch(e){return a(N(Ar,"Attachment is not a valid base64 string"))}s=u?Dt(u,o):""}var h={headers:{"Content-Type":o},method:"PUT",url:c,processData:!1,body:s,timeout:p.timeout||6e4};r({},h,a)}),c._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,i().then(function(){return ur.all(e.docs.map(ds))}).then(function(){r(t,{method:"POST",url:us(l,"_bulk_docs"),timeout:t.timeout,body:e},function(e,t){return e?n(e):void(t.forEach(function(e){e.ok=!0}),n(null,t))})})["catch"](n)},c._put=function(e,t,n){i().then(function(){return ds(e)}).then(function(){r(t,{method:"PUT",url:us(l,is(e._id)),body:e},function(t,s){return t?(t.docId=e&&e._id,n(t)):void n(null,s)})})["catch"](n)},c.allDocs=a("allDocs",function(e,t){"function"===typeof e&&(t=e,e={}),e=_(e);var n={},s="GET",r;e.conflicts&&(n.conflicts=!0),e.update_seq&&(n.update_seq=!0),e.descending&&(n.descending=!0),e.include_docs&&(n.include_docs=!0),e.attachments&&(n.attachments=!0),e.key&&(n.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(n.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(n.endkey=JSON.stringify(e.endkey)),"undefined"!==typeof e.inclusive_end&&(n.inclusive_end=!!e.inclusive_end),"undefined"!==typeof e.limit&&(n.limit=e.limit),"undefined"!==typeof e.skip&&(n.skip=e.skip);var a=hs(n);"undefined"!==typeof e.keys&&(s="POST",r={keys:e.keys}),o(e,{method:s,url:us(l,"_all_docs"+a),body:r}).then(function(n){e.include_docs&&e.attachments&&e.binary&&n.rows.forEach(as),t(null,n)})["catch"](t)}),c._changes=function(e){var t="batch_size"in e?e.batch_size:Bo;e=_(e),e.continuous&&!("heartbeat"in e)&&(e.heartbeat=Wo);var n="timeout"in e?e.timeout:"timeout"in p?p.timeout:30000;"timeout"in e&&e.timeout&&n-e.timeout<Uo&&(n=e.timeout+Uo),"heartbeat"in e&&e.heartbeat&&n-e.heartbeat<Uo&&(n=e.heartbeat+Uo);var s={};"timeout"in e&&e.timeout&&(s.timeout=e.timeout);var o="undefined"!==typeof e.limit&&e.limit,a;a="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var d=o;if(e.style&&(s.style=e.style),(e.include_docs||e.filter&&"function"===typeof e.filter)&&(s.include_docs=!0),e.attachments&&(s.attachments=!0),e.continuous&&(s.feed="longpoll"),e.seq_interval&&(s.seq_interval=e.seq_interval),e.conflicts&&(s.conflicts=!0),e.descending&&(s.descending=!0),e.update_seq&&(s.update_seq=!0),"heartbeat"in e&&e.heartbeat&&(s.heartbeat=e.heartbeat),e.filter&&"string"===typeof e.filter&&(s.filter=e.filter),e.view&&"string"===typeof e.view&&(s.filter="_view",s.view=e.view),e.query_params&&"object"===typeof e.query_params)for(var c in e.query_params)e.query_params.hasOwnProperty(c)&&(s[c]=e.query_params[c]);var u="GET",h;e.doc_ids?(s.filter="_doc_ids",u="POST",h={doc_ids:e.doc_ids}):e.selector&&(s.filter="_selector",u="POST",h={selector:e.selector});var g=function(a,c){if(!e.aborted){s.since=a,"object"===typeof s.since&&(s.since=JSON.stringify(s.since)),e.descending?o&&(s.limit=d):s.limit=!o||d>t?t:d;var p={method:u,url:us(l,"_changes"+hs(s)),timeout:n,body:h};v=a,e.aborted||i().then(function(){y=r(e,p,c)})["catch"](c)}},m={results:[]},f=function(n,s){if(!e.aborted){var r=0;if(s&&s.results){r=s.results.length,m.last_seq=s.last_seq;var i=null,l=null;"number"===typeof s.pending&&(i=s.pending),("string"===typeof m.last_seq||"number"===typeof m.last_seq)&&(l=m.last_seq);({}).query=e.query_params,s.results=s.results.filter(function(t){d--;var n=P(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&as(t),a&&m.results.push(t),e.onChange(t,i,l)),n})}else if(n)return e.aborted=!0,void e.complete(n);s&&s.last_seq&&(v=s.last_seq);var c=o&&0>=d||s&&r<t||e.descending;(!e.continuous||o&&0>=d)&&c?e.complete(null,m):rr(function(){g(v,f)})}},y,v;return g(e.since||0,f),{cancel:function(){e.aborted=!0,y&&y.abort()}}},c.revsDiff=a("revsDiff",function(e,t,n){"function"===typeof t&&(n=t,t={}),r(t,{method:"POST",url:us(l,"_revs_diff"),body:e},n)}),c._close=function(e){e()},c._destroy=function(e,t){r(e,{url:us(l,""),method:"DELETE"},function(e,n){return e&&e.status&&404!==e.status?t(e):void t(null,n)})}}function gs(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,gs)}catch(t){}}function ms(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,ms)}catch(t){}}function fs(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,fs)}catch(t){}}function ys(e,t){return t&&e.then(function(e){rr(function(){t(null,e)})},function(e){rr(function(){t(e)})}),e}function vs(e){return sr(function(t){var n=t.pop(),s=e.apply(this,t);return"function"===typeof n&&ys(s,n),s})}function bs(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})}function Es(e,t){return function(){var n=arguments,s=this;return e.add(function(){return t.apply(s,n)})}}function ks(e){var t=new _r(e),n=Array(t.size),s=-1;return t.forEach(function(e){n[++s]=e}),n}function qs(e){var t=Array(e.size),n=-1;return e.forEach(function(e,s){t[++n]=s}),t}function Ss(e){return new fs("builtin "+e+" function requires map values to be numbers or number arrays")}function ws(e){for(var t=0,n=0,s=e.length,r;n<s;n++)if(r=e[n],"number"===typeof r)"number"===typeof t?t+=r:t[0]+=r;else if(Array.isArray(r)){t="number"===typeof t?[t]:t;for(var o=0,a=r.length,i;o<a;o++)if(i=r[o],"number"!==typeof i)throw Ss("_sum");else"undefined"===typeof t[o]?t.push(i):t[o]+=i}else throw Ss("_sum");return t}function Cs(e,t){return G("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:ws,log:zo,isArray:Xo,toJSON:Go})}function xs(){this.promise=new ur(function(e){e()})}function Ts(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e);}}function As(e,t){return Ts(e)+Ts(t)+"undefined"}function Ls(e,t,n,s,r,o){var a=As(n,s),i;if(!r&&(i=e._cachedViews=e._cachedViews||{},i[a]))return i[a];var d=e.info().then(function(d){var c=d.db_name+"-mrview-"+(r?"temp":zt(a));return V(e,"_local/"+o,function(e){e.views=e.views||{};var n=t;-1===n.indexOf("/")&&(n=t+"/"+t);var s=e.views[n]=e.views[n]||{};if(!s[c])return s[c]=!0,e}).then(function(){return e.registerDependentDatabase(c).then(function(t){var r=t.db;r.auto_compaction=!0;var o={name:c,db:r,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:s};return o.db.get("_local/lastSeq")["catch"](function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,i&&o.db.once("destroyed",function(){delete i[a]}),o})})})});return i&&(i[a]=d),d}function js(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Os(e){return 1===e.length&&/^1-/.test(e[0].rev)}function Ds(t,n){try{t.emit("error",n)}catch(e){j("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),j("error",n)}}function Is(e){if(/^_sum/.test(e))return Jo._sum;if(/^_count/.test(e))return Jo._count;if(/^_stats/.test(e))return Jo._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function Fs(e){return /^1-/.test(e)}function Ns(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Rs(e,t){var n=Object.keys(t._attachments);return ur.all(n.map(function(n){return e.getAttachment(t._id,n,{rev:t._rev})}))}function $s(e,t,n){var s=U(t)&&!U(e),r=Object.keys(n._attachments);return s?e.get(n._id).then(function(s){return ur.all(r.map(function(r){return Ns(s,n,r)?t.getAttachment(n._id,r):e.getAttachment(s._id,r)}))})["catch"](function(e){if(404!==e.status)throw e;return Rs(t,n)}):Rs(t,n)}function Ps(e){var t=[];return Object.keys(e).forEach(function(n){var s=e[n].missing;s.forEach(function(e){t.push({id:n,rev:e})})}),{docs:t,revs:!0,latest:!0}}function Bs(e,t,n,s){function r(e){return e._attachments&&0<Object.keys(e._attachments).length}function o(e){return e._conflicts&&0<e._conflicts.length}function a(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(s.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){e.deleted||!e.doc||!Fs(e.value.rev)||r(e.doc)||o(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,i.push(e.doc),delete n[e.id])})})}n=_(n);var i=[],d=!0;return ur.resolve().then(function(){var e=Object.keys(n).filter(function(e){var t=n[e].missing;return 1===t.length&&Fs(t[0])});if(0<e.length)return a(e)}).then(function(){var r=Ps(n);return r.docs.length?e.bulkGet(r).then(function(n){if(s.cancelled)throw new Error("cancelled");return ur.all(n.results.map(function(n){return ur.all(n.docs.map(function(n){var s=n.ok;return n.error&&(d=!1),s&&s._attachments?$s(t,e,s).then(function(e){var t=Object.keys(s._attachments);return e.forEach(function(e,n){var r=s._attachments[t[n]];delete r.stub,delete r.length,r.data=e}),s}):s}))})).then(function(e){i=i.concat(B(e).filter(Boolean))})}):void 0}).then(function(){return{ok:d,docs:i}})}function Ms(e,t,n,s,r){return e.get(t)["catch"](function(n){if(404===n.status)return("http"===e.adapter||"https"===e.adapter)&&I(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:s,_id:t,history:[],replicator:ea,version:Zo};throw n}).then(function(o){if(!r.cancelled)return o.last_seq===n?void 0:(o.history=(o.history||[]).filter(function(e){return e.session_id!==s}),o.history.unshift({last_seq:n,session_id:s}),o.history=o.history.slice(0,ta),o.version=Zo,o.replicator=ea,o.session_id=s,o.last_seq=n,e.put(o)["catch"](function(o){if(409===o.status)return Ms(e,t,n,s,r);throw o}))})}function Us(e,t,n,s,r){this.src=e,this.target=t,this.id=n,this.returnValue=s,this.opts=r||{}}function Ws(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:Hs(e.history,t.history)}function Hs(e,t){var n=e[0],s=e.slice(1),r=t[0],o=t.slice(1);if(!n||0===t.length)return{last_seq:na,history:[]};var a=n.session_id;if(zs(a,t))return{last_seq:n.last_seq,history:e};var i=r.session_id;return zs(i,s)?{last_seq:r.last_seq,history:o}:Hs(s,o)}function zs(e,t){var n=t[0],s=t.slice(1);return e&&0!==t.length&&(!(e!==n.session_id)||zs(e,s))}function Xs(e){return"number"===typeof e.status&&4===r(e.status/100)}function Gs(e,t,n,s){if(!1===e.retry)return t.emit("error",n),void t.removeAllListeners();if("function"!==typeof e.back_off_function&&(e.back_off_function=D),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var r=function(){e.current_back_off=ra},o=function(){t.removeListener("active",r)};t.once("paused",o),t.once("active",r)}e.current_back_off=e.current_back_off||ra,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(s,e.current_back_off)}function Vs(e){return Object.keys(e).sort(Ve).reduce(function(t,n){return t[n]=e[n],t},{})}function Ks(e,t,n){var s=n.doc_ids?n.doc_ids.sort(Ve):"",r=n.filter?n.filter.toString():"",o="",a="",i="";return n.selector&&(i=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(Vs(n.query_params))),n.filter&&"_view"===n.filter&&(a=n.view.toString()),ur.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+r+a+o+s+i;return new ur(function(e){Ht(t,e)})}).then(function(e){return e=e.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+e})}function Qs(e,t,n,s,r){function o(){return B?ur.resolve():Ks(e,t,n).then(function(r){$=r;var o={};o=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},B=new Us(e,t,$,s,o)})}function a(){if(D=[],0!==R.docs.length){var e=R.docs,o={timeout:n.timeout};return t.bulkDocs({docs:e,new_edits:!1},o).then(function(t){if(s.cancelled)throw h(),new Error("cancelled");var n=Object.create(null);t.forEach(function(e){e.error&&(n[e.id]=e)});var o=Object.keys(n).length;r.doc_write_failures+=o,r.docs_written+=e.length-o,e.forEach(function(e){var t=n[e._id];if(t){r.errors.push(t);var o=(t.name||"").toLowerCase();if("unauthorized"===o||"forbidden"===o)s.emit("denied",_(t));else throw t}else D.push(e)})},function(t){throw r.doc_write_failures+=e.length,t})}}function i(){if(R.error)throw new Error("There was a problem getting docs.");r.last_seq=C=R.seq;var e=_(r);return D.length&&(e.docs=D,"number"===typeof R.pending&&(e.pending=R.pending,delete R.pending),s.emit("change",e)),q=!0,B.writeCheckpoint(R.seq,I).then(function(){if(q=!1,s.cancelled)throw h(),new Error("cancelled");R=void 0,y()})["catch"](function(e){throw b(e),e})}function d(){var e={};return R.changes.forEach(function(t){"_user/"===t.id||(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(s.cancelled)throw h(),new Error("cancelled");R.diffs=e})}function c(){return Bs(e,t,R.diffs,s).then(function(e){R.error=!e.ok,e.docs.forEach(function(e){delete R.diffs[e._id],r.docs_read++,R.docs.push(e)})})}function l(){return s.cancelled||R?void 0:0===E.length?void u(!0):void(R=E.shift(),d().then(c).then(a).then(i).then(l)["catch"](function(e){p("batch processing terminated with error",e)}))}function u(e){return 0===k.changes.length?void(0!==E.length||R||((x&&M.live||S)&&(s.state="pending",s.emit("paused")),S&&h())):void((e||S||k.changes.length>=T)&&(E.push(k),k={seq:0,changes:[],docs:[]},("pending"===s.state||"stopped"===s.state)&&(s.state="active",s.emit("active")),l()))}function p(e,t){w||(!t.message&&(t.message=e),r.ok=!1,r.status="aborting",E=[],k={seq:0,changes:[],docs:[]},h(t))}function h(o){if(!w&&!(s.cancelled&&(r.status="cancelled",q)))if(r.status=r.status||"complete",r.end_time=new Date,r.last_seq=C,w=!0,o){o=N(o),o.result=r;var a=(o.name||"").toLowerCase();"unauthorized"===a||"forbidden"===a?(s.emit("error",o),s.removeAllListeners()):Gs(n,s,o,function(){Qs(e,t,n,s)})}else s.emit("complete",r),s.removeAllListeners()}function g(e,t,r){if(s.cancelled)return h();"number"===typeof t&&(k.pending=t);var o=P(n)(e);o&&(k.seq=e.seq||r,k.changes.push(e),u(0===E.length&&M.live))}function m(e){if(L=!1,s.cancelled)return h();if(0<e.results.length)M.since=e.last_seq,y(),u(!0);else{var t=function(){x?(M.live=!0,y()):S=!0,u(!0)};R||0!==e.results.length?t():(q=!0,B.writeCheckpoint(e.last_seq,I).then(function(){q=!1,r.last_seq=C=e.last_seq,t()})["catch"](b))}}function f(e){return L=!1,s.cancelled?h():void p("changes rejected",e)}function y(){function t(){o.cancel()}function r(){s.removeListener("cancel",t)}if(!(L||S||!(E.length<A))){L=!0,s._changes&&(s.removeListener("cancel",s._abortChanges),s._changes.cancel()),s.once("cancel",t);var o=e.changes(M).on("change",g);o.then(r,r),o.then(m)["catch"](f),n.retry&&(s._changes=o,s._abortChanges=t)}}function v(){o().then(function(){return s.cancelled?void h():B.getCheckpoint().then(function(e){C=e,M={since:C,limit:T,batch_size:T,style:"all_docs",doc_ids:j,selector:O,return_docs:!0},!1!==F&&(M.seq_interval=F||T),n.filter&&("string"===typeof n.filter?M.filter=n.filter:M.include_docs=!0),"heartbeat"in n&&(M.heartbeat=n.heartbeat),"timeout"in n&&(M.timeout=n.timeout),n.query_params&&(M.query_params=n.query_params),n.view&&(M.view=n.view),y()})})["catch"](function(e){p("getCheckpoint rejected with ",e)})}function b(e){q=!1,p("writeCheckpoint completed with error",e)}var E=[],k={seq:0,changes:[],docs:[]},q=!1,S=!1,w=!1,C=0,x=n.continuous||n.live||!1,T=n.batch_size||100,A=n.batches_limit||10,L=!1,j=n.doc_ids,O=n.selector,D=[],I=Vr(),F=n.seq_interval,R,$,B;r=r||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var M={};return s.ready(e,t),s.cancelled?void h():void(!s._addedListeners&&(s.once("cancel",h),"function"===typeof n.complete&&(s.once("error",n.complete),s.once("complete",function(e){n.complete(null,e)})),s._addedListeners=!0),"undefined"===typeof n.since?v():o().then(function(){return q=!0,B.writeCheckpoint(n.since,I)}).then(function(){return q=!1,s.cancelled?void h():void(C=n.since,v())})["catch"](b))}function Js(){or.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new ur(function(t,n){e.once("complete",t),e.once("error",n)});e.then=function(e,n){return t.then(e,n)},e["catch"]=function(e){return t["catch"](e)},e["catch"](function(){})}function Ys(e,t){var n=t.PouchConstructor;return"string"===typeof e?new n(e,t):e}function Zs(e,t,n,s){if("function"===typeof n&&(s=n,n={}),"undefined"===typeof n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw N(Dr,"`doc_ids` filter parameter is not a list.");n.complete=s,n=_(n),n.continuous=n.continuous||n.live,n.retry=!!("retry"in n)&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var r=new Js(n),o=Ys(e,n),a=Ys(t,n);return Qs(o,a,n,r),r}function er(e,t,n,s){return"function"===typeof n&&(s=n,n={}),"undefined"===typeof n&&(n={}),n=_(n),n.PouchConstructor=n.PouchConstructor||this,e=Ys(e,n),t=Ys(t,n),new tr(e,t,n,s)}function tr(e,t,n,s){function r(e){_.emit("change",{direction:"pull",change:e})}function o(e){_.emit("change",{direction:"push",change:e})}function a(e){_.emit("denied",{direction:"push",doc:e})}function i(e){_.emit("denied",{direction:"pull",doc:e})}function d(){_.pushPaused=!0,_.pullPaused&&_.emit("paused")}function c(){_.pullPaused=!0,_.pushPaused&&_.emit("paused")}function l(){_.pushPaused=!1,_.pullPaused&&_.emit("active",{direction:"push"})}function u(){_.pullPaused=!1,_.pushPaused&&_.emit("active",{direction:"pull"})}function p(e){return function(t,n){("change"===t&&(n===r||n===o)||"denied"===t&&(n===i||n===a)||"paused"===t&&(n===c||n===d)||"active"===t&&(n===u||n===l))&&(!(t in f)&&(f[t]={}),f[t][e]=!0,2===Object.keys(f[t]).length&&_.removeAllListeners(t))}}function h(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}var _=this;this.canceled=!1;var g=n.push?vr({},n,n.push):n,m=n.pull?vr({},n,n.pull):n;this.push=Zs(e,t,g),this.pull=Zs(t,e,m),this.pushPaused=!0,this.pullPaused=!0;var f={};n.live&&(this.push.on("complete",_.pull.cancel.bind(_.pull)),this.pull.on("complete",_.push.cancel.bind(_.push))),this.on("newListener",function(e){"change"===e?(h(_.pull,"change",r),h(_.push,"change",o)):"denied"===e?(h(_.pull,"denied",i),h(_.push,"denied",a)):"active"===e?(h(_.pull,"active",u),h(_.push,"active",l)):"paused"===e&&(h(_.pull,"paused",c),h(_.push,"paused",d))}),this.on("removeListener",function(e){"change"===e?(_.pull.removeListener("change",r),_.push.removeListener("change",o)):"denied"===e?(_.pull.removeListener("denied",i),_.push.removeListener("denied",a)):"active"===e?(_.pull.removeListener("active",u),_.push.removeListener("active",l)):"paused"===e&&(_.pull.removeListener("paused",c),_.push.removeListener("paused",d))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));var y=ur.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return _.emit("complete",t),s&&s(null,t),_.removeAllListeners(),t},function(e){if(_.cancel(),s?s(e):_.emit("error",e),_.removeAllListeners(),s)throw e});this.then=function(e,t){return y.then(e,t)},this["catch"]=function(e){return y["catch"](e)}}var nr=c(a(7)),sr=c(a(1)),rr=c(a(5)),or=a(4),ar=c(a(6)),ir=c(a(11)),dr=c(a(2)),cr=c(a(10)),lr=c(a(16)),ur="function"===typeof Promise?Promise:nr,pr=Function.prototype.toString,hr=pr.call(Object);E.prototype.get=function(e){var t=v(e);return this._store[t]},E.prototype.set=function(e,t){var n=v(e);return this._store[n]=t,!0},E.prototype.has=function(e){var t=v(e);return t in this._store},E.prototype["delete"]=function(e){var t=v(e),n=t in this._store;return delete this._store[t],n},E.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,s=t.length;n<s;n++){var r=t[n],o=this._store[r];r=b(r),e(o,r)}},Object.defineProperty(E.prototype,"size",{get:function(){return Object.keys(this._store).length}}),k.prototype.add=function(e){return this._store.set(e,!0)},k.prototype.has=function(e){return this._store.has(e)},k.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(k.prototype,"size",{get:function(){return this._store.size}});var _r,gr;(function(){if("undefined"===typeof Symbol||"undefined"===typeof Map||"undefined"===typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map})()?(_r=Set,gr=Map):(_r=k,gr=E);var mr=6,fr;if(x())fr=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),fr=!!localStorage.getItem("_pouch_check_localstorage")}catch(t){fr=!1}ar(L,or.EventEmitter),L.prototype.addListener=function(e,t,n,s){function r(){function e(){a=!1}if(o._listeners[t]){if(a)return void(a="waiting");a=!0;var i=q(s,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(i).on("change",function(e){e.seq>s.since&&!s.cancelled&&(s.since=e.seq,s.onChange(e))}).on("complete",function(){"waiting"===a&&rr(r),a=!1}).on("error",e)}}if(!this._listeners[t]){var o=this,a=!1;this._listeners[t]=r,this.on(e,r)}},L.prototype.removeListener=function(e,t){t in this._listeners&&(or.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},L.prototype.notifyLocalWindows=function(e){x()?chrome.storage.local.set({dbName:e}):T()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},L.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var yr="function"===typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1,s;n<arguments.length;n++)if(s=arguments[n],null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t};var vr=yr;ar(F,Error),F.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var br=new F(401,"unauthorized","Name or password is incorrect."),Er=new F(400,"bad_request","Missing JSON list of 'docs'"),kr=new F(404,"not_found","missing"),qr=new F(409,"conflict","Document update conflict"),Sr=new F(400,"bad_request","_id field must contain a string"),wr=new F(412,"missing_id","_id is required for puts"),Cr=new F(400,"bad_request","Only reserved document ids may start with underscore."),xr=new F(412,"precondition_failed","Database not open"),Tr=new F(500,"unknown_error","Database encountered an unknown error"),Ar=new F(500,"badarg","Some query argument is invalid"),Lr=new F(400,"invalid_request","Request was invalid"),jr=new F(400,"query_parse_error","Some query parameter is invalid"),Or=new F(500,"doc_validation","Bad special document member"),Dr=new F(400,"bad_request","Something wrong with the request"),Ir=new F(400,"bad_request","Document must be a JSON object"),Fr=new F(404,"not_found","Database not found"),Nr=new F(500,"indexed_db_went_bad","unknown"),Rr=new F(500,"web_sql_went_bad","unknown"),$r=new F(500,"levelDB_went_went_bad","unknown"),Pr=new F(403,"forbidden","Forbidden by design doc validate_doc_update function"),Br=new F(400,"bad_request","Invalid rev format"),Mr=new F(412,"file_exists","The database could not be created, the file already exists."),Ur=new F(412,"missing_stub","A pre-existing attachment stub wasn't found"),Wr=new F(413,"invalid_url","Provided URL is invalid"),Hr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],zr="queryKey",Xr=/(?:^|&)([^&=]*)=?([^&]*)/g,Gr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Vr=ir.v4;ar(ve,or.EventEmitter),ve.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},ve.prototype.validateChanges=function(e){var t=e.complete,n=this;De._changesFilterPlugin?De._changesFilterPlugin.validate(e,function(s){return s?t(s):void n.doChanges(e)}):n.doChanges(e)},ve.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=_(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=be,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"===e.since)return void this.db.info().then(function(s){return t.isCancelled?void n(null,{status:"cancelled"}):void(e.since=s.update_seq,t.doChanges(e))},n);if(!De._changesFilterPlugin)["doc_ids","filter","selector","view"].forEach(function(t){t in e&&j("warn","The \""+t+"\" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.")});else if(De._changesFilterPlugin.normalize(e),De._changesFilterPlugin.shouldFilter(this,e))return De._changesFilterPlugin.filter(this,e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var s=this.db._changes(e);if(s&&"function"===typeof s.cancel){var r=t.cancel;t.cancel=sr(function(e){s.cancel(),r.apply(this,e)})}},ar(Ae,or.EventEmitter),Ae.prototype.post=y("post",function(e,t,n){return"function"===typeof t&&(n=t,t={}),"object"!==typeof e||Array.isArray(e)?n(N(Ir)):void this.bulkDocs({docs:[e]},t,ke(n,e._id))}),Ae.prototype.put=y("put",function(e,t,n){function s(n){"function"===typeof r._put&&!1!==t.new_edits?r._put(e,t,n):r.bulkDocs({docs:[e]},t,ke(n,e._id))}if("function"===typeof t&&(n=t,t={}),"object"!==typeof e||Array.isArray(e))return n(N(Ir));if(M(e._id),me(e._id)&&"function"===typeof this._putLocal)return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r=this;t.force&&e._rev?(function(){var n=e._rev.split("-"),s=n[1],r=parseInt(n[0],10),o=r+1,a=Q();e._revisions={start:o,ids:[a,s]},e._rev=o+"-"+a,t.new_edits=!1}(),s(function(t){var s=t?null:{ok:!0,id:e._id,rev:e._rev};n(t,s)})):s(n)}),Ae.prototype.putAttachment=y("putAttachment",function(e,t,n,s,r){function o(e){var n="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:r,data:s,revpos:++n},a.put(e)}var a=this;return"function"===typeof r&&(r=s,s=n,n=null),"undefined"===typeof r&&(r=s,s=n,n=null),r||j("warn","Attachment",t,"on document",e,"is missing content_type"),a.get(e).then(function(e){if(e._rev!==n)throw N(qr);return o(e)},function(t){if(t.reason===kr.message)return o({_id:e});throw t})}),Ae.prototype.removeAttachment=y("removeAttachment",function(e,t,n,s){var r=this;r.get(e,function(e,o){return e?void s(e):o._rev===n?o._attachments?void(delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,r.put(o,s)):s():void s(N(qr))})}),Ae.prototype.remove=y("remove",function(e,t,n,s){var r;"string"===typeof t?(r={_id:e,_rev:t},"function"===typeof n&&(s=n,n={})):(r=e,"function"===typeof t?(s=t,n={}):(s=n,n=t)),n=n||{},n.was_delete=!0;var o={_id:r._id,_rev:r._rev||n.rev,_deleted:!0};return me(o._id)&&"function"===typeof this._removeLocal?this._removeLocal(r,s):void this.bulkDocs({docs:[o]},n,ke(s,o._id))}),Ae.prototype.revsDiff=y("revsDiff",function(e,t,n){function s(e,t){i.has(e)||i.set(e,{missing:[]}),i.get(e).missing.push(t)}function r(t,n){var r=e[t].slice(0);Y(n,function(e,n,o,a,i){var d=n+"-"+o,c=r.indexOf(d);-1===c||(r.splice(c,1),"available"!==i.status&&s(t,d))}),r.forEach(function(e){s(t,e)})}"function"===typeof t&&(n=t,t={});var o=Object.keys(e);if(!o.length)return n(null,{});var a=0,i=new gr;o.map(function(t){this._getRevisionTree(t,function(s,d){if(s&&404===s.status&&"missing"===s.message)i.set(t,{missing:e[t]});else{if(s)return n(s);r(t,d)}if(++a===o.length){var c={};return i.forEach(function(e,t){c[t]=e}),n(null,c)}})},this)}),Ae.prototype.bulkGet=y("bulkGet",function(e,t){C(this,e,t)}),Ae.prototype.compactDocument=y("compactDocument",function(e,t,n){var s=this;this._getRevisionTree(e,function(r,o){if(r)return n(r);var a=we(o),i=[],d=[];Object.keys(a).forEach(function(e){a[e]>t&&i.push(e)}),Y(o,function(e,t,n,s,r){var o=t+"-"+n;"available"===r.status&&-1!==i.indexOf(o)&&d.push(o)}),s._doCompaction(e,d,n)})}),Ae.prototype.compact=y("compact",function(e,t){"function"===typeof e&&(t=e,e={});var n=this;e=e||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:e,callback:t}),1===n._compactionQueue.length&&xe(n)}),Ae.prototype._compact=function(e,t){var n=this,s={return_docs:!1,last_seq:e.last_seq||0},r=[];n.changes(s).on("change",function(e){r.push(n.compactDocument(e.id,0))}).on("complete",function(e){var s=e.last_seq;ur.all(r).then(function(){return V(n,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<s)&&(e.last_seq=s,e)})}).then(function(){t(null,{ok:!0})})["catch"](t)}).on("error",t)},Ae.prototype.get=y("get",function(e,t,n){function s(){var s=[],a=r.length;return a?void r.forEach(function(r){o.get(e,{rev:r,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},function(e,t){if(!e){for(var o=0,i=s.length,d;o<i;o++)if(s[o].ok&&s[o].ok._rev===t._rev){d=!0;break}d||s.push({ok:t})}else s.push({missing:r});a--,a||n(null,s)})}):n(null,s)}if("function"===typeof t&&(n=t,t={}),"string"!==typeof e)return n(N(Sr));if(me(e)&&"function"===typeof this._getLocal)return this._getLocal(e,n);var r=[],o=this;if(t.open_revs){if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){return e?n(e):void(r=ee(t).map(function(e){return e.rev}),s())});else if(Array.isArray(t.open_revs)){r=t.open_revs;for(var a=0,i;a<r.length;a++)if(i=r[a],!("string"===typeof i&&/^\d+-/.test(i)))return n(N(Br));s()}else return n(N(Tr,"function_clause"));return}return this._get(e,t,function(s,r){if(s)return s.docId=e,n(s);var a=r.doc,d=r.metadata,c=r.ctx;if(t.conflicts){var l=te(d);l.length&&(a._conflicts=l)}if(ge(d,a._rev)&&(a._deleted=!0),t.revs||t.revs_info){for(var u=a._rev.split("-"),p=parseInt(u[0],10),h=u[1],_=se(d.rev_tree),g=null,m=0;m<_.length;m++){var i=_[m],f=i.ids.map(function(e){return e.id}).indexOf(h);(f===p-1||!g&&-1!==f)&&(g=i)}var y=g.ids.map(function(e){return e.id}).indexOf(a._rev.split("-")[1])+1,v=g.ids.length-y;if(g.ids.splice(y,v),g.ids.reverse(),t.revs&&(a._revisions={start:g.pos+g.ids.length-1,ids:g.ids.map(function(e){return e.id})}),t.revs_info){var b=g.pos+g.ids.length;a._revs_info=g.ids.map(function(e){return b--,{rev:b+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&a._attachments){var E=a._attachments,k=Object.keys(E).length;if(0===k)return n(null,a);Object.keys(E).forEach(function(e){this._getAttachment(a._id,e,E[e],{rev:a._rev,binary:t.binary,ctx:c},function(t,s){var r=a._attachments[e];r.data=s,delete r.stub,delete r.length,--k||n(null,a)})},o)}else{if(a._attachments)for(var q in a._attachments)a._attachments.hasOwnProperty(q)&&(a._attachments[q].stub=!0);n(null,a)}})}),Ae.prototype.getAttachment=y("getAttachment",function(e,t,n,s){var r=this;n instanceof Function&&(s=n,n={}),this._get(e,n,function(o,a){return o?s(o):a.doc._attachments&&a.doc._attachments[t]?void(n.ctx=a.ctx,n.binary=!0,r._getAttachment(e,t,a.doc._attachments[t],n,s)):s(N(kr))})}),Ae.prototype.allDocs=y("allDocs",function(e,t){if("function"===typeof e&&(t=e,e={}),e.skip="undefined"===typeof e.skip?0:e.skip,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(n)return void t(N(jr,"Query parameter `"+n+"` is not compatible with multi-get"));if(!U(this)&&(Ce(e),0===e.keys.length))return this._allDocs({limit:0},t)}return this._allDocs(e,t)}),Ae.prototype.changes=function(e,t){return"function"===typeof e&&(t=e,e={}),new ve(this,e,t)},Ae.prototype.close=y("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),Ae.prototype.info=y("info",function(e){var t=this;this._info(function(n,s){return n?e(n):void(s.db_name=s.db_name||t.name,s.auto_compaction=!(!t.auto_compaction||U(t)),s.adapter=t.adapter,e(null,s))})}),Ae.prototype.id=y("id",function(e){return this._id(e)}),Ae.prototype.type=function(){return"function"===typeof this._type?this._type():this.adapter},Ae.prototype.bulkDocs=y("bulkDocs",function(e,t,n){if("function"===typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(N(Er));for(var s=0;s<e.docs.length;++s)if("object"!==typeof e.docs[s]||Array.isArray(e.docs[s]))return n(N(Ir));var r;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){r=r||Te(t),e._attachments[t].content_type||j("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),r)return n(N(Dr,r));"new_edits"in t||("new_edits"in e?t.new_edits=e.new_edits:t.new_edits=!0);var o=this;t.new_edits||U(o)||e.docs.sort(Se),qe(e.docs);var a=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,s){if(e)return n(e);if(t.new_edits||(s=s.filter(function(e){return e.error})),!U(o))for(var r=0,i=s.length;r<i;r++)s[r].id=s[r].id||a[r];n(null,s)})}),Ae.prototype.registerDependentDatabase=y("registerDependentDatabase",function(e,t){var n=new this.constructor(e,this.__opts);V(this,"_local/_pouch_dependentDbs",function(t){return(t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e])&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:n})})["catch"](t)}),Ae.prototype.destroy=y("destroy",function(e,t){function n(){s._destroy(e,function(e,n){return e?t(e):void(s._destroyed=!0,s.emit("destroyed"),t(null,n||{ok:!0}))})}"function"===typeof e&&(t=e,e={});var s=this,r=!("use_prefix"in s)||s.use_prefix;return U(s)?n():void s.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404===e.status?n():t(e);var a=o.dependentDbs,i=s.constructor,d=Object.keys(a).map(function(e){var t=r?e.replace(new RegExp("^"+i.prefix),""):e;return new i(t,s.__opts).destroy()});ur.all(d).then(n,t)})}),Le.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Le.prototype.fail=function(e){this.failed=e,this.execute()},Le.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Le.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},ar(De,Ae),De.adapters={},De.preferredAdapters=[],De.prefix="_pouch_";var Kr=new or.EventEmitter;(function(e){Object.keys(or.EventEmitter.prototype).forEach(function(t){"function"===typeof or.EventEmitter.prototype[t]&&(e[t]=Kr[t].bind(Kr))});var t=e._destructionListeners=new gr;e.on("ref",function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)}),e.on("unref",function(e){if(t.has(e.name)){var n=t.get(e.name),s=n.indexOf(e);0>s||(n.splice(s,1),1<n.length?t.set(e.name,n):t["delete"](e.name))}}),e.on("destroyed",function(e){if(t.has(e)){var n=t.get(e);t["delete"](e),n.forEach(function(e){e.emit("destroyed",!0)})}})})(De),De.adapter=function(e,t,n){t.valid()&&(De.adapters[e]=t,n&&De.preferredAdapters.push(e))},De.plugin=function(e){if("function"===typeof e)e(De);else if("object"!==typeof e||0===Object.keys(e).length)throw new Error("Invalid plugin: got \""+e+"\", expected an object or a function");else Object.keys(e).forEach(function(t){De.prototype[t]=e[t]});return this.__defaults&&(De.__defaults=vr({},this.__defaults)),De},De.defaults=function(e){function t(e,n){return this instanceof t?void(n=n||{},e&&"object"===typeof e&&(n=e,e=n.name,delete n.name),n=vr({},t.__defaults,n),De.call(this,e,n)):new t(e,n)}return ar(t,De),t.preferredAdapters=De.preferredAdapters.slice(),Object.keys(De).forEach(function(e){e in t||(t[e]=De[e])}),t.__defaults=vr({},this.__defaults,e),t};var Qr=["$or","$nor","$not"],Jr=-324,Yr=3,Zr="",eo={$elemMatch:function(e,t,n,s){return!!Array.isArray(s)&&0!==s.length&&("object"===typeof s[0]?s.some(function(e){return dt(e,t,Object.keys(t))}):s.some(function(s){return ct(t,e,n,s)}))},$allMatch:function(e,t,n,s){return!!Array.isArray(s)&&0!==s.length&&("object"===typeof s[0]?s.every(function(e){return dt(e,t,Object.keys(t))}):s.every(function(s){return ct(t,e,n,s)}))},$eq:function(e,t,n,s){return ht(s)&&0===Ve(s,t)},$gte:function(e,t,n,s){return ht(s)&&0<=Ve(s,t)},$gt:function(e,t,n,s){return ht(s)&&0<Ve(s,t)},$lte:function(e,t,n,s){return ht(s)&&0>=Ve(s,t)},$lt:function(e,t,n,s){return ht(s)&&0>Ve(s,t)},$exists:function(e,t,n,s){return t?ht(s):!ht(s)},$mod:function(e,t,n,s){return pt(s)&&_t(s,t)},$ne:function(e,t,n,s){return t.every(function(e){return 0!==Ve(s,e)})},$in:function(e,t,n,s){return pt(s)&&gt(s,t)},$nin:function(e,t,n,s){return pt(s)&&!gt(s,t)},$size:function(e,t,n,s){return pt(s)&&ft(s,t)},$all:function(e,t,n,s){return Array.isArray(s)&&mt(s,t)},$regex:function(e,t,n,s){return pt(s)&&yt(s,t)},$type:function(e,t,n,s){return vt(s,t)}};De.plugin(function(e){e.debug=dr;var t={};e.on("debug",function(e){var n=e[0],s=e.slice(1);t[n]||(t[n]=dr("pouchdb:"+n)),t[n].apply(null,s)})}),De.plugin(function(e){e._changesFilterPlugin={validate:qt,normalize:St,shouldFilter:wt,filter:Ct}}),De.version="6.4.3";var to=xt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),no=xt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),so=function(e){return atob(e)},ro=function(e){return btoa(e)},oo=d.setImmediate||d.setTimeout,ao=32768,io=5,co="document-store",lo="by-sequence",uo="attach-store",po="attach-seq-store",ho="meta-store",_o="local-store",go="detect-blob-support",mo=new L,fo=!1,yo=[],vo=new gr,bo=new gr,Eo;Sn.valid=function(){var e="undefined"!==typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"===typeof fetch&&-1!==fetch.toString().indexOf("[native code");try{return(!e||t)&&"undefined"!==typeof indexedDB&&"undefined"!==typeof IDBKeyRange}catch(t){return!1}};var ko=7,qo=On("document-store"),So=On("by-sequence"),wo=On("attach-store"),Co=On("local-store"),xo=On("metadata-store"),To=On("attach-seq-store"),Ao=new gr,Lo=new L,jo=1,Oo="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+So+" (seq, deleted)",Do="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+So+" (doc_id, rev)",Io="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+qo+" (winningseq)",Fo="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+To+" (seq)",No="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+To+" (digest, seq)",Ro=So+".seq = "+qo+".winningseq",$o=So+".seq AS seq, "+So+".deleted AS deleted, "+So+".json AS data, "+So+".rev AS rev, "+qo+".json AS metadata";Jn.valid=function(){return!("function"!==typeof openDatabase)&&Kn()},Jn.use_prefix=!0;var Po=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}(),Bo=25,Mo=50,Uo=5e3,Wo=1e4,Ho={};_s.valid=function(){return!0},ar(gs,Error),ar(ms,Error),ar(fs,Error);var zo=j.bind(null,"log"),Xo=Array.isArray,Go=JSON.parse;xs.prototype.add=function(e){return this.promise=this.promise["catch"](function(){}).then(function(){return e()}),this.promise},xs.prototype.finish=function(){return this.promise};var Vo={},Ko=new xs,Qo=50,Jo={_sum:function(e,t){return ws(t)},_count:function(e,t){return t.length},_stats:function(e,s){return{sum:ws(s),min:t.apply(null,s),max:n.apply(null,s),count:s.length,sumsqr:function(e){for(var t=0,n=0,s=e.length,r;n<s;n++)r=e[n],t+=r*r;return t}(s)}}},Yo=function(e,t,n,s){function r(t,e,n){try{e(n)}catch(n){Ds(t,n)}}function o(t,e,n,s,r){try{return{output:e(n,s,r)}}catch(n){return Ds(t,n),{error:n}}}function a(e,t){var n=Ve(e.key,t.key);return 0===n?Ve(e.value,t.value):n}function d(e,t,n){return(n=n||0,"number"===typeof t)?e.slice(n,t+n):0<n?e.slice(n):e}function i(e){var t=e.value,n=t&&"object"===typeof t&&t._id||e.id;return n}function c(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var n=t[e];t[e].data=It(n.data,n.content_type)})})}function l(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&c(t),t}}function u(e,t,n,s){var r=t[e];"undefined"!==typeof r&&(s&&(r=encodeURIComponent(JSON.stringify(r))),n.push(e+"="+r))}function p(e){if("undefined"!==typeof e){var t=+e;return isNaN(t)||t!==parseInt(e,10)?e:t}}function h(e){return e.group_level=p(e.group_level),e.limit=p(e.limit),e.skip=p(e.skip),e}function _(e){if(e){if("number"!==typeof e)return new gs("Invalid value for integer: \""+e+"\"");if(0>e)return new gs("Invalid value for positive integer: \""+e+"\"")}}function g(e,t){var n=e.descending?"endkey":"startkey",s=e.descending?"startkey":"endkey";if("undefined"!==typeof e[n]&&"undefined"!==typeof e[s]&&0<Ve(e[n],e[s]))throw new gs("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");else if(t.reduce&&!1!==e.reduce)if(e.include_docs)throw new gs("{include_docs:true} is invalid for reduce");else if(e.keys&&1<e.keys.length&&!e.group&&!e.group_level)throw new gs("Multi-key fetches for reduce views must use {group: true}");["group_level","limit","skip"].forEach(function(t){var n=_(e[t]);if(n)throw n})}function m(e,t,n){var s=[],r="GET",o;if(u("reduce",n,s),u("include_docs",n,s),u("attachments",n,s),u("limit",n,s),u("descending",n,s),u("group",n,s),u("group_level",n,s),u("skip",n,s),u("stale",n,s),u("conflicts",n,s),u("startkey",n,s,!0),u("start_key",n,s,!0),u("endkey",n,s,!0),u("end_key",n,s,!0),u("inclusive_end",n,s),u("key",n,s,!0),u("update_seq",n,s),s=s.join("&"),s=""===s?"":"?"+s,"undefined"!==typeof n.keys){var a="keys="+encodeURIComponent(JSON.stringify(n.keys));a.length+s.length+1<=2e3?s+=("?"===s[0]?"&":"?")+a:(r="POST","string"===typeof t?o={keys:n.keys}:t.keys=n.keys)}if("string"===typeof t){var i=js(t);return e.request({method:r,url:"_design/"+i[0]+"/_view/"+i[1]+s,body:o}).then(function(e){return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),e}).then(l(n))}return o=o||{},Object.keys(t).forEach(function(e){o[e]=Array.isArray(t[e])?t[e]:t[e].toString()}),e.request({method:"POST",url:"_temp_view"+s,body:o}).then(l(n))}function f(e,t,n){return new ur(function(s,r){e._query(t,n,function(e,t){return e?r(e):void s(t)})})}function y(e){return new ur(function(t,n){e._viewCleanup(function(e,s){return e?n(e):void t(s)})})}function v(e){return function(t){if(404===t.status)return e;throw t}}function b(e,t,n){function s(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):ur.resolve({rows:[]})}function r(e,t){for(var n=[],s=new _r,r=0,o=t.rows.length;r<o;r++){var a=t.rows[r],i=a.doc;if(i&&(n.push(i),s.add(i._id),i._deleted=!d.has(i._id),!i._deleted)){var c=d.get(i._id);"value"in c&&(i.value=c.value)}}var l=qs(d);return l.forEach(function(e){if(!s.has(e)){var t={_id:e},r=d.get(e);"value"in r&&(t.value=r.value),n.push(t)}}),e.keys=ks(l.concat(e.keys)),n.push(e),n}var o="_local/doc_"+e,a={_id:o,keys:[]},i=n.get(e),d=i[0],c=i[1];return function(){return Os(c)?ur.resolve(a):t.db.get(o)["catch"](v(a))}().then(function(e){return s(e).then(function(t){return r(e,t)})})}function E(e,t,n){var s="_local/lastSeq";return e.db.get(s)["catch"](v({_id:s,seq:0})).then(function(s){var r=qs(t);return ur.all(r.map(function(n){return b(n,e,t)})).then(function(t){var r=B(t);return s.seq=n,r.push(s),e.db.bulkDocs({docs:r})})})}function k(e){var t="string"===typeof e?e:e.name,n=Vo[t];return n||(n=Vo[t]=new xs),n}function q(e){return Es(k(e),function(){return S(e)})()}function S(e){function n(t,n){return function(){return E(e,t,n)}}function s(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:l,limit:Qo}).then(o)}function o(e){var t=e.results;if(t.length){var r=i(t);return u.add(n(r,l)),t.length<Qo?void 0:s()}}function i(t){for(var n=new gr,s=0,o=t.length,i;s<o;s++){if(i=t[s],"_"!==i.doc._id[0]){p=[],h=i.doc,h._deleted||r(e.sourceDB,c,h),p.sort(a);var u=d(p);n.set(i.doc._id,[u,i.changes])}l=i.seq}return n}function d(e){for(var t=new gr,n=0,s=e.length,r;n<s;n++){var o=e[n],a=[o.key,o.id];0<n&&0===Ve(o.key,r)&&a.push(n),t.set(Je(a),o),r=o.key}return t}var c=t(e.mapFun,function(e,t){var n={id:h._id,key:Ke(e)};"undefined"!==typeof t&&null!==t&&(n.value=Ke(t)),p.push(n)}),l=e.seq||0,u=new xs,p,h;return s().then(function(){return u.finish()}).then(function(){e.seq=l})}function w(t,s,r){0===r.group_level&&delete r.group_level;var a=r.group||r.group_level,c=n(t.reduceFun),l=[],u=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;s.forEach(function(t){var e=l[l.length-1],n=a?t.key:null;return a&&Array.isArray(n)&&(n=n.slice(0,u)),e&&0===Ve(e.groupKey,n)?(e.keys.push([t.key,t.id]),void e.values.push(t.value)):void l.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),s=[];for(var p=0,i=l.length;p<i;p++){var h=l[p],e=o(t.sourceDB,c,h.keys,h.values,!1);if(e.error&&e.error instanceof fs)throw e.error;s.push({value:e.error?null:e.output,key:h.groupKey})}return{rows:d(s,r.limit,r.skip)}}function C(e,t){return Es(k(e),function(){return x(e,t)})()}function x(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return a=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"===typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var s=et(e.doc._id);return{key:s[0],id:s[1],value:"value"in e.doc?e.doc.value:null}})})}function s(n){var s;if(s=r?w(e,n,t):{total_rows:a,offset:o,rows:n},t.update_seq&&(s.update_seq=e.seq),t.include_docs){var d=ks(n.map(i));return e.sourceDB.allDocs({keys:d,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new gr;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),n.forEach(function(e){var n=i(e),s=t.get(n);s&&(e.doc=s)}),s})}return s}var r=e.reduceFun&&!1!==t.reduce,o=t.skip||0,a;if("undefined"===typeof t.keys||t.keys.length||(t.limit=0,delete t.keys),"undefined"!==typeof t.keys){var d=t.keys,c=d.map(function(e){var s={startkey:Je([e]),endkey:Je([e,{}])};return t.update_seq&&(s.update_seq=!0),n(s)});return ur.all(c).then(B).then(s)}var l={descending:t.descending};t.update_seq&&(l.update_seq=!0);var u,p;if("start_key"in t&&(u=t.start_key),"startkey"in t&&(u=t.startkey),"end_key"in t&&(p=t.end_key),"endkey"in t&&(p=t.endkey),"undefined"!==typeof u&&(l.startkey=t.descending?Je([u,{}]):Je([u])),"undefined"!==typeof p){var h=!1!==t.inclusive_end;t.descending&&(h=!h),l.endkey=Je(h?[p,{}]:[p])}if("undefined"!==typeof t.key){var _=Je([t.key]),g=Je([t.key,{}]);l.descending?(l.endkey=_,l.startkey=g):(l.startkey=_,l.endkey=g)}return r||("number"===typeof t.limit&&(l.limit=t.limit),l.skip=o),n(l).then(s)}function T(e){return e.request({method:"POST",url:"_view_cleanup"})}function A(t){return t.get("_local/"+e).then(function(e){var n=new gr;Object.keys(e.views).forEach(function(e){var t=js(e),s="_design/"+t[0],r=t[1],o=n.get(s);o||(o=new _r,n.set(s,o)),o.add(r)});var s={keys:qs(n),include_docs:!0};return t.allDocs(s).then(function(s){var r={};s.rows.forEach(function(t){var s=t.key.substring(8);n.get(t.key).forEach(function(n){var o=s+"/"+n;e.views[o]||(o=n);var a=Object.keys(e.views[o]),i=t.doc&&t.doc.views&&t.doc.views[n];a.forEach(function(e){r[e]=r[e]||i})})});var o=Object.keys(r).filter(function(e){return!r[e]}),a=o.map(function(e){return Es(k(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return ur.all(a).then(function(){return{ok:!0}})})},v({ok:!0}))}function L(t,n,r){if("function"===typeof t._query)return f(t,n,r);if(U(t))return m(t,n,r);if("string"!==typeof n)return g(r,n),Ko.add(function(){var s=Ls(t,"temp_view/temp_view",n.map,n.reduce,!0,e);return s.then(function(e){return bs(q(e).then(function(){return C(e,r)}),function(){return e.db.destroy()})})}),Ko.finish();var o=n,a=js(o),i=a[0],d=a[1];return t.get("_design/"+i).then(function(n){var a=n.views&&n.views[d];if(!a)throw new ms("ddoc "+n._id+" has no view named "+d);s(n,d),g(r,a);var i=Ls(t,o,a.map,a.reduce,!1,e);return i.then(function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&rr(function(){q(e)}),C(e,r)):q(e).then(function(){return C(e,r)})})})}var j=vs(function(){var e=this;return"function"===typeof e._viewCleanup?y(e):U(e)?T(e):A(e)});return{query:function(e,t,n){var s=this;"function"===typeof t&&(n=t,t={}),t=t?h(t):{},"function"===typeof e&&(e={map:e});var r=ur.resolve().then(function(){return L(s,e,t)});return ys(r,n),r},viewCleanup:j}}("mrviews",function(e,t){if("function"===typeof e&&2===e.length){return function(n){return e(n,t)}}return Cs(e.toString(),t)},function(e){var t=e.toString(),n=Is(t);return n?n:Cs(t)},function(e,t){var n=e.views&&e.views[t];if("string"!==typeof n.map)throw new ms("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}),Zo=1,ea="pouchdb",ta=5,na=0;Us.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},Us.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?Ms(this.target,this.id,e,t,this.returnValue):ur.resolve(!0)},Us.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return Ms(this.src,this.id,e,t,this.returnValue)["catch"](function(e){if(Xs(e))return n.opts.writeSourceCheckpoint=!1,!0;throw e})}return ur.resolve(!0)};var sa={undefined:function(e,t){return 0===Ve(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return Ws(t,e).last_seq}};Us.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(e){return e.last_seq||na})["catch"](function(e){if(404!==e.status)throw e;return na}):e.target.get(e.id).then(function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||na:e.src.get(e.id).then(function(e){if(t.version!==e.version)return na;var n;return n=t.version?t.version.toString():"undefined",n in sa?sa[n](t,e):na},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:na}).then(function(){return na},function(n){return Xs(n)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):na});throw n})})["catch"](function(e){if(404!==e.status)throw e;return na})};var ra=0;ar(Js,or.EventEmitter),Js.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Js.prototype.ready=function(e,t){function n(){s.cancel()}var s=this;s._readyCalled||(s._readyCalled=!0,e.once("destroyed",n),t.once("destroyed",n),s.once("complete",function(){e.removeListener("destroyed",n),t.removeListener("destroyed",n)}))},ar(tr,or.EventEmitter),tr.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},De.plugin(function(e){e.adapter("idb",Sn,!0)}).plugin(function(e){e.adapter("websql",Jn,!0)}).plugin(function(e){e.adapter("http",_s,!1),e.adapter("https",_s,!1)}).plugin({query:function(e,t,n){return Yo.query.call(this,e,t,n)},viewCleanup:function(e){return Yo.viewCleanup.call(this,e)}}).plugin(function(e){e.replicate=Zs,e.sync=er,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return"undefined"===typeof this.replicateMethods&&(this.replicateMethods={from:function(t,n,s){return e.constructor.replicate(t,e,n,s)},to:function(t,n,s){return e.constructor.replicate(e,t,n,s)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}}),i.exports=De}).call(this,"undefined"===typeof global?"undefined"===typeof self?"undefined"===typeof window?{}:window:self:global)},{1:1,2:2,4:4,5:5,6:6,7:7,10:10,11:11,16:16}]},{},[17])(17)});</script><script>(function(){'use strict';Polymer({is:'app-pouchdb-conflict-resolution',properties:{strategy:{type:String,value:'firstWriteWins'},allowAncestralResolution:{type:Boolean,value:!1}},created:function(){this._eventTarget=null},attached:function(){this._eventTarget=Polymer.dom(this).host||document,this.listen(this._eventTarget,'app-pouchdb-conflict','resolveConflict')},detached:function(){this.unlisten(this._eventTarget,'app-pouchdb-conflict','resolveConflict')},resolveConflict:function(a){return this.strategy&&this[this.strategy]?void(a.detail.resolveConflict(this[this.strategy].bind(this)),!this.allowAncestralResolution&&a.stopImmediatePropagation()):Promise.reject('No resolution strategy available.')},firstWriteWins:function(a,b,c){return a.get(c._id).then(function(a){return{id:a._id,rev:a._rev}})},lastWriteWins:function(a,b,c){return a.get(c._id,{conflicts:!0}).then(function(b){return c._rev=b._rev,a.put(c)}.bind(this))}})})();</script><script>(function(){'use strict';var a=/\.splices$/,b=/\.length$/,c=/\.?#?([0-9]+)$/;Polymer.AppStorageBehavior={properties:{data:{type:Object,notify:!0,value:function(){return this.zeroValue}},sequentialTransactions:{type:Boolean,value:!1},log:{type:Boolean,value:!1}},observers:['__dataChanged(data.*)'],created:function(){this.__initialized=!1,this.__syncingToMemory=!1,this.__initializingStoredValue=null,this.__transactionQueueAdvances=Promise.resolve()},ready:function(){this._initializeStoredValue()},get isNew(){return!0},get transactionsComplete(){return this.__transactionQueueAdvances},get zeroValue(){},saveValue:function(){return Promise.resolve()},reset:function(){},destroy:function(){return this.data=this.zeroValue,this.saveValue()},initializeStoredValue:function(){return this.isNew?Promise.resolve():this._getStoredValue('data').then(function(a){return this._log('Got stored value!',a,this.data),null==a?this._setStoredValue('data',this.data||this.zeroValue):void this.syncToMemory(function(){this.set('data',a)})}.bind(this))},getStoredValue:function(){return Promise.resolve()},setStoredValue:function(a,b){return Promise.resolve(b)},memoryPathToStoragePath:function(a){return a},storagePathToMemoryPath:function(a){return a},syncToMemory:function(a){this.__syncingToMemory||(this._group('Sync to memory.'),this.__syncingToMemory=!0,a.call(this),this.__syncingToMemory=!1,this._groupEnd('Sync to memory.'))},valueIsEmpty:function(a){return Array.isArray(a)?0===a.length:Object.prototype.isPrototypeOf(a)?0===Object.keys(a).length:null==a},_getStoredValue:function(a){return this.getStoredValue(this.memoryPathToStoragePath(a))},_setStoredValue:function(a,b){return this.setStoredValue(this.memoryPathToStoragePath(a),b)},_enqueueTransaction:function(a){if(this.sequentialTransactions)a=a.bind(this);else{var b=a.call(this);a=function(){return b}}return this.__transactionQueueAdvances=this.__transactionQueueAdvances.then(a).catch(function(a){this._error('Error performing queued transaction.',a)}.bind(this))},_log:function(){this.log&&console.log.apply(console,arguments)},_error:function(){this.log&&console.error.apply(console,arguments)},_group:function(){this.log&&console.group.apply(console,arguments)},_groupEnd:function(){this.log&&console.groupEnd.apply(console,arguments)},_initializeStoredValue:function(){if(!this.__initializingStoredValue){this._group('Initializing stored value.');var a=this.__initializingStoredValue=this.initializeStoredValue().then(function(){this.__initialized=!0,this.__initializingStoredValue=null,this._groupEnd('Initializing stored value.')}.bind(this));return this._enqueueTransaction(function(){return a})}},__dataChanged:function(a){if(!(this.isNew||this.__syncingToMemory||!this.__initialized||this.__pathCanBeIgnored(a.path))){var b=this.__normalizeMemoryPath(a.path),c=a.value,d=c&&c.indexSplices;this._enqueueTransaction(function(){return this._log('Setting',b+':',d||c),d&&this.__pathIsSplices(b)&&(b=this.__parentPath(b),c=this.get(b)),this._setStoredValue(b,c)})}},__normalizeMemoryPath:function(a){for(var b=a.split('.'),c=[],d=[],e=[],f=0;f<b.length;++f)d.push(b[f]),/^#/.test(b[f])?e.push(this.get(c).indexOf(this.get(d))):e.push(b[f]),c.push(b[f]);return e.join('.')},__parentPath:function(a){var b=a.split('.');return b.slice(0,b.length-1).join('.')},__pathCanBeIgnored:function(a){return b.test(a)&&Array.isArray(this.get(this.__parentPath(a)))},__pathIsSplices:function(b){return a.test(b)&&Array.isArray(this.get(this.__parentPath(b)))},__pathRefersToArray:function(c){return(a.test(c)||b.test(c))&&Array.isArray(this.get(this.__parentPath(c)))},__pathTailToIndex:function(a){var b=a.split('.').pop();return window.parseInt(b.replace(c,'$1'),10)}}})();</script><script>(function(){'use strict';Polymer.AppPouchDBDatabaseBehavior={properties:{adapter:{type:String,value:null},dbName:{type:String},revsLimit:{type:Number,value:0},db:{type:Object,computed:'__computeDb(dbName, adapter, revsLimit)',notify:!0},upsert:{type:Boolean,value:!1},resolveConflict:{type:Function,value:null}},_put:function(a,b,c){return this.upsert?this._upsert(a,b,c):this._conflictAwareTransaction('put',c)},_post:function(a){return this.upsert?this._upsert('data',a,a):this._conflictAwareTransaction('post',a)},_upsert:function(a,b,c){var d=null==c._id?Promise.reject({status:404}):this.db.get(c._id);return this._log('Upsert',a,b,c),d.then(function(d){return this._log('Upsert -> update',a,b,c),'data'===a?(b._rev=d._rev,b._id=d._id,c=b):(this.set(a,b,{data:d}),c=d),this._conflictAwareTransaction('put',c)}.bind(this)).catch(function(d){if(404===d.status)return this._log('Upsert -> insert',a,b,c),this._conflictAwareTransaction('post',c);throw d}.bind(this))},_conflictAwareTransaction:function(a,b){return!a in this.db?Promise.reject('No such method:',a):(this._log('Conflict aware:',a,b),this.db[a](b).catch(function(c){var d=null;if(c&&409===c.status&&(this._log('Conflict for',a,b._id,c._rev,c._conflicts),d=this.resolveConflict,d||this.fire('app-pouchdb-conflict',{resolveConflict:function(a){a&&(d=a)}.bind(this)}),d))return this._log('Attempting conflict resolution..',a,b),Promise.resolve(d.call(this,this.db,a,b,c));throw c}.bind(this)))},__computeDb:function(a,b,c){if(this.db&&this.db.removeAllListeners(),!a)return null;var d={auto_compaction:!0};return c&&(d.adapter=c),b&&(d.revs_limit=b),new PouchDB(a,d)}}})();</script><script>(function(){'use strict';Polymer({is:'app-pouchdb-document',behaviors:[Polymer.AppStorageBehavior,Polymer.AppPouchDBDatabaseBehavior],properties:{docId:{type:String,value:null},rev:{type:String,readOnly:!0,value:null},changes:{type:Object,computed:'__computeChanges(db, docId)'}},observers:['__docRevChanged(data._rev)','__docChanged(db, data, docId, _readied)'],get isNew(){return null==this.docId},get zeroValue(){return{}},saveValue:function(){return this.db?(this.docId&&(this.data._id=this.docId),this._upsert('data',this.data,this.data).then(function(a){this.syncToMemory(function(){this.docId=a.id,this.set('data._id',a.id),this.set('data._rev',a.rev)})}.bind(this))):Promise.reject('No PouchDB instance available!')},reset:function(){this.docId=null,this.data=this.zeroValue},destroy:function(){return this.set('data._deleted',!0),this.transactionsComplete.then(function(){return this.reset()})},getStoredValue:function(a){return this.db.get(this.docId).then(function(b){return this.get(a,{data:b})}.bind(this)).catch(function(a){if(!(a&&404===a.status))throw a})},setStoredValue:function(a,b){return'data'===a&&null==b?Promise.reject('Unsupported attempt to unset PouchDB document by assigning null value. Perhaps you meant to set `data._deleted = true`?'):this._put(a,b,this.data)},__docChanged:function(a,b,c){this._log('Doc / ID changed',b,c),a&&null!=b&&null!=c&&b._id!=c&&(b._id=c,this._initializeStoredValue())},__docRevChanged:function(){this._setRev(null==this.data?null:this.data._rev)},__computeChanges:function(a,b){return this.changes&&this.changes.cancel(),null==a||null==b?null:a.changes({since:'now',live:!0,doc_ids:[b],include_docs:!0}).on('change',function(a){var b=a.doc;this.syncToMemory(function(){this.set('data',b)})}.bind(this))}})})();</script><script>(function(e){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=e();else if("function"===typeof define&&define.amd)define([],e);else{var t;t="undefined"===typeof window?"undefined"===typeof global?"undefined"===typeof self?this:self:global:window,t.pouchdbFind=e()}})(function(){var e,t=Math.ceil,r=Math.floor,n=Math.min,s=Math.abs,i=Number.MAX_VALUE;return function d(c,e,t){function r(s,i){if(!e[s]){if(!c[s]){var o="function"==typeof require&&require;if(!i&&o)return o(s,!0);if(n)return n(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var p=e[s]={exports:{}};c[s][0].call(p.exports,function(t){var e=c[s][1][t];return r(e?e:t)},p,p.exports,d,c,e,t)}return e[s].exports}for(var n="function"==typeof require&&require,s=0;s<t.length;s++)r(t[s]);return r}({1:[function(e,t){"use strict";function n(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e);}}var r=e(4),s=e(5),i=s.Promise;t.exports=function(e){var t=e.db,o=e.viewName,d=e.map,l=e.reduce,a=e.temporary,u=e.pluginName,c=n(d)+n(l)+"undefined";if(!a&&t._cachedViews){var p=t._cachedViews[c];if(p)return i.resolve(p)}return t.info().then(function(e){var n=e.db_name+"-mrview-"+(a?"temp":s.MD5(c));return r(t,"_local/"+u,function(e){e.views=e.views||{};var t=o;-1===t.indexOf("/")&&(t=o+"/"+o);var r=e.views[t]=e.views[t]||{};if(!r[n])return r[n]=!0,e}).then(function(){return t.registerDependentDatabase(n).then(function(e){var r=e.db;r.auto_compaction=!0;var s={name:n,db:r,sourceDB:t,adapter:t.adapter,mapFun:d,reduceFun:l};return s.db.get("_local/lastSeq")["catch"](function(e){if(404!==e.status)throw e}).then(function(e){return s.seq=e?e.seq:0,a||(t._cachedViews=t._cachedViews||{},t._cachedViews[c]=s,s.db.on("destroyed",function(){delete t._cachedViews[c]})),s})})})})}},{4:4,5:5}],2:[function(e,t){(function(n){"use strict";function r(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,r)}catch(t){}}function s(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,s)}catch(t){}}function i(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function o(e){return 1===e.length&&/^1-/.test(e[0].rev)}function d(e,t){var n=f(e.key,t.key);return 0===n?f(e.value,t.value):n}function l(e,t,n){return(n=n||0,"number"===typeof t)?e.slice(n,t+n):0<n?e.slice(n):e}function a(e){var t=e.value,n=t&&"object"===typeof t&&t._id||e.id;return n}function u(t,n){try{t.emit("error",n)}catch(e){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(n)}}function c(t,e,n){try{return{output:e.apply(null,n)}}catch(n){return u(t,n),{error:n}}}function p(e,t){var n=e.descending?"endkey":"startkey",s=e.descending?"startkey":"endkey";if("undefined"!==typeof e[n]&&"undefined"!==typeof e[s]&&0<f(e[n],e[s]))throw new r("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");else if(t.reduce&&!1!==e.reduce)if(e.include_docs)throw new r("{include_docs:true} is invalid for reduce");else if(e.keys&&1<e.keys.length&&!e.group&&!e.group_level)throw new r("Multi-key fetches for reduce views must use {group: true}");if(e.group_level){if("number"!==typeof e.group_level)throw new r("Invalid value for integer: \""+e.group_level+"\"");if(0>e.group_level)throw new r("Invalid value for positive integer: \""+e.group_level+"\"")}}function g(e){return function(t){if(404===t.status)return e;throw t}}var y=e(26),h=e(3),f=y.collate,m=y.toIndexableString,k=y.normalizeKey,b=e(1);"undefined"!==typeof console&&"function"===typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var v=e(5),_=v.Promise,x={},$=new h,w=50;v.inherits(r,Error),v.inherits(s,Error),t.exports=function(e){function t(e,t,n){function r(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):_.resolve({rows:[]})}function s(e,t){for(var n=[],r={},s=0,i=t.rows.length;s<i;s++){var o=t.rows[s],d=o.doc;if(d&&(n.push(d),r[d._id]=!0,d._deleted=!a[d._id],!d._deleted)){var l=a[d._id];"value"in l&&(d.value=l.value)}}var u=Object.keys(a);return u.forEach(function(e){if(!r[e]){var t={_id:e},s=a[e];"value"in s&&(t.value=s.value),n.push(t)}}),e.keys=v.uniq(u.concat(e.keys)),n.push(e),n}var i="_local/doc_"+e,d={_id:i,keys:[]},l=n[e],a=l.indexableKeysToKeyValues,u=l.changes;return function(){return o(u)?_.resolve(d):t.db.get(i)["catch"](g(d))}().then(function(e){return r(e).then(function(t){return s(e,t)})})}function r(e,n,r){var s="_local/lastSeq";return e.db.get(s)["catch"](g({_id:s,seq:0})).then(function(s){var i=Object.keys(n);return _.all(i.map(function(r){return t(r,e,n)})).then(function(t){var n=v.flatten(t);return s.seq=r,n.push(s),e.db.bulkDocs({docs:n})})})}function u(e){var t="string"===typeof e?e:e.name,n=x[t];return n||(n=x[t]=new h),n}function j(e){return v.sequentialize(u(e),function(){return q(e)})()}function q(e){function t(t,n){return function(){return r(e,t,n)}}var n,s,i=N(e.mapFun,function(e,t){var r={id:s._id,key:k(e)};"undefined"!==typeof t&&null!==t&&(r.value=k(t)),n.push(r)}),o=e.seq||0,a=new h;return new _(function(r,l){function u(){a.finish().then(function(){e.seq=o,r()})}function p(){e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:o,limit:w}).on("complete",function(r){var g=r.results;if(!g.length)return u();for(var y,h={},k=0,b=g.length;k<b;k++){if(y=g[k],"_"!==y.doc._id[0]){n=[],s=y.doc,s._deleted||c(e.sourceDB,i,[s]),n.sort(d);for(var l,v={},_=0,x=n.length;_<x;_++){var $=n[_],j=[$.key,$.id];0===f($.key,l)&&j.push(_);var q=m(j);v[q]=$,l=$.key}h[y.doc._id]={indexableKeysToKeyValues:v,changes:y.changes}}o=y.seq}return a.add(t(h,o)),g.length<w?u():p()}).on("error",function(e){l(e)})}p()})}function O(t,n,r){0===r.group_level&&delete r.group_level;var s=r.group||r.group_level,o=C(t.reduceFun),d=[],a=r.group_level;n.forEach(function(t){var e=d[d.length-1],n=s?t.key:null;return s&&Array.isArray(n)&&"number"===typeof a&&(n=n.length>a?n.slice(0,a):n),e&&0===f(e.key[0][0],n)?(e.key.push([n,t.id]),void e.value.push(t.value)):void d.push({key:[[n,t.id]],value:[t.value]})});for(var u=0,i=d.length;u<i;u++){var p=d[u],e=c(t.sourceDB,o,[p.key,p.value,!1]);if(e.error&&/BuiltInError/.test(e.error.constructor))throw e.error;p.value=e.error?null:e.output,p.key=p.key[0][0]}return{rows:l(d,r.limit,r.skip)}}function A(e,t){return v.sequentialize(u(e),function(){return F(e,t)})()}function F(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return s=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"===typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var r=y.parseIndexableString(e.doc._id);return{key:r[0],id:r[1],value:"value"in e.doc?e.doc.value:null}})})}function r(n){var r;if(r=i?O(e,n,t):{total_rows:s,offset:o,rows:n},t.include_docs){var d=v.uniq(n.map(a));return e.sourceDB.allDocs({keys:d,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t={};return e.rows.forEach(function(e){e.doc&&(t["$"+e.id]=e.doc)}),n.forEach(function(e){var n=a(e),r=t["$"+n];r&&(e.doc=r)}),r})}return r}var s,i=e.reduceFun&&!1!==t.reduce,o=t.skip||0;"undefined"===typeof t.keys||t.keys.length||(t.limit=0,delete t.keys);var d=function(e){return e.reduce(function(e,t){return e.concat(t)})};if("undefined"!==typeof t.keys){var l=t.keys,u=l.map(function(e){var t={startkey:m([e]),endkey:m([e,{}])};return n(t)});return _.all(u).then(d).then(r)}var c={descending:t.descending};if("undefined"!==typeof t.startkey&&(c.startkey=t.descending?m([t.startkey,{}]):m([t.startkey])),"undefined"!==typeof t.endkey){var p=!1!==t.inclusive_end;t.descending&&(p=!p),c.endkey=m(p?[t.endkey,{}]:[t.endkey])}if("undefined"!==typeof t.key){var g=m([t.key]),h=m([t.key,{}]);c.descending?(c.endkey=g,c.startkey=h):(c.startkey=g,c.endkey=h)}return i||("number"===typeof t.limit&&(c.limit=t.limit),c.skip=o),n(c).then(r)}function D(e){return e.get("_local/"+I).then(function(t){var n={};Object.keys(t.views).forEach(function(e){var t=i(e),r="_design/"+t[0],s=t[1];n[r]=n[r]||{},n[r][s]=!0});var r={keys:Object.keys(n),include_docs:!0};return e.allDocs(r).then(function(r){var s={};r.rows.forEach(function(e){var r=e.key.substring(8);Object.keys(n[e.key]).forEach(function(n){var i=r+"/"+n;t.views[i]||(i=n);var o=Object.keys(t.views[i]),d=e.doc&&e.doc.views&&e.doc.views[n];o.forEach(function(e){s[e]=s[e]||d})})});var i=Object.keys(s).filter(function(e){return!s[e]}),o=i.map(function(t){return v.sequentialize(u(t),function(){return new e.constructor(t,e.__opts).destroy()})()});return _.all(o).then(function(){return{ok:!0}})})},g({ok:!0}))}function S(e,t,r){if("string"!==typeof t){p(r,t);var o={db:e,viewName:"temp_view/temp_view",map:t.map,reduce:t.reduce,temporary:!0,pluginName:I};return $.add(function(){return b(o).then(function(e){return v.fin(j(e).then(function(){return A(e,r)}),function(){return e.db.destroy()})})}),$.finish()}var d=t,l=i(d),a=l[0],u=l[1];return e.get("_design/"+a).then(function(t){var i=t.views&&t.views[u];if(!i)throw new s("ddoc "+t._id+" has no view named "+u);E(t,u),p(r,i);var o={db:e,viewName:d,map:i.map,reduce:i.reduce,pluginName:I};return b(o).then(function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&n.nextTick(function(){j(e)}),A(e,r)):j(e).then(function(){return A(e,r)})})})}var I=e.name,N=e.mapper,C=e.reducer,E=e.ddocValidator,B=v.callbackify(function(){var e=this;return D(e)});return{query:function(e,t,n){var r=this;"function"===typeof t&&(n=t,t={}),t=v.extend(!0,{},t),"function"===typeof e&&(e={map:e});var s=_.resolve().then(function(){return S(r,e,t)});return v.promisedCallback(s,n),s},viewCleanup:B}}}).call(this,e(34))},{1:1,3:3,5:5,26:26,34:34}],3:[function(e,t){"use strict";function n(){this.promise=new r(function(e){e()})}var r=e(5).Promise;n.prototype.add=function(e){return this.promise=this.promise["catch"](function(){}).then(function(){return e()}),this.promise},n.prototype.finish=function(){return this.promise},t.exports=n},{5:5}],4:[function(e,t){"use strict";var n=e(31).upsert;t.exports=function(e,t,r){return n.apply(e,[t,r])}},{31:31}],5:[function(e,t,n){(function(t){"use strict";n.Promise=e(29),n.inherits=e(23),n.extend=e(28);var r=e(18);n.promisedCallback=function(e,n){return n&&e.then(function(e){t.nextTick(function(){n(null,e)})},function(e){t.nextTick(function(){n(e)})}),e},n.callbackify=function(e){return r(function(t){var r=t.pop(),s=e.apply(this,t);return"function"===typeof r&&n.promisedCallback(s,r),s})},n.fin=function(e,t){return e.then(function(e){var n=t();return"function"===typeof n.then?n.then(function(){return e}):e},function(e){var n=t();if("function"===typeof n.then)return n.then(function(){throw e});throw e})},n.sequentialize=function(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}},n.flatten=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t},n.uniq=function(e){for(var t={},n=0,r=e.length;n<r;n++)t["$"+e[n]]=!0;var s=Object.keys(t),i=Array(s.length);for(n=0,r=s.length;n<r;n++)i[n]=s[n].substring(1);return i};var s=e(19),i=e(35);n.MD5=function(e){return t.browser?i.hash(e):s.createHash("md5").update(e).digest("hex")}}).call(this,e(34))},{18:18,19:19,23:23,28:28,29:29,34:34,35:35}],6:[function(e,t,n){"use strict";var r=e(16);n.createIndex=function(e,t,n){t=r(t),e.request({method:"POST",url:"_index",body:t},n)},n.find=function(e,t,n){e.request({method:"POST",url:"_find",body:t},n)},n.getIndexes=function(e,t){e.request({method:"GET",url:"_index"},t)},n.deleteIndex=function(e,t,n){var r=t.ddoc,s=t.type||"json",i=t.name;if(!r)return n(new Error("you must provide an index's ddoc"));if(!i)return n(new Error("you must provide an index's name"));var o="_index/"+[r,s,i].map(encodeURIComponent).join("/");e.request({method:"DELETE",url:o},n)}},{16:16}],7:[function(e,t){"use strict";function n(e,t){return function(n){for(var r=[],s=0,i=e.length;s<i;s++){for(var o,d=u(e[s]),l=n,a=0,c=d.length;a<c&&(o=d[a],l=l[o],!!l);a++);r.push(l)}t(r)}}function r(e,t){var n=u(e);return function(e){for(var r,s=e,o=0,i=n.length;o<i;o++)if(r=n[o],s=s[r],!s)return;t(s)}}function s(e,t){return function(n){t(n[e])}}function i(e,t){return function(n){for(var r=[],s=0,i=e.length;s<i;s++)r.push(n[e[s]]);t(r)}}function o(e){for(var t,n=0,r=e.length;n<r;n++)if(t=e[n],-1!==t.indexOf("."))return!1;return!0}function d(e,t){var d=o(e),l=1===e.length;return d?l?s(e[0],t):i(e,t):l?r(e[0],t):n(e,t)}var l=e(15),a=e(2),u=l.parseField,c=a({name:"indexes",mapper:function(e,t){var n=Object.keys(e.fields);return d(n,t)},reducer:function(){throw new Error("reduce not supported")},ddocValidator:function(e,t){var n=e.views[t];if(!n.map||!n.map.fields)throw new Error("ddoc "+e._id+" with view "+t+" doesn't have map.fields defined. maybe it wasn't created by this plugin?")}});t.exports=c},{2:2,15:15}],8:[function(e,t){"use strict";function n(e,t,n){return i.upsert.call(e,t,n)}var r=e(17),s=r.log,i=e(31),o=e(7),d=e(15),l=d.validateIndex,a=d.massageIndexDef,u=e(16);t.exports=function(e,t){t=u(t);var i=r.clone(t.index);t.index=a(t.index),l(t.index);var d=r.MD5(JSON.stringify(t)),c=t.name||"idx-"+d,p=t.ddoc||"idx-"+d,g="_design/"+p,y=!1,h=!1;return s("creating index",g),n(e,g,function(e){return(e._rev&&"query"!==e.language&&(y=!0),e.language="query",e.views=e.views||{},h=!!e.views[c],!h)&&(e.views[c]={map:{fields:r.mergeObjects(t.index.fields)},reduce:"_count",options:{def:i}},e)}).then(function(){if(y)throw new Error("invalid language for ddoc with id \""+g+"\" (should be \"query\")")}).then(function(){return o.query.call(e,p+"/"+c,{limit:0,reduce:!1}).then(function(){return{id:g,name:c,result:h?"exists":"created"}})})}},{7:7,15:15,16:16,17:17,31:31}],9:[function(e,t){"use strict";var n=e(7),r=e(4);t.exports=function(e,t){if(!t.ddoc)throw new Error("you must supply an index.ddoc when deleting");if(!t.name)throw new Error("you must supply an index.name when deleting");var s=t.ddoc,i=t.name;return r(e,s,function(e){return 1===Object.keys(e.views).length&&e.views[i]?{_id:s,_deleted:!0}:(delete e.views[i],e)}).then(function(){return n.viewCleanup.apply(e)}).then(function(){return{ok:!0}})}},{4:4,7:7}],10:[function(e,t){"use strict";function n(e){function t(t){return e.map(function(e){var n=b(e),r=_(n),s=$(t,r);return s})}return function(e,n){var r=t(e.doc),s=t(n.doc),i=f(r,s);return 0===i?x.compare(e.doc._id,n.doc._id):i}}function r(e,t,n){return n.every(function(n){var r=t[n],o=_(n),d=$(e,o);return k(n)?i(n,r,e):s(r,e,o,d)})}function s(e,t,n,r){return!e||Object.keys(e).every(function(s){var i=e[s];return o(s,t,i,n,r)})}function i(e,t,n){return"$or"===e?t.some(function(e){return r(n,e,Object.keys(e))}):"$not"===e?!r(n,t,Object.keys(t)):!t.find(function(e){return r(n,e,Object.keys(e))})}function o(e,t,n,r,s){if(!w[e])throw new Error("unknown operator \""+e+"\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type or $all");return w[e](t,n,r,s)}function d(e){return"undefined"!==typeof e&&null!==e}function l(e){return"undefined"!==typeof e}function a(e,t){var n=t[0],r=t[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%n===r}function u(e,t){return t.some(function(t){return e instanceof Array?-1<e.indexOf(t):e===t})}function c(e,t){return t.every(function(t){return-1<e.indexOf(t)})}function p(e,t){return e.length===t}function g(e,t){var n=new RegExp(t);return n.test(e)}function y(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"===typeof e;case"number":return"number"===typeof e;case"string":return"string"===typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e);}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}var h=e(24),f=e(26).collate,m=e(15),k=m.isCombinationalField,b=m.getKey,v=m.getValue,_=m.parseField,x=e(17),$=x.getFieldFromDoc,w={$elemMatch:function(e,t,n,i){return!!h(i)&&0!==i.length&&("object"===typeof i[0]?i.some(function(e){return r(e,t,Object.keys(t))}):i.some(function(r){return s(t,e,n,r)}))},$eq:function(e,t,n,r){return l(r)&&0===f(r,t)},$gte:function(e,t,n,r){return l(r)&&0<=f(r,t)},$gt:function(e,t,n,r){return l(r)&&0<f(r,t)},$lte:function(e,t,n,r){return l(r)&&0>=f(r,t)},$lt:function(e,t,n,r){return l(r)&&0>f(r,t)},$exists:function(e,t,n,r){return t?l(r):!l(r)},$mod:function(e,t,n,r){return d(r)&&a(r,t)},$ne:function(e,t,n,r){return t.every(function(e){return 0!==f(r,e)})},$in:function(e,t,n,r){return d(r)&&u(r,t)},$nin:function(e,t,n,r){return d(r)&&!u(r,t)},$size:function(e,t,n,r){return d(r)&&p(r,t)},$all:function(e,t,n,r){return h(r)&&c(r,t)},$regex:function(e,t,n,r){return d(r)&&g(r,t)},$type:function(e,t,n,r){return y(r,t)}};t.exports=function(e,t,s){if(e=e.filter(function(e){return r(e.doc,t.selector,s)}),t.sort){var i=n(t.sort);e=e.sort(i),"string"!==typeof t.sort[0]&&"desc"===v(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var o=t.skip||0,d=("limit"in t?t.limit:e.length)+o;e=e.slice(o,d)}return e}},{15:15,17:17,24:24,26:26}],11:[function(e,t){"use strict";function n(e){return e.ddoc.substring(8)+"/"+e.name}function r(e,t){var n=i(t);return n.descending?("endkey"in n&&"string"!==typeof n.endkey&&(n.endkey=""),"startkey"in n&&"string"!==typeof n.startkey&&(n.limit=0)):("startkey"in n&&"string"!==typeof n.startkey&&(n.startkey=""),"endkey"in n&&"string"!==typeof n.endkey&&(n.limit=0)),"key"in n&&"string"!==typeof n.key&&(n.limit=0),e.allDocs(n)}var s=e(17),i=s.clone,o=e(13),d=e(26).collate,l=e(7),a=e(12),u=e(15),c=e(10),p=u.massageSelector,g=u.massageSort,y=u.getValue,h=u.validateFindRequest,f=u.validateSort,m=u.reverseOptions,k=u.filterInclusiveStart,b=s.Promise;t.exports=function(e,t){return t.selector&&(t.selector=p(t.selector)),t.sort&&(t.sort=g(t.sort)),h(t),o(e).then(function(i){var o=a(t,i.indexes),u=o.index;f(t,u);var p=s.extend(!0,{include_docs:!0,reduce:!1},o.queryOpts);if("startkey"in p&&"endkey"in p&&0<d(p.startkey,p.endkey))return{docs:[]};var g=t.sort&&"string"!==typeof t.sort[0]&&"desc"===y(t.sort[0]);return g&&(p.descending=!0,p=m(p)),o.inMemoryFields.length||("limit"in t&&(p.limit=t.limit),"skip"in t&&(p.skip=t.skip)),b.resolve().then(function(){if("_all_docs"===u.name)return r(e,p);var t=n(u);return l.query.call(e,t,p)}).then(function(e){!1===p.inclusive_start&&(e.rows=k(e.rows,p.startkey,u)),o.inMemoryFields.length&&(e.rows=c(e.rows,t,o.inMemoryFields));var n={docs:e.rows.map(function(e){var n=e.doc;return t.fields?s.pick(n,t.fields):n})};return u.defaultUsed&&(n.warning="no matching index found, create an index to optimize query time"),n})})}},{7:7,10:10,12:12,13:13,15:15,17:17,26:26}],12:[function(e,t){"use strict";function n(e,t){for(var n,r=e.def.fields.map(w),s=0,i=r.length;s<i;s++)if(n=r[s],t===n)return!0;return!1}function r(e,t){var n=e[t],r=w(n);return"$eq"!==r}function s(e,t){var n=t.def.fields.map(w);return e.slice().sort(function(e,t){var r=n.indexOf(e),s=n.indexOf(t);return-1===r&&(r=i),-1===s&&(s=i),_.compare(r,s)})}function o(e,t,o){o=s(o,e);for(var d,l=!1,a=0,i=o.length;a<i;a++){if(d=o[a],l||!n(e,d))return o.slice(a);a<i-1&&r(t,d)&&(l=!0)}return[]}function d(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n];Object.keys(r).forEach(function(e){"$ne"===e&&t.push(n)})}),t}function l(e,t,n,r){var i=_.flatten(e,o(t,n,r),d(n));return s(_.uniq(i),t)}function a(e,t,n){if(t){var r=_.oneArrayIsStrictSubArrayOfOther(t,e),s=_.oneArrayIsSubArrayOfOther(n,e);return r&&s}return _.oneSetIsSubArrayOfOther(n,e)}function u(e){return-1===A.indexOf(e)}function c(e,t){var n=e[0],r=t[n],s=Object.keys(r).some(function(e){return!u(e)});if(!s)return!1;var i=1===Object.keys(r).length&&"$ne"===w(r);return!i}function p(e,t,n,r){var s=e.def.fields.map(w),i=a(s,t,n);return!!i&&c(s,r)}function g(e,t,n,r){return r.reduce(function(r,s){var i=p(s,n,t,e);return i&&r.push(s),r},[])}function y(e,t,n,r){var s=g(e,t,n,r);if(0===s.length){var i=r[0];return i.defaultUsed=!0,i}if(1===s.length)return s[0];var o=_.arrayToObject(t);return _.max(s,function(e){for(var t,n=e.def.fields.map(w),r=0,s=0,i=n.length;s<i;s++)t=n[s],o[t]&&r++;return r})}function h(e,t){return"$eq"===e?{key:t}:"$lte"===e?{endkey:t}:"$gte"===e?{startkey:t}:"$lt"===e?{endkey:t,inclusive_end:!1}:"$gt"===e?{startkey:t,inclusive_start:!1}:void 0}function f(e,t){var n,r=w(t.def.fields[0]),s=e[r],i=[],o=Object.keys(s);return o.forEach(function(e){if(u(e))return void i.push(r);var t=s[e],o=h(e,t);n=n?_.mergeObjects([n,o]):o}),{queryOpts:n,inMemoryFields:i}}function m(e,t){return"$eq"===e?{startkey:t,endkey:t}:"$lte"===e?{endkey:t}:"$gte"===e?{startkey:t}:"$lt"===e?{endkey:t,inclusive_end:!1}:"$gt"===e?{startkey:t,inclusive_start:!1}:void 0}function k(e,t){function n(e){!1!==r&&l.push(q),!1!==s&&a.push(O),d=o.slice(e)}for(var r,s,o=t.def.fields.map(w),d=[],l=[],a=[],u=0,i=o.length;u<i;u++){var c=o[u],p=e[c];if(!p){n(u);break}else if(0<u){if("$ne"in p){n(u);break}var g=Object.keys(e[o[u-1]]),y=_.arrayEquals(g,["$eq"]),h=_.arrayEquals(g,Object.keys(p));if(("$gt"in p||"$gte"in p||"$lt"in p||"$lte"in p)&&!y&&!h){n(u);break}}for(var f=Object.keys(p),k=null,b=0;b<f.length;b++){var v=f[b],x=p[v],$=m(v,x);k=k?_.mergeObjects([k,$]):$}l.push("startkey"in k?k.startkey:q),a.push("endkey"in k?k.endkey:O),"inclusive_start"in k&&(r=k.inclusive_start),"inclusive_end"in k&&(s=k.inclusive_end)}var j={startkey:l,endkey:a};return"undefined"!==typeof r&&(j.inclusive_start=r),"undefined"!==typeof s&&(j.inclusive_end=s),{queryOpts:j,inMemoryFields:d}}function b(){return{queryOpts:{startkey:null},inMemoryFields:[]}}function v(e,t){return t.defaultUsed?b(e,t):1===t.def.fields.length?f(e,t):k(e,t)}var _=e(17),x=_.log,$=e(15),w=$.getKey,j=$.getUserFields,q=null,O={"￿":{}},A=["$eq","$gt","$gte","$lt","$lte"];t.exports=function(e,t){x("planning query",e);var n=e.selector,r=e.sort,s=j(n,r),i=s.fields,o=s.sortOrder,d=y(n,i,o,t),a=v(n,d),u=a.queryOpts,c=a.inMemoryFields,p=l(c,d,n,i),g={queryOpts:u,index:d,inMemoryFields:p};return x("query plan",g),g}},{15:15,17:17}],13:[function(e,t){"use strict";var n=e(17),r=e(15),s=r.massageIndexDef;t.exports=function(e){return e.allDocs({startkey:"_design/",endkey:"_design/\uFFFF",include_docs:!0}).then(function(e){var t={indexes:[{ddoc:null,name:"_all_docs",type:"special",def:{fields:[{_id:"asc"}]}}]};return t.indexes=n.flatten(t.indexes,e.rows.filter(function(e){return"query"===e.doc.language}).map(function(e){var t=void 0===e.doc.views?[]:Object.keys(e.doc.views);return t.map(function(t){var n=e.doc.views[t];return{ddoc:e.id,name:t,type:"json",def:s(n.options.def)}})})),t.indexes.sort(function(e,t){return n.compare(e.name,t.name)}),t.total_rows=t.indexes.length,t})}},{15:15,17:17}],14:[function(e,t,n){"use strict";var r=e(17),s=r.callbackify;n.createIndex=s(e(8)),n.find=s(e(11)),n.getIndexes=s(e(13)),n.deleteIndex=s(e(9))},{8:8,9:9,11:11,13:13,17:17}],15:[function(e,t){"use strict";function n(e){return Object.keys(e)[0]}function r(e){return e[n(e)]}function o(e){return-1<h.indexOf(e)}function d(e,t,n){"undefined"!==typeof n.$eq||("undefined"===typeof n.$gte?"undefined"===typeof n.$gt?n[e]=t:"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t))}function l(e,t,n){"undefined"!==typeof n.$eq||("undefined"===typeof n.$lte?"undefined"===typeof n.$lt?n[e]=t:"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t))}function a(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function u(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function c(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(n){var r=e[n];if("object"!==typeof r&&(r={$eq:r}),o(n))t[n]=r instanceof Array?r.map(function(e){return c([e])}):c([r]);else{var s=t[n]=t[n]||{};Object.keys(r).forEach(function(e){var t=r[e];return"$gt"===e||"$gte"===e?d(e,t,s):"$lt"===e||"$lte"===e?l(e,t,s):"$ne"===e?a(t,s):"$eq"===e?u(t,s):void(s[e]=t)})}})}),t}function p(e,t){for(var r,s=[],o=0;o<t.def.fields.length;o++)r=n(t.def.fields[o]),s.push(e[r]);return s}var g=e(17),y=e(26),h=["$or","$nor","$not"];t.exports={getKey:n,getValue:r,massageSort:function(e){if(!Array.isArray(e))throw new Error("invalid sort json - should be an array");return e.map(function(e){if("string"===typeof e){var t={};return t[e]="asc",t}return e})},massageSelector:function(e){var t=g.clone(e),n=!1;"$and"in t&&(t=c(t.$and),n=!0),"$not"in t&&(t.$not=c([t.$not]));for(var r=Object.keys(t),s=0;s<r.length;s++){var i=r[s],o=t[i];"object"!==typeof o||null===o?o={$eq:o}:"$ne"in o&&!n&&(o.$ne=[o.$ne]),t[i]=o}return t},validateIndex:function(e){var t=e.fields.filter(function(e){return"asc"===r(e)});if(0!==t.length&&t.length!==e.fields.length)throw new Error("unsupported mixed sorting")},validateFindRequest:function(e){if("object"!==typeof e.selector)throw new Error("you must provide a selector when you find()")},validateSort:function(e,t){if(t.defaultUsed&&e.sort){var n=e.sort.filter(function(e){return"_id"!==Object.keys(e)[0]}).map(function(e){return Object.keys(e)[0]});if(0<n.length)throw new Error("Cannot sort on field(s) \""+n.join(",")+"\" when using the default index")}t.defaultUsed},reverseOptions:function(e){var t=g.clone(e);return delete t.startkey,delete t.endkey,delete t.inclusive_start,delete t.inclusive_end,"endkey"in e&&(t.startkey=e.endkey),"startkey"in e&&(t.endkey=e.startkey),"inclusive_start"in e&&(t.inclusive_end=e.inclusive_start),"inclusive_end"in e&&(t.inclusive_start=e.inclusive_end),t},filterInclusiveStart:function(e,t,n){for(var r=n.def.fields,o=0,i=e.length;o<i;o++){var d=e[o],l=p(d.doc,n);if(1===r.length)l=l[0];else for(;l.length>t.length;)l.pop();if(0<s(y.collate(l,t)))break}return 0<o?e.slice(o):e},massageIndexDef:function(e){return e.fields=e.fields.map(function(e){if("string"===typeof e){var t={};return t[e]="asc",t}return e}),e},parseField:g.parseField,getUserFields:function(e,t){var r,s=Object.keys(e),o=t?t.map(n):[];return(r=s.length>=o.length?s:o,0===o.length)?{fields:r}:(r=r.sort(function(e,t){var n=o.indexOf(e);-1===n&&(n=i);var r=o.indexOf(t);return-1===r&&(r=i),n<r?-1:n>r?1:0}),{fields:r,sortOrder:t.map(n)})},isCombinationalField:o}},{17:17,26:26}],16:[function(e,t){"use strict";var n=e(17),r=n.clone;t.exports=function(e){return e=r(e),e.index||(e.index={}),["type","name","ddoc"].forEach(function(t){e.index[t]&&(e[t]=e.index[t],delete e.index[t])}),e.fields&&(e.index.fields=e.fields,delete e.fields),e.type||(e.type="json"),e}},{17:17}],17:[function(e,t,r){(function(t){"use strict";var s=e(29);r.once=function(e){var t=!1;return r.getArguments(function(n){if(t)throw console.trace(),new Error("once called  more than once");else t=!0,e.apply(this,n)})},r.getArguments=function(e){return function(){for(var t=arguments.length,n=Array(t),r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}},r.toPromise=function(e){return r.getArguments(function(n){var i,o=this,d="function"===typeof n[n.length-1]&&n.pop();d&&(i=function(e,n){t.nextTick(function(){d(e,n)})});var l=new s(function(t,s){try{var i=r.once(function(e,n){e?s(e):t(n)});n.push(i),e.apply(o,n)}catch(t){s(t)}});return i&&l.then(function(e){i(null,e)},i),l.cancel=function(){return this},l})},r.inherits=e(23),r.Promise=s,r.clone=function(e){return r.extend(!0,{},e)},r.extend=e(28),r.callbackify=function(e){return r.getArguments(function(t){var n=t.pop(),s=e.apply(this,t);return r.promisedCallback(s,n),s})},r.promisedCallback=function(e,n){return e.then(function(e){t.nextTick(function(){n(null,e)})},function(e){t.nextTick(function(){n(e)})}),e};var i=e(19),o=e(35);r.MD5=function(e){return t.browser?o.hash(e):i.createHash("md5").update(e).digest("hex")},r.flatten=r.getArguments(function(e){for(var t,n=[],s=0,i=e.length;s<i;s++)t=e[s],Array.isArray(t)?n=n.concat(r.flatten.apply(null,t)):n.push(t);return n}),r.mergeObjects=function(e){for(var t={},n=0,s=e.length;n<s;n++)t=r.extend(!0,t,e[n]);return t},r.getFieldFromDoc=function(e,t){for(var n,r=e,s=0,i=t.length;s<i&&(n=t[s],r=r[n],!!r);s++);return r},r.setFieldInDoc=function(e,t,n){for(var r,s=0,i=t.length;s<i-1;s++)r=t[s],e=e[r]={};e[t[i-1]]=n},r.parseField=function(e){for(var t,n=[],r="",s=0,i=e.length;s<i;s++)t=e[s],"."===t?0<s&&"\\"===e[s-1]?r=r.substring(0,r.length-1)+".":(n.push(r),r=""):r+=t;return n.push(r),n},r.pick=function(e,t){for(var n={},s=0,i=t.length;s<i;s++){var o=r.parseField(t[s]),d=r.getFieldFromDoc(e,o);"undefined"!==typeof d&&r.setFieldInDoc(n,o,d)}return n},r.oneArrayIsSubArrayOfOther=function(e,t){for(var r=0,s=n(e.length,t.length);r<s;r++)if(e[r]!==t[r])return!1;return!0},r.oneArrayIsStrictSubArrayOfOther=function(e,t){return!(e.length>t.length)&&r.oneArrayIsSubArrayOfOther(e,t)},r.oneSetIsSubArrayOfOther=function(e,t){e=e.slice();for(var n,r,s=0,i=t.length;s<i&&(n=t[s],!!e.length);s++){if(r=e.indexOf(n),-1===r)return!1;e.splice(r,1)}return!0},r.compare=function(e,t){return e<t?-1:e>t?1:0},r.arrayToObject=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t},r.max=function(e,t){for(var n=null,r=-1,s=0,i=e.length;s<i;s++){var o=e[s],d=t(o);d>r&&(r=d,n=o)}return n},r.arrayEquals=function(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0},r.uniq=function(e){for(var t={},n=0;n<e.length;n++)t["$"+e[n]]=!0;return Object.keys(t).map(function(e){return e.substring(1)})},r.log=e(20)("pouchdb:find")}).call(this,e(34))},{19:19,20:20,23:23,28:28,29:29,34:34,35:35}],18:[function(e,t){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}}},{}],19:[function(){},{}],20:[function(e,t,n){function r(){var e;try{e=n.storage.debug}catch(t){}return e}n=t.exports=e(21),n.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var s=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"===e||(s++,"%c"===e&&(i=s))}),e.splice(i,0,r),e},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(t){}},n.load=r,n.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(r())},{21:21}],21:[function(e,t,n){function r(){return n.colors[i++%n.colors.length]}n=t.exports=function(e){function t(){}function i(){var e=i,t=+new Date,o=t-(s||t);e.diff=o,e.prev=s,e.curr=t,s=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=r());var d=Array.prototype.slice.call(arguments);d[0]=n.coerce(d[0]),"string"!==typeof d[0]&&(d=["%o"].concat(d));var l=0;d[0]=d[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;l++;var s=n.formatters[r];if("function"===typeof s){var i=d[l];t=s.call(e,i),d.splice(l,1),l--}return t}),"function"===typeof n.formatArgs&&(d=n.formatArgs.apply(e,d));var a=i.log||n.log||console.log.bind(console);a.apply(e,d)}t.enabled=!1,i.enabled=!0;var o=n.enabled(e)?i:t;return o.namespace=e,o},n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,s=0;s<r;s++)t[s]&&(e=t[s].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e(25),n.names=[],n.skips=[],n.formatters={};var s,i=0},{25:25}],22:[function(e,t){(function(e){"use strict";function n(){a=!0;for(var e,t,n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}a=!1}var r,s=e.MutationObserver||e.WebKitMutationObserver;if(s){var i=0,o=new s(n),d=e.document.createTextNode("");o.observe(d,{characterData:!0}),r=function(){d.data=i=++i%2}}else if(!e.setImmediate&&"undefined"!==typeof e.MessageChannel){var l=new e.MessageChannel;l.port1.onmessage=n,r=function(){l.port2.postMessage(0)}}else r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};var a,u=[];t.exports=function(e){1!==u.push(e)||a||r()}}).call(this,"undefined"===typeof global?"undefined"===typeof self?"undefined"===typeof window?{}:window:self:global)},{}],23:[function(e,t){t.exports="function"===typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],24:[function(e,t){var n=Array.isArray,r=Object.prototype.toString;t.exports=n||function(e){return!!e&&"[object Array]"==r.call(e)}},{}],25:[function(e,n){function i(e){if(e=""+e,!(1e4<e.length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();return"years"===n||"year"===n||"yrs"===n||"yr"===n||"y"===n?r*d:"days"===n||"day"===n||"d"===n?r*p:"hours"===n||"hour"===n||"hrs"===n||"hr"===n||"h"===n?r*c:"minutes"===n||"minute"===n||"mins"===n||"min"===n||"m"===n?r*s:"seconds"===n||"second"===n||"secs"===n||"sec"===n||"s"===n?r*u:"milliseconds"===n||"millisecond"===n||"msecs"===n||"msec"===n||"ms"===n?r:void 0}}}function o(e){var t=Math.round;return e>=p?t(e/p)+"d":e>=c?t(e/c)+"h":e>=s?t(e/s)+"m":e>=u?t(e/u)+"s":e+"ms"}function l(e){return a(e,p,"day")||a(e,c,"hour")||a(e,s,"minute")||a(e,u,"second")||e+" ms"}function a(e,s,n){return e<s?void 0:e<1.5*s?r(e/s)+" "+n:t(e/s)+" "+n+"s"}var u=1e3,s=60*u,c=60*s,p=24*c,d=365.25*p;n.exports=function(e,t){return t=t||{},"string"==typeof e?i(e):t.long?l(e):o(e)}},{}],26:[function(e,t,r){"use strict";function i(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return a(e);case"string":return e.replace(/\u0002/g,"\x02\x02").replace(/\u0001/g,"\x01\x02").replace(/\u0000/g,"\x01\x01");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),s=-1,i=n.length,o="";if(t)for(;++s<i;)o+=r.toIndexableString(n[s]);else for(;++s<i;){var d=n[s];o+=r.toIndexableString(d)+r.toIndexableString(e[d])}return o;}return""}function o(e,t){var n,r=t,s="1"===e[t];if(s)n=0,t++;else{var i="0"===e[t];t++;var o="",d=e.substring(t,t+y),l=parseInt(d,10)+g;for(i&&(l=-l),t+=y;;){var a=e[t];if("\0"===a)break;else o+=a;t++}o=o.split("."),n=1===o.length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),i&&(n-=10),0!==l&&(n=parseFloat(n+"e"+l))}return{num:n,length:t-r}}function d(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var s=r.element,i=r.index;if(Array.isArray(s))s.push(n);else if(i===e.length-2){var o=e.pop();s[o]=n}else e.push(n)}}function l(e,t){for(var s,o=n(e.length,t.length),d=0;d<o;d++)if(s=r.collate(e[d],t[d]),0!==s)return s;return e.length===t.length?0:e.length>t.length?1:-1}function u(e,t){return e===t?0:e>t?1:-1}function c(e,t){for(var s,o=Object.keys(e),d=Object.keys(t),l=n(o.length,d.length),a=0;a<l;a++){if(s=r.collate(o[a],d[a]),0!==s)return s;if(s=r.collate(e[o[a]],t[d[a]]),0!==s)return s}return o.length===d.length?0:o.length>d.length?1:-1}function p(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:3>t?t+2:t+3:Array.isArray(e)?5:void 0}function a(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=0>e,i=r?"0":"2",o=(r?-n:n)-g,d=f.padLeft(o.toString(),"0",y);i+=h+d;var l=s(parseFloat(t[0]));r&&(l=10-l);var a=l.toFixed(20);return a=a.replace(/\.?0+$/,""),i+=h+a,i}var g=-324,y=3,h="",f=e(27);r.collate=function(e,t){if(e===t)return 0;e=r.normalizeKey(e),t=r.normalizeKey(t);var n=p(e),s=p(t);if(0!==n-s)return n-s;if(null===e)return 0;switch(typeof e){case"number":return e-t;case"boolean":return e===t?0:e<t?-1:1;case"string":return u(e,t);}return Array.isArray(e)?l(e,t):c(e,t)},r.normalizeKey=function(e){switch(typeof e){case"undefined":return null;case"number":return e===Infinity||e===-Infinity||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=Array(n);for(var s=0;s<n;s++)e[s]=r.normalizeKey(t[s])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},t)if(t.hasOwnProperty(i)){var o=t[i];"undefined"!==typeof o&&(e[i]=r.normalizeKey(o))}}}return e},r.toIndexableString=function(e){return e=r.normalizeKey(e),p(e)+h+i(e)+"\0"},r.parseIndexableString=function(e){for(var t=[],n=[],r=0;;){var s=e[r++];if("\0"===s){if(1===t.length)return t.pop();d(t,n);continue}switch(s){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var i=o(e,r);t.push(i.num),r+=i.length;break;case"4":for(var l="";;){var a=e[r];if("\0"===a)break;l+=a,r++}l=l.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"\x01").replace(/\u0002\u0002/g,"\x02"),t.push(l);break;case"5":var u={element:[],index:t.length};t.push(u.element),n.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+s);}}}},{27:27}],27:[function(e,n,s){"use strict";function i(e,t,n){for(var r="",s=n-e.length;r.length<s;)r+=t;return r}s.padLeft=function(e,t,n){var r=i(e,t,n);return r+e},s.padRight=function(e,t,n){var r=i(e,t,n);return e+r},s.stringLexCompare=function(e,t){var n,r=e.length,s=t.length;for(n=0;n<r;n++){if(n===s)return 1;var i=e.charAt(n),o=t.charAt(n);if(i!==o)return i<o?-1:1}return r<s?-1:0},s.intToDecimalForm=function(e){var n=0>e,s="";do{var i=n?-t(e%10):r(e%10);s=i+s,e=n?t(e/10):r(e/10)}while(e);return n&&"0"!==s&&(s="-"+s),s}},{}],28:[function(e,t){"use strict";function n(e){return null===e?e+"":"object"===typeof e||"function"===typeof e?a[i.call(e)]||"object":typeof e}function r(e){return null!==e&&e===e.window}function s(e){if(!e||"object"!==n(e)||e.nodeType||r(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}for(var t in e);return t===void 0||p.call(e,t)}function o(e){return"function"===n(e)}function d(e,t,n){var r,d,l,a,u,c,p,y=t[0]||{},h=1,i=t.length,f=!1,m=/\d+/;for("boolean"===typeof y&&(f=y,y=t[1]||{},h=2),"object"===typeof y||o(y)||(y={}),i===h&&(y=this,--h);h<i;h++)if(null!=(r=t[h]))for(d in p=g(r),r)if(!(d in Object.prototype)){if(p&&!m.test(d))continue;if(l=y[d],a=r[d],y===a)continue;f&&a&&(s(a)||(u=g(a)))?(u?(u=!1,c=l&&g(l)?l:[]):c=l&&s(l)?l:{},e.push({args:[f,c,a],result:{container:y,key:d}})):void 0!==a&&!(g(r)&&o(a))&&(y[d]=a)}n.container[n.key]=y}for(var l,a={},u=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],c=0;c<u.length;c++)l=u[c],a["[object "+l+"]"]=l.toLowerCase();var i=a.toString,p=a.hasOwnProperty,g=Array.isArray||function(e){return"array"===n(e)};t.exports=function(){for(var e=[],t=-1,n=arguments.length,r=Array(n);++t<n;)r[t]=arguments[t];var s={};e.push({args:r,result:{container:s,key:"key"}});for(var i;i=e.pop();)d(e,i.args,i.result);return s.key}},{}],29:[function(e,t){"use strict";var n=function(e){return e&&"object"===typeof e&&"default"in e?e["default"]:e}(e(30)),r="function"===typeof Promise?Promise:n;t.exports=r},{30:30}],30:[function(e,t){"use strict";function n(){}function r(e){if("function"!==typeof e)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,e!==n&&d(this,e)}function s(e,t,n){this.promise=e,"function"===typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"===typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function i(t,e,n){a(function(){var r;try{r=e(n)}catch(n){return u.reject(t,n)}r===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,r)})}function o(e){var t=e&&e.then;if(e&&"object"===typeof e&&"function"===typeof t)return function(){t.apply(e,arguments)}}function d(e,t){function n(t){s||(s=!0,u.reject(e,t))}function r(t){s||(s=!0,u.resolve(e,t))}var s=!1,i=l(function(){t(r,n)});"error"===i.status&&n(i.value)}function l(e,t){var n={};try{n.value=e(t),n.status="success"}catch(t){n.status="error",n.value=t}return n}var a=e(22),u={},c=["REJECTED"],p=["FULFILLED"],g=["PENDING"];t.exports=r,r.prototype["catch"]=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!==typeof e&&this.state===p||"function"!==typeof t&&this.state===c)return this;var r=new this.constructor(n);if(this.state!==g){var o=this.state===p?e:t;i(r,o,this.outcome)}else this.queue.push(new s(r,e,t));return r},s.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},s.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},s.prototype.callRejected=function(e){u.reject(this.promise,e)},s.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)},u.resolve=function(e,t){var n=l(o,t);if("error"===n.status)return u.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=p,e.outcome=t;for(var s=-1,i=e.queue.length;++s<i;)e.queue[s].callFulfilled(t)}return e},u.reject=function(e,t){e.state=c,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},r.resolve=function(e){return e instanceof this?e:u.resolve(new this(n),e)},r.reject=function(e){var t=new this(n);return u.reject(t,e)},r.all=function(e){function t(e,t){r.resolve(e).then(function(e){d[t]=e,++l!==s||o||(o=!0,u.resolve(c,d))},function(e){o||(o=!0,u.reject(c,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,o=!1;if(!s)return this.resolve([]);for(var d=Array(s),l=0,a=-1,c=new this(n);++a<s;)t(e[a],a);return c},r.race=function(e){function t(e){r.resolve(e).then(function(e){o||(o=!0,u.resolve(i,e))},function(e){o||(o=!0,u.reject(i,e))})}var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,o=!1;if(!s)return this.resolve([]);for(var d=-1,i=new this(n);++d<s;)t(e[d]);return i}},{22:22}],31:[function(e,t,n){"use strict";function r(e,t,n){return"string"===typeof t?e.get(t)["catch"](function(e){if(404!==e.status)throw e;return{}}).then(function(r){var i=r._rev,o=n(r);return o?(o._id=t,o._rev=i,s(e,o,n)):{updated:!1,rev:i}}):i.reject(new Error("doc id is required"))}function s(e,t,n){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(s){if(409!==s.status)throw s;return r(e,t._id,n)})}var i=e(33);n.upsert=function(e,t,n){var s=this,i=r(s,e,t);return"function"===typeof n?void i.then(function(e){n(null,e)},n):i},n.putIfNotExists=function(e,t,n){var s=this;"string"!==typeof e&&(n=t,t=e,e=t._id);var i=r(s,e,function(e){return!e._rev&&t});return"function"===typeof n?void i.then(function(e){n(null,e)},n):i},"undefined"!==typeof window&&window.PouchDB&&window.PouchDB.plugin(n)},{33:33}],32:[function(e,t,n){arguments[4][30][0].apply(n,arguments)},{22:22,30:30}],33:[function(e,t,n){arguments[4][29][0].apply(n,arguments)},{29:29,32:32}],34:[function(e,t){function n(){a&&o&&(a=!1,o.length?l=o.concat(l):u=-1,l.length&&r())}function r(){if(!a){var e=setTimeout(n);a=!0;for(var t=l.length;t;){for(o=l,l=[];++u<t;)o&&o[u].run();u=-1,t=l.length}o=null,a=!1,clearTimeout(e)}}function s(e,t){this.fun=e,this.array=t}function i(){}var o,d=t.exports={},l=[],a=!1,u=-1;d.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new s(e,t)),1!==l.length||a||setTimeout(r,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=i,d.addListener=i,d.once=i,d.off=i,d.removeListener=i,d.removeAllListeners=i,d.emit=i,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],35:[function(t,n,r){(function(t){if("object"===typeof r)n.exports=t();else if("function"===typeof e&&e.amd)e(t);else{var s;try{s=window}catch(t){s=self}s.SparkMD5=t()}})(function(){"use strict";var e=function(e,t){return 4294967295&e+t},n=function(n,r,i,o,d,s){return r=e(e(r,n),e(o,s)),e(r<<d|r>>>32-d,i)},t=function(e,r,i,o,d,l,s){return n(r&i|~r&o,e,r,d,l,s)},r=function(e,r,i,o,l,a,s){return n(r&o|i&~o,e,r,l,a,s)},s=function(e,r,i,o,d,l,s){return n(r^i^o,e,r,d,l,s)},i=function(e,r,i,o,l,a,s){return n(i^(r|~o),e,r,l,a,s)},o=function(n,o){var l=n[0],a=n[1],u=n[2],c=n[3];l=t(l,a,u,c,o[0],7,-680876936),c=t(c,l,a,u,o[1],12,-389564586),u=t(u,c,l,a,o[2],17,606105819),a=t(a,u,c,l,o[3],22,-1044525330),l=t(l,a,u,c,o[4],7,-176418897),c=t(c,l,a,u,o[5],12,1200080426),u=t(u,c,l,a,o[6],17,-1473231341),a=t(a,u,c,l,o[7],22,-45705983),l=t(l,a,u,c,o[8],7,1770035416),c=t(c,l,a,u,o[9],12,-1958414417),u=t(u,c,l,a,o[10],17,-42063),a=t(a,u,c,l,o[11],22,-1990404162),l=t(l,a,u,c,o[12],7,1804603682),c=t(c,l,a,u,o[13],12,-40341101),u=t(u,c,l,a,o[14],17,-1502002290),a=t(a,u,c,l,o[15],22,1236535329),l=r(l,a,u,c,o[1],5,-165796510),c=r(c,l,a,u,o[6],9,-1069501632),u=r(u,c,l,a,o[11],14,643717713),a=r(a,u,c,l,o[0],20,-373897302),l=r(l,a,u,c,o[5],5,-701558691),c=r(c,l,a,u,o[10],9,38016083),u=r(u,c,l,a,o[15],14,-660478335),a=r(a,u,c,l,o[4],20,-405537848),l=r(l,a,u,c,o[9],5,568446438),c=r(c,l,a,u,o[14],9,-1019803690),u=r(u,c,l,a,o[3],14,-187363961),a=r(a,u,c,l,o[8],20,1163531501),l=r(l,a,u,c,o[13],5,-1444681467),c=r(c,l,a,u,o[2],9,-51403784),u=r(u,c,l,a,o[7],14,1735328473),a=r(a,u,c,l,o[12],20,-1926607734),l=s(l,a,u,c,o[5],4,-378558),c=s(c,l,a,u,o[8],11,-2022574463),u=s(u,c,l,a,o[11],16,1839030562),a=s(a,u,c,l,o[14],23,-35309556),l=s(l,a,u,c,o[1],4,-1530992060),c=s(c,l,a,u,o[4],11,1272893353),u=s(u,c,l,a,o[7],16,-155497632),a=s(a,u,c,l,o[10],23,-1094730640),l=s(l,a,u,c,o[13],4,681279174),c=s(c,l,a,u,o[0],11,-358537222),u=s(u,c,l,a,o[3],16,-722521979),a=s(a,u,c,l,o[6],23,76029189),l=s(l,a,u,c,o[9],4,-640364487),c=s(c,l,a,u,o[12],11,-421815835),u=s(u,c,l,a,o[15],16,530742520),a=s(a,u,c,l,o[2],23,-995338651),l=i(l,a,u,c,o[0],6,-198630844),c=i(c,l,a,u,o[7],10,1126891415),u=i(u,c,l,a,o[14],15,-1416354905),a=i(a,u,c,l,o[5],21,-57434055),l=i(l,a,u,c,o[12],6,1700485571),c=i(c,l,a,u,o[3],10,-1894986606),u=i(u,c,l,a,o[10],15,-1051523),a=i(a,u,c,l,o[1],21,-2054922799),l=i(l,a,u,c,o[8],6,1873313359),c=i(c,l,a,u,o[15],10,-30611744),u=i(u,c,l,a,o[6],15,-1560198380),a=i(a,u,c,l,o[13],21,1309151649),l=i(l,a,u,c,o[4],6,-145523070),c=i(c,l,a,u,o[11],10,-1120210379),u=i(u,c,l,a,o[2],15,718787259),a=i(a,u,c,l,o[9],21,-343485551),n[0]=e(l,n[0]),n[1]=e(a,n[1]),n[2]=e(u,n[2]),n[3]=e(c,n[3])},d=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n},l=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},a=function(e){var t,r,s,i,l,a,u=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)o(n,d(e.substring(t-64,t)));for(e=e.substring(t-64),r=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),55<t)for(o(n,s),t=0;16>t;t+=1)s[t]=0;return i=8*u,i=i.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(i[2],16),a=parseInt(i[1],16)||0,s[14]=l,s[15]=a,o(n,s),n},u=function(e){var t,r,s,i,d,a,u=e.length,n=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)o(n,l(e.subarray(t-64,t)));for(e=t-64<u?e.subarray(t-64):new Uint8Array(0),r=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)s[t>>2]|=e[t]<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),55<t)for(o(n,s),t=0;16>t;t+=1)s[t]=0;return i=8*u,i=i.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(i[2],16),a=parseInt(i[1],16)||0,s[14]=d,s[15]=a,o(n,s),n},c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],p=function(e){var t,n="";for(t=0;4>t;t+=1)n+=c[15&e>>8*t+4]+c[15&e>>8*t];return n},g=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")},y=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==function(e){return g(a(e))}("hello")&&(e=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}),y.prototype.append=function(e){return /[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},y.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)o(this._state,d(this._buff.substring(t-64,t)));return this._buff=this._buff.substr(t-64),this},y.prototype.end=function(e){var t,n,r=this._buff,s=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<s;t+=1)i[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(i,s),n=e?this._state:g(this._state),this.reset(),n},y.prototype._finish=function(e,t){var n,r,s,d=t;if(e[d>>2]|=128<<(d%4<<3),55<d)for(o(this._state,e),d=0;16>d;d+=1)e[d]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(n[2],16),s=parseInt(n[1],16)||0,e[14]=r,e[15]=s,o(this._state,e)},y.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},y.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=a(e);return t?n:g(n)},y.hashBinary=function(e,t){var n=a(e);return t?n:g(n)},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(e){var t,n=this._concatArrayBuffer(this._buff,e),r=n.length;for(this._length+=e.byteLength,t=64;t<=r;t+=64)o(this._state,l(n.subarray(t-64,t)));return this._buff=t-64<r?n.subarray(t-64):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,s=r.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<s;t+=1)i[t>>2]|=r[t]<<(t%4<<3);return this._finish(i,s),n=e?this._state:g(this._state),this.reset(),n},y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var n=e.length,r=new Uint8Array(n+t.byteLength);return r.set(e),r.set(new Uint8Array(t),n),r},y.ArrayBuffer.hash=function(e,t){var n=u(new Uint8Array(e));return t?n:g(n)},y})},{}],36:[function(e,t){"use strict";var n=e(17),r=e(6),s=e(14),i={};i.createIndex=n.toPromise(function(e,t){if("object"!==typeof e)return t(new Error("you must provide an index to create"));var n="http"===this.type()?r:s;n.createIndex(this,e,t)}),i.find=n.toPromise(function(e,t){if("undefined"===typeof t&&(t=e,e=void 0),"object"!==typeof e)return t(new Error("you must provide search parameters to find()"));var n="http"===this.type()?r:s;n.find(this,e,t)}),i.getIndexes=n.toPromise(function(e){var t="http"===this.type()?r:s;t.getIndexes(this,e)}),i.deleteIndex=n.toPromise(function(e,t){if("object"!==typeof e)return t(new Error("you must provide an index to delete"));var n="http"===this.type()?r:s;n.deleteIndex(this,e,t)}),t.exports=i,"undefined"!==typeof window&&window.PouchDB&&window.PouchDB.plugin(i)},{6:6,14:14,17:17}]},{},[36])(36)});</script><script>(function(){'use strict';Polymer({is:'app-pouchdb-query',behaviors:[Polymer.AppPouchDBDatabaseBehavior],properties:{selector:{type:String},fields:{type:Array,value:function(){return[]}},sort:{type:Array,value:function(){return[]}},limit:{type:Number,value:0},skip:{type:Number,value:0},parsedSelector:{type:Object,computed:'__computeParsedSelector(selector)'},query:{type:Object,computed:'__computeQuery(db, parsedSelector, fields.*, sort.*, limit, skip)'},data:{type:Array,readOnly:!0,notify:!0,value:function(){return[]}}},observers:['refresh(db, query)'],refresh:function(){if(!this.query)throw new Error('Query not configured!');this.debounce('find',function(){this.db.find(this.query).then(function(a){this._setData(a.docs||[])}.bind(this)).catch(function(a){console.error(a)}.bind(this))},1)},__computeQuery:function(){var a={};return a.selector=this.parsedSelector,a.fields=this.fields,a.sort=this.sort,this.limit&&(a.limit=this.limit),this.skip&&(a.skip=this.skip),a},__computeParsedSelector:function(a){for(var b=a.split(/\s*[,]\s*/),c={},d=0;d<b.length;++d)b[d]&&this.__parseDimension(c,b[d]);return c},__parseDimension:function(a,b){for(var c={},d=b.split(/\s+/),e=d.shift();1<d.length;)try{this.__parseConstraint(c,d.splice(0,2))}catch(a){}a[e]=c},__parseConstraint:function(a,b){var c,d=b[0],e=b[1];/^['"].*['"]$/.test(e)?e=e.slice(1,e.length-1):(c=window.parseFloat(e,10),e=window.isNaN(c)?'true'===e:c),null!=d&&null!=e&&(a[d]=e)}})})();</script><script>(function(){'use strict';Polymer({is:'app-pouchdb-index',behaviors:[Polymer.AppPouchDBDatabaseBehavior],properties:{fields:{type:Array},name:{type:String,value:null},ddoc:{type:String,value:null},index:{type:Object,computed:'__computeIndex(fields.*, name, ddoc)'}},observers:['__createIndex(db, index)'],__createIndex:function(){if(null==this.index)throw new Error('Index not configured!');this.db.createIndex({index:this.index}).catch(function(a){this._error(a)}.bind(this))},__computeIndex:function(){var a;return this.fields&&this.fields.length?(a={},a.fields=this.fields,null!=this.name&&(a.name=this.name),null!=this.ddoc&&(a.ddoc=this.ddoc),a):null}})})();</script><dom-module id="paper-badge" assetpath="../paper-badge/"><template><style>:host{display:block;position:absolute;outline:none;}:host([hidden]), [hidden]{display:none !important;}iron-icon{--iron-icon-width:12px;--iron-icon-height:12px;}.badge{@apply --layout;@apply --layout-center-center;@apply --paper-font-common-base;font-weight:normal;font-size:11px;border-radius:50%;margin-left:var(--paper-badge-margin-left, 0px);margin-bottom:var(--paper-badge-margin-bottom, 0px);width:var(--paper-badge-width, 20px);height:var(--paper-badge-height, 20px);background-color:var(--paper-badge-background, var(--accent-color));opacity:var(--paper-badge-opacity, 1.0);color:var(--paper-badge-text-color, white);@apply --paper-badge;}</style><div class="badge"><iron-icon hidden$="{{!_computeIsIconBadge(icon)}}" icon="{{icon}}"></iron-icon><span id="badge-text" hidden$="{{_computeIsIconBadge(icon)}}">{{label}}</span></div></template><script>Polymer({is:'paper-badge',hostAttributes:{role:'status',tabindex:0},behaviors:[Polymer.IronResizableBehavior],listeners:{"iron-resize":'updatePosition'},properties:{for:{type:String,observer:'_forChanged'},label:{type:String,observer:'_labelChanged'},icon:{type:String,value:''},_boundNotifyResize:{type:Function,value:function(){return this.notifyResize.bind(this)}},_boundUpdateTarget:{type:Function,value:function(){return this._updateTarget.bind(this)}}},attached:function(){requestAnimationFrame(this._boundUpdateTarget)},attributeChanged:function(a){'hidden'===a&&this.updatePosition()},_forChanged:function(){this.isAttached&&this._updateTarget()},_labelChanged:function(){this.setAttribute('aria-label',this.label)},_updateTarget:function(){this._target=this.target,requestAnimationFrame(this._boundNotifyResize)},_computeIsIconBadge:function(a){return 0<a.length},get target(){var a,b=Polymer.dom(this).parentNode,c=Polymer.dom(this).getOwnerRoot();return a=this.for?Polymer.dom(c).querySelector('#'+this.for):b.nodeType==Node.DOCUMENT_FRAGMENT_NODE?c.host:b,a},updatePosition:function(){if(this._target&&this.offsetParent){var a=this.offsetParent.getBoundingClientRect(),b=this._target.getBoundingClientRect(),c=this.getBoundingClientRect();this.style.left=b.left-a.left+(b.width-c.width/2)+'px',this.style.top=b.top-a.top-c.height/2+'px'}}});</script></dom-module><dom-module id="iron-autogrow-textarea" assetpath="../iron-autogrow-textarea/"><template><style>:host{display:inline-block;position:relative;width:400px;border:1px solid;padding:2px;-moz-appearance:textarea;-webkit-appearance:textarea;overflow:hidden;}.mirror-text{visibility:hidden;word-wrap:break-word;@apply --iron-autogrow-textarea;}.fit{@apply --layout-fit;}textarea{position:relative;outline:none;border:none;resize:none;background:inherit;color:inherit;width:100%;height:100%;font-size:inherit;font-family:inherit;line-height:inherit;text-align:inherit;@apply --iron-autogrow-textarea;}textarea::-webkit-input-placeholder{@apply --iron-autogrow-textarea-placeholder;}textarea:-moz-placeholder{@apply --iron-autogrow-textarea-placeholder;}textarea::-moz-placeholder{@apply --iron-autogrow-textarea-placeholder;}textarea:-ms-input-placeholder{@apply --iron-autogrow-textarea-placeholder;}</style><div id="mirror" class="mirror-text" aria-hidden="true">&nbsp;</div><div class="textarea-container fit"><textarea id="textarea" name$="[[name]]" aria-label$="[[label]]" autocomplete$="[[autocomplete]]" autofocus$="[[autofocus]]" inputmode$="[[inputmode]]" placeholder$="[[placeholder]]" readonly$="[[readonly]]" required$="[[required]]" disabled$="[[disabled]]" rows$="[[rows]]" minlength$="[[minlength]]" maxlength$="[[maxlength]]"></textarea></div></template></dom-module><script>Polymer({is:'iron-autogrow-textarea',behaviors:[Polymer.IronValidatableBehavior,Polymer.IronControlState],properties:{value:{observer:'_valueChanged',type:String,notify:!0},bindValue:{observer:'_bindValueChanged',type:String,notify:!0},rows:{type:Number,value:1,observer:'_updateCached'},maxRows:{type:Number,value:0,observer:'_updateCached'},autocomplete:{type:String,value:'off'},autofocus:{type:Boolean,value:!1},inputmode:{type:String},placeholder:{type:String},readonly:{type:String},required:{type:Boolean},minlength:{type:Number},maxlength:{type:Number},label:{type:String}},listeners:{input:'_onInput'},get textarea(){return this.$.textarea},get selectionStart(){return this.$.textarea.selectionStart},get selectionEnd(){return this.$.textarea.selectionEnd},set selectionStart(a){this.$.textarea.selectionStart=a},set selectionEnd(a){this.$.textarea.selectionEnd=a},attached:function(){var a=navigator.userAgent.match(/iP(?:[oa]d|hone)/);a&&(this.$.textarea.style.marginLeft='-3px')},validate:function(){var a=this.$.textarea.validity.valid;return a&&(this.required&&''===this.value?a=!1:this.hasValidator()&&(a=Polymer.IronValidatableBehavior.validate.call(this,this.value))),this.invalid=!a,this.fire('iron-input-validate'),a},_bindValueChanged:function(a){this.value=a},_valueChanged:function(a){var b=this.textarea;b&&(b.value!==a&&(b.value=a||0===a?a:''),this.bindValue=a,this.$.mirror.innerHTML=this._valueForMirror(),this.fire('bind-value-changed',{value:this.bindValue}))},_onInput:function(a){var b=Polymer.dom(a).path;this.value=b?b[0].value:a.target.value},_constrain:function(a){var b;for(a=a||[''],b=0<this.maxRows&&a.length>this.maxRows?a.slice(0,this.maxRows):a.slice(0);0<this.rows&&b.length<this.rows;)b.push('');return b.join('<br/>')+'&#160;'},_valueForMirror:function(){var a=this.textarea;if(a)return this.tokens=a&&a.value?a.value.replace(/&/gm,'&amp;').replace(/"/gm,'&quot;').replace(/'/gm,'&#39;').replace(/</gm,'&lt;').replace(/>/gm,'&gt;').split('\n'):[''],this._constrain(this.tokens)},_updateCached:function(){this.$.mirror.innerHTML=this._constrain(this.tokens)}});</script><dom-module id="paper-textarea" assetpath="../paper-input/"><template><style>:host{display:block;}:host([hidden]){display:none !important;}label{pointer-events:none;}</style><paper-input-container no-label-float$="[[noLabelFloat]]" always-float-label="[[_computeAlwaysFloatLabel(alwaysFloatLabel,placeholder)]]" auto-validate$="[[autoValidate]]" disabled$="[[disabled]]" invalid="[[invalid]]"><label hidden$="[[!label]]" aria-hidden="true" for$="[[_inputId]]" slot="label">[[label]]</label><iron-autogrow-textarea class="paper-input-input" slot="input" id$="[[_inputId]]" aria-labelledby$="[[_ariaLabelledBy]]" aria-describedby$="[[_ariaDescribedBy]]" bind-value="{{value}}" invalid="{{invalid}}" validator$="[[validator]]" disabled$="[[disabled]]" autocomplete$="[[autocomplete]]" autofocus$="[[autofocus]]" inputmode$="[[inputmode]]" name$="[[name]]" placeholder$="[[placeholder]]" readonly$="[[readonly]]" required$="[[required]]" minlength$="[[minlength]]" maxlength$="[[maxlength]]" autocapitalize$="[[autocapitalize]]" rows$="[[rows]]" max-rows$="[[maxRows]]" on-change="_onChange"></iron-autogrow-textarea><template is="dom-if" if="[[errorMessage]]"><paper-input-error aria-live="assertive" slot="add-on">[[errorMessage]]</paper-input-error></template><template is="dom-if" if="[[charCounter]]"><paper-input-char-counter slot="add-on"></paper-input-char-counter></template></paper-input-container></template></dom-module><script>Polymer({is:'paper-textarea',behaviors:[Polymer.PaperInputBehavior,Polymer.IronFormElementBehavior],properties:{_ariaLabelledBy:{observer:'_ariaLabelledByChanged',type:String},_ariaDescribedBy:{observer:'_ariaDescribedByChanged',type:String},rows:{type:Number,value:1},maxRows:{type:Number,value:0}},get selectionStart(){return this.$.input.textarea.selectionStart},set selectionStart(a){this.$.input.textarea.selectionStart=a},get selectionEnd(){return this.$.input.textarea.selectionEnd},set selectionEnd(a){this.$.input.textarea.selectionEnd=a},_ariaLabelledByChanged:function(a){this._focusableElement.setAttribute('aria-labelledby',a)},_ariaDescribedByChanged:function(a){this._focusableElement.setAttribute('aria-describedby',a)},get _focusableElement(){return this.inputElement.textarea}});</script><dom-module id="quantum-local-collection-writer"><template><style>:host{margin-top:5vh;width:90vw;background:white;transition:box-shadow 0.5s cubic-bezier(.25, .8, .25, 1);box-shadow:0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);overflow:auto;border-radius:2px;padding:15px;--app-primary-color:var(--google-blue-500);--app-secondary-color:black;--app-background-color:white;--app-on-background-color:white;}[hidden]{display:none !important;}#closeSaveCollection{position:absolute;justify-content:flex-end;right:16px;top:16px;margin:0;transition:color 0.5s cubic-bezier(.25, .8, .25, 1);color:var(--google-grey-300);}.header{@apply --layout-horizontal;@apply --layout-center;margin-top:30px;}.itemList{@apply --layout-horizontal;@apply --layout-center;@apply --layout-wrap;}.item{position:relative;@apply --layout-horizontal;@apply --layout-center;margin-right:35px;}.item.tag{margin-top:10px;background-color:var(--google-blue-100);padding:5px 15px;border-radius:2px;}iron-icon.submit{color:var(--google-green-500);}iron-icon.close,
      iron-icon.delete{color:var(--google-red-500);}paper-badge.delete{margin-left:15px;margin-top:-5px;}.script_container{padding:15px;font-family:'Roboto Mono', sans-serif;font-size:0.75em;-moz-box-shadow:inset 0 0 5px #AAA;-webkit-box-shadow:inset 0 0 5px #AAA;box-shadow:inset 0 0 5px #AAA;max-height:200px;overflow:auto;}.action_bar{margin-top:15px;@apply --layout-horizontal;@apply --layout-center-justified;@apply --layout-center;}.action_bar paper-button{background-color:var(--app-primary-color);color:var(--app-on-background-color);}</style><app-pouchdb-conflict-resolution strategy="firstWriteWins"></app-pouchdb-conflict-resolution><app-pouchdb-document id="document" db-name="warpscript-collection" doc-id="[[_docId]]" data="[[_document]]" upsert=""></app-pouchdb-document><paper-button id="closeSaveCollection" on-tap="cancel"><iron-icon icon="close"></iron-icon></paper-button><h2>{{localize('title')}}</h2><div class="header">{{localize('promptName')}}</div><div class="item"><paper-input id="name" name="name" label="{{localize('name')}}" type="text" value="{{name}}" maxlength="64" required=""></paper-input></div><div class="header">{{localize('promptTags')}}</div><div class="item"><paper-input name="newTag" id="newTag" label="{{localize('promptTag')}}" type="text" value="{{_newTag}}" maxlength="64" auto-validate="" on-input="_onNewTagInput" on-keypress="_onNewTagAction"></paper-input></div><div class="itemList"><template is="dom-repeat" items="[[tags]]" as="tag"><div class="item tag"><span id$="tag-{{tag}}" class="tagname">{{tag}}</span><paper-badge icon="close" class="delete" for$="tag-{{tag}}" label="localize('deleteTag')" on-click="_deleteTag"></paper-badge></div></template></div><div class="header"><h4>{{localize('scriptToSave')}}</h4></div><div class="script_container">{{warpscript}}</div><div class="action_bar"><paper-button on-click="_save"><iron-icon icon="done"></iron-icon></paper-button></div></template><script>class QuantumLocalCollectionWriter extends Polymer.mixinBehaviors([Polymer.PaperDialogBehavior,Polymer.AppLocalizeBehavior],Polymer.Element){static get is(){return'quantum-local-collection-writer'}static get properties(){return{collection:{type:Array,notify:!0},warpscript:{type:String},tags:{type:Array,value:function(){return[]}},name:{type:String},language:{value:'en'},resources:{type:Object,value:function(){return{en:{title:'Save current script into local storage',promptName:'Give a name to the script',name:'Name',promptTags:'Add some tags to qualify the script, separated by `,` or `enter`',promptTag:'Add a tag',deleteTag:'Remove tag',scriptToSave:'The current WarpScript script',save:'Save'}}}},debug:{type:Boolean,value:!1}}}_onNewTagInput(){this.debug&&console.log('[quantum-local-collection-writer] _onNewTagInput',this._newTag);let a=this._newTag.split(',');if(1<a.length){for(let b=0;b<a.length-1;b++)this.push('tags',a[b]);this._newTag=a[a.length-1]}}_onNewTagAction(a){this.debug&&console.log('[quantum-local-collection-writer] _onNewTagAction',a.key),'Enter'===a.key&&this._addNewTag()}_addNewTag(){0>this.tags.indexOf(this._newTag)&&this.push('tags',this._newTag),this._emptyNewTag()}_emptyNewTag(){this._newTag=''}_deleteTag(a){this.debug&&console.log('[quantum-local-collection-writer] _deleteTag',a.model);let b=a.model;this.splice('tags',b.index,1)}_save(){let a=Date.now();this._document={timestamp:a,name:this.name,tags:this.tags,warpscript:this.warpscript},this.debug&&console.log('[quantum-local-collection-writer] _save',this.timestamp,this._document),this.$.document.save().then(function(){this.debug&&console.log('[quantum-local-collection-writer] _saved',this.timestamp,this._document),this.$.document.reset(),this.close()}.bind(this))}}customElements.define(QuantumLocalCollectionWriter.is,QuantumLocalCollectionWriter);</script></dom-module><script>window.MomentJs=window.MomentJs||{},MomentJs.MomentImportBehavior={ready:function(){'undefined'===typeof window.moment?window._downloading_moment?this._waitToLoadMomentJs():(window._downloading_moment=!0,this._loadMomentJs()):this.fire('moment-is-ready')},_loadMomentJs:function(){var a=document.createElement('script');a.src=this.resolveUrl('../moment/min/moment.min.js'),a.onload=function(){this.fire('moment-is-ready')}.bind(this),document.body.appendChild(a)},_waitToLoadMomentJs:function(){'undefined'===typeof window.moment?window.setTimeout(function(){this._waitToLoadMomentJs()}.bind(this),1):this.fire('moment-is-ready')}};</script><dom-module id="moment-js" assetpath="../moment-js/"><template><span hidden$="[[hide]]">[[output]]</span></template><script>Polymer({is:'moment-js',behaviors:[MomentJs.MomentImportBehavior],properties:{date:{type:String,observer:'_dateChanged'},dateFormat:{type:String,value:null,observer:'_updateFormattedDateMoment'},format:String,formattedDate:{type:String,readOnly:!0,notify:!0},formattedDateMoment:{type:String,readOnly:!0,notify:!0},utc:{type:Boolean,value:!1,observer:'_updateFormattedDateMoment'},hide:{type:Boolean,value:!1},isValid:{type:Boolean,value:!1},startOf:String,endOf:String,relativeTime:{type:String,readOnly:!0,notify:!0},fromNow:Boolean,calendarTime:Boolean,toNow:Boolean,output:{type:String,readOnly:!0,notify:!0},isMomentReady:{type:Boolean,value:!1,notify:!0}},listeners:{"moment-is-ready":'_momentIsReady'},_dateChanged:function(a){!0===this.isMomentReady&&(isNaN(a)?this.set('date',this.date):this.set('date',+this.date),this._updateFormattedDateMoment())},_updateFormattedDateMoment:function(){!0===this.isMomentReady&&(this.dateFormat?this.utc?this._setFormattedDateMoment(moment.utc(this.date,this.dateFormat)):this._setFormattedDateMoment(moment(this.date,this.dateFormat)):this.utc?this._setFormattedDateMoment(moment.utc(this.date)):this._setFormattedDateMoment(moment(this.date)),this._updateFormattedDate(),this._updateRelativeTime())},_updateFormattedDate:function(){this.formattedDateMoment&&(this._setFormattedDate(this.formattedDateMoment.format(this.format)),!this.relativeTime&&this._setOutput(this.formattedDate))},_updateRelativeTime:function(){this.formattedDateMoment&&(this.fromNow?this._setRelativeTime(this.formattedDateMoment.fromNow()):this.toNow?this._setRelativeTime(this.formattedDateMoment.toNow()):this.calendarTime&&this._setRelativeTime(this.formattedDateMoment.calendar()),this.relativeTime&&this._setOutput(this.relativeTime))},_updateIsValid:function(){this.dateFormat?this.set('isValid',moment(this.date,this.dateFormat).isValid()):this.set('isValid',moment(this.date).isValid())},_startOfChanged:function(){this._setFormattedDateMoment(this.formattedDateMoment.startOf(this.startOf)),this._updateFormattedDate()},_endOfChanged:function(){this._setFormattedDateMoment(this.formattedDateMoment.endOf(this.endOf)),this._updateFormattedDate()},_momentIsReady:function(){this.set('isMomentReady',!0),'undefined'===typeof this.format&&this.set('format',moment.defaultFormat),this.observers=['_updateFormattedDate(format)','_startOfChanged(startOf)','_endOfChanged(endOf)','_updateRelativeTime(fromNow)','_updateRelativeTime(toNow)','_updateRelativeTime(calendarTime)','_updateIsValid(date, dateFormat)'],this._dateChanged(this.date),this._updateFormattedDate(this.format),this._startOfChanged(this.startOf),this._endOfChanged(this.endOf),this._updateIsValid(this.date,this.dateFormat)}});</script></dom-module><dom-module id="quantum-local-collection-reader"><template><style>:host{margin-top:5vh;width:90vw;background:white;transition:box-shadow 0.5s cubic-bezier(.25, .8, .25, 1);box-shadow:0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);overflow:auto;border-radius:2px;padding:15px;--app-primary-color:var(--google-blue-500);--app-secondary-color:black;--app-background-color:white;--app-on-background-color:white;}[hidden]{display:none !important;}#closeReadCollection{position:absolute;justify-content:flex-end;right:16px;top:16px;margin:0;transition:color 0.5s cubic-bezier(.25, .8, .25, 1);color:var(--google-grey-300);}.header{@apply --layout-horizontal;@apply --layout-center;margin-top:30px;}.collection{margin-top:15px;@apply --layout-vertical;}.record{position:relative;@apply --layout-vertical;margin-bottom:15px;}.record > div{margin-left:15px;margin-bottom:10px;}.record_name{font-weight:bold;font-size:1.1em;margin-left:0 !important;cursor:pointer;}.record_date{}.record_tag_list{@apply --layout-horizontal;@apply --layout-wrap;}.record_tag{font-size:0.75em;margin-right:20px;background-color:var(--google-blue-100);padding:5px;border-radius:2px;}.record_warpscript{padding:5px;font-family:'Roboto Mono', sans-serif;font-size:0.75em;-moz-box-shadow:inset 0 0 2px #AAA;-webkit-box-shadow:inset 0 0 2px #AAA;box-shadow:inset 0 0 2px #AAA;max-height:100px;overflow:auto;}.filterCriteria{@apply --layout-horizontal;@apply --layout-wrap;}.filterCriteria paper-input{margin-left:15px;@apply --layout-flex;}.itemList{@apply --layout-horizontal;@apply --layout-center;@apply --layout-wrap;}.item{position:relative;@apply --layout-horizontal;@apply --layout-center;margin-right:35px;}.item.tag{margin-top:10px;background-color:var(--google-blue-100);padding:5px 15px;border-radius:2px;}iron-icon.submit{color:var(--google-green-500);}iron-icon.close,
      iron-icon.delete{color:var(--google-red-500);}paper-badge.delete{margin-left:15px;margin-top:-5px;}</style><app-pouchdb-index db-name="warpscript-collection" name="main" fields="[&quot;_id&quot;]"></app-pouchdb-index><app-pouchdb-query id="query" db-name="warpscript-collection" selector="_id $gt 0" fields="[&quot;_id&quot;, &quot;name&quot;, &quot;tags&quot;, &quot;timestamp&quot;, &quot;warpscript&quot;]" sort="[&quot;_id&quot;]" data="{{collection}}"></app-pouchdb-query><paper-button id="closeReadCollection" on-tap="cancel"><iron-icon icon="close"></iron-icon></paper-button><h2>{{localize('title')}}</h2><div class="header"><h4>{{localize('filter')}}</h4></div><div class="filterCriteria"><paper-checkbox id="filterByName" active="{{_filterByName}}" on-change="_onFilterByNameCheckboxChange">{{localize('filterByName')}}</paper-checkbox><template is="dom-if" if="{{_filterByName}}"><paper-input name="filterByNameInput" label="{{ localize('pattern')}}" type="text" value="{{_filterByNameInput}}" maxlength="256"></paper-input></template></div><div class="filterCriteria"><paper-checkbox id="filterByName" active="{{_filterByTags}}" on-change="_onFilterByTagsCheckboxChange">{{localize('filterByTags')}}</paper-checkbox><template is="dom-if" if="{{_filterByTags}}"><paper-input name="newTag" id="newTag" label="{{localize('promptTag')}}" type="text" value="{{_newTag}}" maxlength="64" auto-validate="" allowed-pattern="[a-z0-9]" on-input="_onNewTagInput" on-keypress="_onNewTagAction"></paper-input></template></div><div class="filterCriteria"><template is="dom-if" if="{{_filterByTags}}"><div class="itemList"><template is="dom-repeat" items="[[_tags]]" as="tag"><div class="item tag"><span id$="tag-{{tag}}" class="tagname">{{tag}}</span><paper-badge icon="close" class="delete" for$="tag-{{tag}}" label="localize('deleteTag')" on-click="_deleteTag"></paper-badge></div></template></div></template></div><div class="collection"><template is="dom-repeat" id="collectionTemplate" items="{{collection}}" as="record" filter="{{_filterRecords(_filterByNameInput,_tags,_tags.length)}}"><div class="record"><div class="record_name" on-tap="_load">{{record.name}}</div><div class="record_date">Saved on:<moment-js date="{{_fromTimestampToDate(record.timestamp)}}" format="YYYY-MM-DD HH:mm:ss" utc=""></moment-js>(UTC)</div><div class="record_tag_list"><template is="dom-repeat" items="[[record.tags]]" as="tag"><div class="record_tag">{{tag}}</div></template></div><div class="record_warpscript">{{record.shortWarpscript}}</div></div></template></div></template><script>class QuantumLocalCollectionReader extends Polymer.mixinBehaviors([Polymer.PaperDialogBehavior,Polymer.AppLocalizeBehavior],Polymer.Element){static get is(){return'quantum-local-collection-reader'}static get properties(){return{_tags:{type:Array,value:function(){return[]}},_filterByName:{type:Boolean,value:!1},_filterByTags:{type:Boolean,value:!1},_filterByDate:{type:Boolean,value:!1},collection:{type:Array,notify:!0,observer:'onCollectionChange'},_filterByNameInput:{type:String,value:''},_filterByTagsInput:{type:String,value:''},language:{value:'en'},resources:{type:Object,value:function(){return{en:{title:'Load a script from local storage',filter:'Search',filterByName:'By name',filterByTags:'By tags',filterByDate:'By date',pattern:'Pattern',promptTag:'Add tags, separated by `,` or `enter`',deleteTag:'Remove tag'}}}},debug:{type:Boolean,value:!1}}}ready(){super.ready(),this.addEventListener('iron-overlay-opened',(a)=>this.onOpen(a))}onOpen(){this.debug&&console.log('[quantum-local-collection-reader] onOpen - Openend'),this.$.query.refresh()}onCollectionChange(){this.debug&&console.log('[quantum-local-collection-reader] onCollectionChange',this.collection);let a=[];for(let b in this.collection)this.collection[b].warpscript&&a.push(this.collection[b]);a.length!==this.collection.length&&(this.collection=a,this.collection.forEach((a)=>{a.shortWarpscript=this._shortWarpscript(a.warpscript)}))}_onFilterByNameCheckboxChange(){}_onFilterByTagsCheckboxChange(){}_fromTimestampToDate(a){return a?(this.debug&&console.log('[quantum-local-collection-reader] _fromTimestampToDate',a),new Date(a).toISOString()):0}_shortWarpscript(a){if(!a)return'';let b=this._trimExcessLineFeeds(a).substring(0,256);return b.length!==a.length&&(b+='...'),this.debug&&console.log('[quantum-local-collection-reader] _shortWarpscript',b),b}_trimExcessLineFeeds(a){let b,c=0;for(b in a.length)if('\n'===a[b]&&c++,c>=3)break;return a.substring(0,b)}_load(a){this.cancel(),this.debug&&console.log('[quantum-local-collection-reader] _load',a.model.record),this.dispatchEvent(new CustomEvent('warpscript-choosen',{detail:a.model.record.warpscript}))}_filterRecords(a,b){return this.debug&&console.log('[quantum-local-collection-reader] _filterRecords - Init',a,b),a||b&&0!==b.length?(this.debug&&console.log('[quantum-local-collection-reader] _filterRecords - return a filter function for the current search string'),(c)=>{if(this.debug&&console.log('[quantum-local-collection-reader] _filterRecords - Filter called',c,a,b),a&&c.name&&0>c.name.toLowerCase().indexOf(a.toLowerCase()))return!1;if(b&&0<b.length)for(let a in b)if(0>c.tags.indexOf(b[a].trim().toLowerCase()))return!1;return!0}):(this.debug&&console.log('[quantum-local-collection-reader] _filterRecords - set filter to null to disable filtering'),null)}_onNewTagInput(){this.debug&&console.log('[quantum-local-collection-writer] _onNewTagInput',this._newTag);let a=this._newTag.split(',');if(1<a.length){for(let b=0;b<a.length-1;b++)this.push('tags',a[b]);this._newTag=a[a.length-1]}}_onNewTagAction(a){this.debug&&console.log('[quantum-local-collection-writer] _onNewTagAction',a.key),'Enter'===a.key&&this._addNewTag()}_addNewTag(){0>this._tags.indexOf(this._newTag)&&this.push('_tags',this._newTag),this._emptyNewTag()}_emptyNewTag(){this._newTag=''}_deleteTag(a){this.debug&&console.log('[quantum-local-collection-reader] _deleteTag',a.model);let b=a.model;this.splice('_tags',b.index,1)}}customElements.define(QuantumLocalCollectionReader.is,QuantumLocalCollectionReader);</script></dom-module><script>var QRCode=function(){for(var c=Math.max,d=[null,[[10,7,17,13],[1,1,1,1],[]],[[16,10,28,22],[1,1,1,1],[4,16]],[[26,15,22,18],[1,1,2,2],[4,20]],[[18,20,16,26],[2,1,4,2],[4,24]],[[24,26,22,18],[2,1,4,4],[4,28]],[[16,18,28,24],[4,2,4,4],[4,32]],[[18,20,26,18],[4,2,5,6],[4,20,36]],[[22,24,26,22],[4,2,6,6],[4,22,40]],[[22,30,24,20],[5,2,8,8],[4,24,44]],[[26,18,28,24],[5,4,8,8],[4,26,48]],[[30,20,24,28],[5,4,11,8],[4,28,52]],[[22,24,28,26],[8,4,11,10],[4,30,56]],[[22,26,22,24],[9,4,16,12],[4,32,60]],[[24,30,24,20],[9,4,16,16],[4,24,44,64]],[[24,22,24,30],[10,6,18,12],[4,24,46,68]],[[28,24,30,24],[10,6,16,17],[4,24,48,72]],[[28,28,28,28],[11,6,19,16],[4,28,52,76]],[[26,30,28,28],[13,6,21,18],[4,28,54,80]],[[26,28,26,26],[14,7,25,21],[4,28,56,84]],[[26,28,28,30],[16,8,25,20],[4,32,60,88]],[[26,28,30,28],[17,8,25,23],[4,26,48,70,92]],[[28,28,24,30],[17,9,34,23],[4,24,48,72,96]],[[28,30,30,30],[18,9,30,25],[4,28,52,76,100]],[[28,30,30,30],[20,10,32,27],[4,26,52,78,104]],[[28,26,30,30],[21,12,35,29],[4,30,56,82,108]],[[28,28,30,28],[23,12,37,34],[4,28,56,84,112]],[[28,30,30,30],[25,12,40,34],[4,32,60,88,116]],[[28,30,30,30],[26,13,42,35],[4,24,48,72,96,120]],[[28,30,30,30],[28,14,45,38],[4,28,52,76,100,124]],[[28,30,30,30],[29,15,48,40],[4,24,50,76,102,128]],[[28,30,30,30],[31,16,51,43],[4,28,54,80,106,132]],[[28,30,30,30],[33,17,54,45],[4,32,58,84,110,136]],[[28,30,30,30],[35,18,57,48],[4,28,56,84,112,140]],[[28,30,30,30],[37,19,60,51],[4,32,60,88,116,144]],[[28,30,30,30],[38,19,63,53],[4,28,52,76,100,124,148]],[[28,30,30,30],[40,20,66,56],[4,22,48,74,100,126,152]],[[28,30,30,30],[43,21,70,59],[4,26,52,78,104,130,156]],[[28,30,30,30],[45,22,74,62],[4,30,56,82,108,134,160]],[[28,30,30,30],[47,24,77,65],[4,24,52,80,108,136,164]],[[28,30,30,30],[49,25,81,68],[4,28,56,84,112,140,168]]],e=0,f=1,g=2,h=4,k=8,l=/^\d*$/,m=/^[A-Za-z0-9 $%*+\-./:]*$/,n=/^[A-Z0-9 $%*+\-./:]*$/,o=1,p=0,q=3,r=2,s=[],t=[-1],u=0,i=1;255>u;++u)s.push(i),t[i]=u,i=2*i^(128<=i?285:0);for(var w=[[]],u=0;30>u;++u){for(var v=w[u],x=[],y=0;y<=u;++y){var j=y<u?s[v[y]]:0,a=s[(u+(v[y-1]||0))%255];x.push(t[j^a])}w.push(x)}for(var b={},u=0;45>u;++u)b['0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:'.charAt(u)]=u;var z=[function(a,b){return 0==(a+b)%2},function(a){return 0==a%2},function(a,b){return 0==b%3},function(a,b){return 0==(a+b)%3},function(a,b){return 0==((0|a/2)+(0|b/3))%2},function(a,b){return 0==a*b%2+a*b%3},function(a,b){return 0==(a*b%2+a*b%3)%2},function(a,b){return 0==((a+b)%2+a*b%3)%2}],A=function(a){return 6<a},B=function(a){return 4*a+17},C=function(a){var b=d[a],c=16*a*a+128*a+64;return A(a)&&(c-=36),b[2].length&&(c-=25*b[2].length*b[2].length-10*b[2].length-55),c},D=function(a,b){var c=-8&C(a),e=d[a];return c-=8*e[0][b]*e[1][b],c},E=function(a,b){return b===f?10>a?10:27>a?12:14:b===g?10>a?9:27>a?11:13:b===h?10>a?8:16:b===k?10>a?8:27>a?10:12:void 0},F=function(a,b,c){var d=D(a,c)-4-E(a,b);return b===f?3*(0|d/10)+(4>d%10?0:7>d%10?1:2):b===g?2*(0|d/11)+(6>d%11?0:1):b===h?0|d/8:b===k?0|d/13:void 0},G=function(a,b){switch(a){case f:return b.match(l)?b:null;case g:return b.match(m)?b.toUpperCase():null;case h:if('string'===typeof b){for(var c,d=[],e=0;e<b.length;++e)c=b.charCodeAt(e),128>c?d.push(c):2048>c?d.push(192|c>>6,128|63&c):65536>c?d.push(224|c>>12,128|63&c>>6,128|63&c):d.push(240|c>>18,128|63&c>>12,128|63&c>>6,128|63&c);return d}return b;}},H=function(a,c,d,j){var k=[],l=0,m=8,n=d.length,o=function(a,b){if(b>=m){for(k.push(l|a>>(b-=m));8<=b;)k.push(255&a>>(b-=8));l=0,m=8}0<b&&(l|=(a&(1<<b)-1)<<(m-=b))},p=E(a,c);switch(o(c,4),o(n,p),c){case f:for(var q=2;q<n;q+=3)o(parseInt(d.substring(q-2,q+1),10),10);o(parseInt(d.substring(q-2),10),[0,4,7][n%3]);break;case g:for(var q=1;q<n;q+=2)o(45*b[d.charAt(q-1)]+b[d.charAt(q)],11);1==n%2&&o(b[d.charAt(q-1)],6);break;case h:for(var q=0;q<n;++q)o(d[q],8);}for(o(e,4),8>m&&k.push(l);k.length+1<j;)k.push(236,17);return k.length<j&&k.push(236),k},I=function(a,b){for(var c=a.slice(0),d=a.length,e=b.length,f=0;f<e;++f)c.push(0);for(var g,f=0;f<d;)if(g=t[c[f++]],0<=g)for(var h=0;h<e;++h)c[f+h]^=s[(g+b[h])%255];return c.slice(d)},J=function(a,b,c){for(var d=[],e=0|a.length/b,f=0,g=b-a.length%b,h=0;h<g;++h)d.push(f),f+=e;for(var h=g;h<b;++h)d.push(f),f+=e+1;d.push(f);for(var i=[],h=0;h<b;++h)i.push(I(a.slice(d[h],d[h+1]),c));for(var k=[],l=0|a.length/b,h=0;h<l;++h)for(var m=0;m<b;++m)k.push(a[d[m]+h]);for(var m=g;m<b;++m)k.push(a[d[m+1]-1]);for(var h=0;h<c.length;++h)for(var m=0;m<b;++m)k.push(i[m][h]);return k},K=function(a,b,c,d){for(var e=a<<d,f=b-1;0<=f;--f)1&e>>d+f&&(e^=c<<f);return a<<d|e},L=function(a){for(var b=d[a],c=B(a),e=[],f=[],g=0;g<c;++g)e.push([]),f.push([]);var h=function(a,b,c,d,g){for(var h=0;h<c;++h)for(var i=0;i<d;++i)e[a+h][b+i]=1&g[h]>>i,f[a+h][b+i]=1};h(0,0,9,9,[127,65,93,93,93,65,383,0,64]),h(c-8,0,8,9,[256,127,65,93,93,93,65,127]),h(0,c-8,9,8,[254,130,186,186,186,130,254,0,0]);for(var g=9;g<c-8;++g)e[6][g]=e[g][6]=1&~g,f[6][g]=f[g][6]=1;for(var l=b[2],n=l.length,g=0;g<n;++g)for(var m=0==g||g==n-1?1:0,o=0==g?n-1:n,p=m;p<o;++p)h(l[g],l[p],5,5,[31,17,21,17,31]);if(A(a))for(var j=K(a,6,7973,12),q=0,g=0;6>g;++g)for(var p=0;3>p;++p)e[g][c-11+p]=e[c-11+p][g]=1&j>>q++,f[g][c-11+p]=f[c-11+p][g]=1;return{matrix:e,reserved:f}},M=function(a,b,c){for(var d=a.length,e=0,f=-1,g=d-1;0<=g;g-=2){6==g&&--g;for(var h=0>f?d-1:0,i=0;i<d;++i){for(var j=g;j>g-2;--j)b[h][j]||(a[h][j]=1&c[e>>3]>>(7&~e),++e);h+=f}f=-f}return a},N=function(a,b,c){for(var d=z[c],e=a.length,f=0;f<e;++f)for(var g=0;g<e;++g)b[f][g]||(a[f][g]^=d(f,g));return a},O=function(a,b,d,e){for(var f=a.length,g=21522^K(d<<3|e,5,1335,10),h=0;15>h;++h){var i=[0,1,2,3,4,5,7,8,f-7,f-6,f-5,f-4,f-3,f-2,f-1][h],j=[f-1,f-2,f-3,f-4,f-5,f-6,f-7,f-8,7,5,4,3,2,1,0][h];a[i][8]=a[8][j]=1&g>>h}return a},P=function(a){for(var b=10,c=function(a){for(var b=0,c=0;c<a.length;++c)5<=a[c]&&(b+=3+(a[c]-5));for(var d,c=5;c<a.length;c+=2)d=a[c],a[c-1]==d&&a[c-2]==3*d&&a[c-3]==d&&a[c-4]==d&&(a[c-5]>=4*d||a[c+1]>=4*d)&&(b+=40);return b},d=a.length,e=0,f=0,g=0;g<d;++g){var h,i=a[g];h=[0];for(var l=0;l<d;){var j;for(j=0;l<d&&i[l];++j)++l;for(h.push(j),j=0;l<d&&!i[l];++j)++l;h.push(j)}e+=c(h),h=[0];for(var l=0;l<d;){var j;for(j=0;l<d&&a[l][g];++j)++l;for(h.push(j),j=0;l<d&&!a[l][g];++j)++l;h.push(j)}e+=c(h);var k=a[g+1]||[];f+=i[0];for(var m,l=1;l<d;++l)m=i[l],f+=m,i[l-1]==m&&k[l]===m&&k[l-1]===m&&(e+=3)}return e+=b*(0|Math.abs(f/d/d-0.5)/0.05),e},Q=function(a,b,c,e,f){var g=d[b],h=H(b,c,a,D(b,e)>>3);h=J(h,g[1][e],w[g[0][e]]);var i=L(b),j=i.matrix,k=i.reserved;if(M(j,k,h),0>f){N(j,k,0),O(j,k,e,0);var l=0,m=P(j);for(N(j,k,0),f=1;8>f;++f){N(j,k,f),O(j,k,e,f);var n=P(j);m>n&&(m=n,l=f),N(j,k,f)}f=l}return N(j,k,f),O(j,k,e,f),j},R={generate:function(a,b){b=b||{};var c=b.version||-1,d={L:o,M:p,Q:q,H:r}[(b.ecclevel||'L').toUpperCase()],e=b.mode?{numeric:f,alphanumeric:g,octet:h}[b.mode.toLowerCase()]:-1,i='mask'in b?b.mask:-1;if(0>e)e='string'===typeof a?a.match(l)?f:a.match(n)?g:h:h;else if(e!=f&&e!=g&&e!=h)throw'invalid or unsupported mode';if(a=G(e,a),null===a)throw'invalid data format';if(0>d||3<d)throw'invalid ECC level';if(0>c){for(c=1;40>=c&&!(a.length<=F(c,e,d));++c);if(40<c)throw'too large data'}else if(1>c||40<c)throw'invalid version';if(-1!=i&&(0>i||8<i))throw'invalid mask';return Q(a,c,e,d,i)},generateHTML:function(a,b){b=b||{};for(var d=R.generate(a,b),f=c(b.modulesize||5,0.5),g=c(null===b.margin?4:b.margin,0),h=document.createElement('div'),e=d.length,k=['<table border="0" cellspacing="0" cellpadding="0" style="border:'+f*g+'px solid #fff;background:#fff">'],l=0;l<e;++l){k.push('<tr>');for(var i=0;i<e;++i)k.push('<td style="width:'+f+'px;height:'+f+'px'+(d[l][i]?';background:#000':'')+'"></td>');k.push('</tr>')}return h.className='qrcode',h.innerHTML=k.join('')+'</table>',h},generatePNG:function(a,b){b=b||{};var d,e=R.generate(a,b),f=c(b.modulesize||5,0.5),g=c(null===b.margin?4:b.margin,0),h=e.length,k=f*(h+2*g),l=document.createElement('canvas');if(l.width=l.height=k,d=l.getContext('2d'),!d)throw'canvas support is needed for PNG output';d.fillStyle='#fff',d.fillRect(0,0,k,k),d.fillStyle='#000';for(var m=0;m<h;++m)for(var i=0;i<h;++i)e[m][i]&&d.fillRect(f*(g+i),f*(g+m),f,f);return l.toDataURL()}};return R}();</script><dom-module id="granite-qrcode-generator" assetpath="../granite-qrcode-generator/"><template><style>:host{display:block;}</style><div id="qrCodeContainer"></div></template><script>Polymer({is:"granite-qrcode-generator",properties:{data:{type:String},format:{type:String,value:"html"},modulesize:{type:Number,value:5},margin:{type:Number,value:4},version:{type:Number,value:-1},mode:{type:String,value:"numeric"},ecclevel:{type:String,value:"L"},mask:{type:Number,value:-1},auto:{type:Boolean,value:!1}},observers:["paramsChanged(data,version,mode,ecclevel,mask,auto)"],paramsChanged:function(){console.debug("[granite-qrcode-generator] paramsChanged - auto ",this.auto),this.auto&&this.generateQRCode()},generateQRCode:function(){if(this._validateParams()){var a={modulesize:this.modulesize,margin:this.margin,version:this.version,mode:this.mode,ecclevel:this.ecclevel,mask:this.mask};"png"===this.format?this.generateQRCodePNG(a):this.generateQRCodeHTML(a),this.fire("qrcode-generated")}},generateQRCodePNG:function(a){var b;try{b=document.createElement("img"),b.src=QRCode.generatePNG(this.data,a),this._appendQRCode(b)}catch(a){console.log("no canvas support")}},generateQRCodeHTML:function(a){console.debug("[granite-qrcode-generator] generateQRCodeHTML - data ",this.data);var b=QRCode.generateHTML(this.data,a);this._appendQRCode(b)},_appendQRCode:function(a){for(var b=Polymer.dom(this.$.qrCodeContainer).children.length-1;0<=b;b--)Polymer.dom(this.$.qrCodeContainer).removeChild(Polymer.dom(this.$.qrCodeContainer).children[b]);Polymer.dom(this.$.qrCodeContainer).appendChild(a)},_validateParams:function(){return this._validateModulesize()&&this._validateVersion()&&this._validateMode()&&this._validateMask()&&this._validateEcclevel()},_validateModulesize:function(){return!!(0.5<=this.modulesize)||(console.error("[granite-qrcode-generator] _validateModulesize - Invalid value of `modulesize`",this.modulesize),!1)},_validateMargin:function(){return!!(-1<=this.margin)||(console.error("[granite-qrcode-generator] _validateMargin - Invalid value of `margin`",this.margin),!1)},_validateVersion:function(){return-1==this.version||0<=this.version&&40>=this.version||(console.error("[granite-qrcode-generator] _validateVersion - Invalid value of `version`",this.version),!1)},_validateMode:function(){return"numeric"===this.mode||"alphanumeric"===this.mode||"octet"===this.mode||(console.error("[granite-qrcode-generator] _validateMode - Invalid value of `mode`",this.mode),!1)},_validateEcclevel:function(){return"L"===this.ecclevel||"M"===this.ecclevel||"Q"===this.ecclevel||"H"===this.ecclevel||(console.error("[granite-qrcode-generator] _validateEcclevel - Invalid value of `ecclevel`",this.ecclevel),!1)},_validateMask:function(){return-1<=this.mask&&7>=this.mask||(console.error("[granite-qrcode-generator] _validateMask - Invalid value of `mask`",this.mask),!1)}});</script></dom-module>"<iron-iconset-svg name="quantum" size="24"><svg><defs><g id="qrcode"><path class="path1" d="M1 1 1 8.3c0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0 0.7 0 0.4 0 1 0 1.6 0 0.6 0 1.2 0 1.6 0 0.5 0 0.8 0 0.8 0 0 0 0.1-0.1 0.1-0.1 0.1-0.1 0.1-0.2 0.2-0.3C6.2 7.8 6.3 7.7 6.5 7.5 6.6 7.4 6.8 7.2 7 7 7.2 6.8 7.3 6.7 7.5 6.5 7.7 6.4 7.8 6.3 7.9 6.2 8 6.1 8.1 6 8.2 6 8.3 5.9 8.3 5.8 8.3 5.8c0 0 0-0.4 0-0.8 0-0.5 0-1 0-1.6 0-0.6 0-1.2 0-1.6 0-0.4 0-0.7 0-0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0 0.5 0l-7.7 0zm14.2 0c0.3 0 0.5 0 0.5 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0 0.7 0 0.4 0 0.9 0 1.4 0 0.5 0 1.1 0 1.5 0 0.4 0 0.7 0 0.7 0 0 0 0.1 0.1 0.1 0.1 0 0.1 0.1 0.2 0.1 0.2 0.1 0.4 0.2 0.6 0.4 0.2 0.1 0.4 0.3 0.4 0.3 0 0 0 0 0 0 0 0 0 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0 0 0 0 0-0.9 0-1.9l0-1.8 4.2 0 0 4.2-1.8 0c-1 0-1.8 0-1.9 0 0 0 0 0-0.1 0 0 0 0 0 0 0.1 0 0 0 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0.1 0.1 0.1 0.3 0.3 0.4 0.5 0.2 0.2 0.3 0.4 0.4 0.5 0 0.1 0.1 0.1 0.1 0.1 0 0 0.1 0.1 0.1 0.1 0 0 0.3 0 0.7 0 0.4 0 0.9 0 1.4 0 0.5 0 1 0 1.3 0 0.4 0 0.6 0 0.6 0 0 0 0 0 0 0 0 0 0 0 0 0l0-7.3-7.8 0zm-2.6 0c-0.4 0-0.7 0-1 0-0.1 0-0.3 0-0.3 0-0.1 0-0.1 0-0.1 0 0 0 0 0 0 0.1 0 0.1 0 0.1 0 0.3 0 0.2 0 0.6 0 1.1l0 1.4-0.7 0c-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0 0 0 0.1 0 0.2 0 0.1 0 0.2 0 0.4 0 0.1 0 0.3 0 0.4 0 0.1 0 0.2 0 0.2 0 0 0 0 0 0.1 0 0 0 0 0.1 0 0.1 0 0.1 0 0.3-0.1 0.2-0.1 0.5-0.1 0.7-0.2 0.1 0 0.2 0 0.3-0.1 0 0 0.1 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0-0.1 0 0 0-0.1 0-0.1 0-0.1 0-0.2 0-0.3l0-0.3 1.3 0 0 0.3c0 0.1 0 0.2 0 0.3 0 0 0 0.1 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0.1 0 0 0 0 0 0.1 0 0.1 0 0.1 0 0.2 0 0.2 0 0.5 0.1 0.7 0.1 0.2 0 0.3 0 0.3 0 0 0 0 0 0.1 0 0 0 0 0 0 0 0 0 0-0.1 0-0.2 0-0.1 0-0.2 0-0.3 0-0.1 0-0.2 0-0.3 0-0.1 0-0.1 0-0.2 0 0 0 0-0.1 0 0 0-0.1 0-0.1 0-0.1 0-0.3 0-0.6 0l-0.7 0 0-1.3 0.7 0c0.3 0 0.4 0 0.6 0 0.1 0 0.1 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0-0.1 0 0 0-0.1 0-0.1 0-0.1 0-0.3 0-0.5 0-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0-0.1 0-0.1 0-0.1 0-0.2 0-0.3 0-0.3 0-0.6 0-1 0zm-10.2 1.5 4.2 0 0 4.2-4.2 0 0-4.2zM4.1 3.5c-0.1 0-0.3 0-0.3 0-0.1 0-0.1 0-0.2 0 0 0-0.1 0-0.1 0 0 0 0 0 0 0.1 0 0 0 0.1 0 0.2 0 0.1 0 0.4 0 0.8 0 0.5 0 0.8 0 1 0 0.1 0 0.1 0 0.2 0 0 0 0 0.1 0.1 0 0 0.5 0 1.1 0 0.4 0 0.7 0 0.9 0 0.1 0 0.1 0 0.2 0 0 0 0.1 0 0.1 0 0 0 0 0 0-0.1 0 0 0-0.1 0-0.2 0-0.2 0-0.4 0-0.9C5.8 4.3 5.8 4.1 5.8 3.9 5.8 3.7 5.8 3.5 5.8 3.5 5.8 3.5 5.6 3.5 5.4 3.5 5.2 3.5 4.9 3.5 4.7 3.5 4.4 3.5 4.2 3.5 4.1 3.5Zm14.8 0c-0.1 0-0.3 0-0.3 0-0.1 0-0.1 0-0.2 0 0 0-0.1 0-0.1 0 0 0 0 0 0 0.1 0 0 0 0.1 0 0.2 0 0.1 0 0.4 0 0.8 0 0.5 0 0.8 0 1 0 0.1 0 0.1 0 0.2 0 0 0 0 0.1 0.1 0 0 0.2 0 0.4 0 0.2 0 0.5 0 0.7 0 0.3 0 0.5 0 0.7 0 0.2 0 0.3 0 0.3 0 0 0 0-0.2 0-0.4 0-0.2 0-0.5 0-0.7 0-0.3 0-0.5 0-0.7 0-0.2 0-0.3 0-0.4 0 0-0.1 0-0.3 0-0.2 0-0.5 0-0.8 0-0.2 0-0.4 0-0.6 0zm-6.5 1.9c-0.2 0-0.4 0-0.5 0-0.2 0-0.3 0-0.4 0-0.2 0-0.4 0.1-0.6 0.1-0.2 0-0.4 0.1-0.6 0.2C10.1 5.7 9.9 5.8 9.7 5.9 9.6 5.9 9.4 6 9.2 6.1 9 6.2 8.9 6.3 8.7 6.4 8.6 6.5 8.4 6.6 8.2 6.7 8.1 6.8 7.9 6.9 7.8 7 7.7 7.2 7.5 7.3 7.4 7.4 7.3 7.6 7.1 7.7 7 7.8 6.9 8 6.8 8.1 6.7 8.3 6.5 8.4 6.4 8.6 6.3 8.7 6.2 8.9 6.2 9.1 6.1 9.2 6 9.4 5.9 9.6 5.8 9.8c-0.1 0.2-0.1 0.4-0.2 0.5-0.1 0.2-0.1 0.4-0.2 0.6 0 0.2-0.1 0.4-0.1 0.6 0 0.1 0 0.3 0 0.4 0 0.2 0 0.3 0 0.5 0 0.2 0 0.4 0 0.5 0 0.2 0 0.3 0 0.4 0 0.2 0.1 0.4 0.1 0.6 0 0.2 0.1 0.4 0.2 0.6 0.1 0.2 0.1 0.4 0.2 0.5 0.1 0.2 0.2 0.3 0.2 0.5 0.1 0.2 0.2 0.3 0.3 0.5 0.1 0.2 0.2 0.3 0.3 0.5 0.1 0.2 0.2 0.3 0.3 0.4 0.1 0.1 0.2 0.3 0.4 0.4 0.1 0.1 0.3 0.3 0.4 0.4 0.1 0.1 0.3 0.2 0.4 0.3 0.2 0.1 0.3 0.2 0.5 0.3 0.2 0.1 0.3 0.2 0.5 0.3 0.2 0.1 0.3 0.2 0.5 0.2 0.2 0.1 0.4 0.1 0.5 0.2 0.2 0.1 0.4 0.1 0.6 0.2 0.2 0 0.4 0.1 0.6 0.1 0.1 0 0.3 0 0.4 0 0.2 0 0.3 0 0.5 0 0.2 0 0.4 0 0.5 0 0.2 0 0.3 0 0.4 0 0.2 0 0.4-0.1 0.7-0.1 0.2-0.1 0.5-0.1 0.7-0.2 0.2-0.1 0.4-0.2 0.6-0.2 0.2-0.1 0.4-0.2 0.5-0.3 0.1-0.1 0.2-0.1 0.2-0.1 0 0 0.3 0.2 0.7 0.6 0.4 0.4 0.9 0.9 1.5 1.5 0.9 0.9 1.4 1.4 1.7 1.7 0.2 0.2 0.3 0.3 0.4 0.4 0.1 0.1 0.2 0.1 0.2 0.2 0.1 0 0.2 0.1 0.2 0.1 0.1 0 0.1 0.1 0.2 0.1 0.1 0 0.1 0 0.2 0 0 0-0.1 0-0.2 0l2 0 0-1.8c0 0 0-0.1 0-0.2 0 0 0-0.1-0.1-0.2 0-0.1-0.1-0.2-0.1-0.2 0-0.1-0.1-0.1-0.2-0.2-0.1-0.1-0.2-0.2-0.4-0.4-0.3-0.4-0.9-0.9-1.7-1.7-0.6-0.6-1.1-1.1-1.5-1.5-0.4-0.4-0.6-0.6-0.6-0.7 0 0 0-0.1 0.1-0.2 0.1-0.2 0.2-0.3 0.3-0.5 0.1-0.2 0.2-0.4 0.2-0.6 0.1-0.2 0.1-0.4 0.2-0.7 0.1-0.2 0.1-0.5 0.1-0.7 0-0.1 0-0.3 0-0.4 0-0.2 0-0.3 0-0.5 0-0.2 0-0.4 0-0.5 0-0.2 0-0.3 0-0.4 0-0.2-0.1-0.4-0.1-0.6 0-0.2-0.1-0.4-0.2-0.6C19.1 10.1 19 9.9 18.9 9.8 18.8 9.6 18.8 9.4 18.7 9.2 18.6 9.1 18.5 8.9 18.4 8.7 18.3 8.6 18.2 8.4 18.1 8.3 18 8.1 17.9 8 17.7 7.8 17.6 7.7 17.5 7.5 17.4 7.4 17.2 7.3 17.1 7.2 16.9 7 16.8 6.9 16.7 6.8 16.5 6.7 16.4 6.6 16.2 6.5 16 6.4 15.9 6.3 15.7 6.2 15.5 6.1 15.4 6 15.2 5.9 15 5.9 14.8 5.8 14.7 5.7 14.5 5.7 14.3 5.6 14.1 5.6 13.9 5.5 13.7 5.5 13.5 5.4 13.3 5.4 13.2 5.4 13.1 5.4 12.9 5.4 12.7 5.4 12.6 5.4 12.4 5.4Zm-0.1 2c0.1 0 0.1 0 0.2 0 0.2 0 0.4 0 0.6 0 0.2 0 0.3 0 0.4 0.1 0.1 0 0.2 0.1 0.4 0.1 0.1 0 0.2 0.1 0.3 0.1 0.1 0 0.2 0.1 0.3 0.1 0.1 0 0.2 0.1 0.3 0.2 0.1 0.1 0.2 0.1 0.3 0.2 0.1 0.1 0.2 0.1 0.3 0.2 0.1 0.1 0.2 0.1 0.3 0.2 0.1 0.1 0.2 0.2 0.3 0.2 0.1 0.1 0.2 0.2 0.2 0.3 0.1 0.1 0.2 0.2 0.2 0.3 0.1 0.1 0.1 0.2 0.2 0.3 0.1 0.1 0.1 0.2 0.2 0.3 0.1 0.1 0.1 0.2 0.2 0.3 0.1 0.1 0.1 0.2 0.1 0.3 0 0.1 0.1 0.2 0.1 0.4 0 0.1 0.1 0.2 0.1 0.4 0 0.1 0 0.3 0.1 0.4 0 0.2 0 0.4 0 0.6 0 0.2 0 0.4 0 0.6 0 0.2 0 0.3 0 0.4 0 0.2-0.1 0.4-0.2 0.6-0.1 0.2-0.1 0.4-0.2 0.5-0.1 0.2-0.2 0.3-0.3 0.5-0.1 0.2-0.2 0.3-0.3 0.5-0.1 0.1-0.2 0.3-0.4 0.4-0.1 0.1-0.3 0.3-0.4 0.4-0.1 0.1-0.3 0.2-0.4 0.3-0.2 0.1-0.3 0.2-0.5 0.3-0.2 0.1-0.4 0.2-0.5 0.2-0.2 0.1-0.3 0.1-0.5 0.2-0.2 0-0.3 0.1-0.5 0.1-0.2 0-0.4 0-0.6 0-0.4 0-0.8 0-0.8 0-0.2 0-0.3-0.1-0.5-0.1-0.1 0-0.3-0.1-0.4-0.1-0.1 0-0.2-0.1-0.4-0.1C10.3 17 10.2 16.9 10.1 16.9 9.9 16.8 9.8 16.7 9.6 16.6 9.4 16.5 9.3 16.4 9.1 16.3 9 16.2 8.9 16 8.7 15.9 8.6 15.8 8.5 15.6 8.4 15.5 8.3 15.3 8.2 15.2 8.1 15 8 14.9 7.9 14.7 7.8 14.5 7.7 14.4 7.7 14.2 7.6 14 7.5 13.8 7.5 13.7 7.4 13.5c0-0.1 0-0.3-0.1-0.4 0-0.2 0-0.4 0-0.6 0-0.2 0-0.4 0-0.6 0-0.2 0-0.3 0-0.4 0-0.1 0.1-0.2 0.1-0.4 0-0.1 0.1-0.2 0.1-0.4 0-0.1 0.1-0.2 0.1-0.3C7.8 10.2 7.9 10.1 7.9 10 8 9.9 8.1 9.8 8.1 9.7 8.2 9.6 8.3 9.5 8.3 9.4 8.4 9.3 8.5 9.2 8.6 9.1 8.6 9 8.7 8.9 8.8 8.8 8.9 8.7 9 8.6 9.1 8.6 9.2 8.5 9.3 8.4 9.4 8.3 9.5 8.3 9.6 8.2 9.7 8.1 9.8 8.1 9.9 8 10 7.9 10.1 7.9 10.2 7.8 10.3 7.8c0.1-0.1 0.2-0.1 0.3-0.1 0.1 0 0.2-0.1 0.4-0.1 0.1 0 0.2-0.1 0.4-0.1 0.1 0 0.3 0 0.4 0 0.1 0 0.3 0 0.4 0zM2.8 9.7c-0.1 0-0.2 0-0.2 0-0.1 0-0.1 0-0.1 0 0 0 0 0-0.1 0 0 0 0 0 0 0.1 0 0 0 0.1 0 0.2 0 0.2 0 0.6 0 1.2l0 1.4-0.6 0c-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0 0 0 0 0 0 0 0 0 0 0 0l0 1.5c0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0 0.2 0 0.1 0 0.3 0 0.5 0 0.3 0 0.4 0 0.6 0 0.1 0 0.1 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0-0.1 0 0 0-0.1 0-0.1 0-0.1 0-0.3 0-0.5l0-0.7 1 0c0.4 0 0.7 0 0.8 0 0.1 0 0.2 0 0.2 0 0 0 0.1 0 0.1 0 0 0 0 0 0-0.1 0 0 0-0.1 0-0.1 0-0.1 0-0.3 0-0.6 0-0.2 0-0.4 0-0.5 0-0.1 0-0.1 0-0.1 0 0 0-0.1 0-0.1 0 0 0 0-0.1-0.1 0 0-0.1 0-0.1 0-0.1 0-0.2 0-0.3 0l-0.3 0 0-0.7c0-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0-0.1 0-0.2 0C3.5 9.7 3.4 9.7 3.2 9.7 3 9.7 2.9 9.7 2.8 9.7Zm18.3 0c-0.1 0-0.2 0-0.3 0-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0 0 0 0.1 0 0.2 0 0.1 0 0.3 0 0.5 0 0.2 0 0.4 0 0.5 0 0.1 0 0.2 0 0.3 0 0 0 0 0.1 0 0 0 0.1 0 0.1 0 0.1 0 0.3 0 0.6 0l0.7 0 0 1.3-0.7 0c-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0 0 0 0.1 0 0.2 0 0.1 0 0.3 0 0.5 0 0.3 0 0.5 0 0.6 0 0 0 0.1 0 0.1 0 0 0 0 0 0 0 0 0 0-0.1 0 0 0 0 0.1-0.1 0.1 0 0.1-0.1 0.2-0.2 0.4-0.1 0.3-0.3 0.7-0.3 0.9-0.1 0.2-0.2 0.3-0.2 0.4 0 0 0.2 0.2 0.4 0.5 0.1 0.1 0.2 0.2 0.3 0.3 0.1 0.1 0.1 0.1 0.2 0.1 0 0 0.1 0 0.1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.6 0-1.3l0-1.2 1.3 0 0 0.7c0 0.3 0 0.5 0 0.6 0 0.1 0 0.1 0 0.1 0 0 0 0 0 0.1 0 0 0.1 0 0.3 0 0.1 0 0.3 0 0.5 0 0.2 0 0.3 0 0.5 0 0.1 0 0.2 0 0.2 0 0 0 0 0 0 0 0 0 0 0 0 0l0-4.4c0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.1 0-0.2 0-0.1 0-0.3 0-0.5 0l-0.6 0 0-0.7c0-0.3 0-0.5 0-0.6 0-0.1 0-0.1 0-0.1 0 0 0 0 0-0.1 0 0-0.1 0-0.3 0-0.1 0-0.1 0-0.2 0zM3.9 15.6c-0.3 0-0.5 0-0.8 0-0.5 0-1.1 0-1.5 0-0.4 0-0.7 0-0.7 0 0 0 0 0 0 0 0 0 0 0 0 0l0 7.3 7.5 0c-0.1 0-0.2 0-0.2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.2 0-0.6 0-0.4 0-0.8 0-1.3 0-0.5 0-1 0-1.4 0-0.4 0-0.7 0-0.7 0 0 0-0.1-0.1-0.1C8.2 18.8 8.2 18.8 8.2 18.8 8 18.7 7.8 18.5 7.7 18.4 7.5 18.3 7.3 18.1 7.2 18 7.1 17.9 7.1 17.9 7 17.8 7 17.8 6.9 17.8 6.9 17.7 6.8 17.7 6.8 17.7 6.8 17.7c0 0 0 0 0 0.1 0 0 0 0.9 0 1.9l0 1.8-4.2 0 0-4.2 1.9 0c1 0 1.9 0 1.9 0 0 0 0 0 0 0 0 0 0 0 0-0.1 0 0 0 0 0-0.1 0 0 0 0 0 0C6.3 17 6.1 16.8 6 16.6 5.9 16.4 5.7 16.1 5.6 16 5.6 15.9 5.5 15.8 5.5 15.7 5.4 15.7 5.4 15.6 5.4 15.6c0 0-0.3 0-0.7 0-0.2 0-0.4 0-0.7 0zm17.4 1.4c-0.1 0-0.3 0-0.4 0-0.2 0-0.4 0-0.4 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0 0 0.2 0.2 0.4 0.4 0.2 0.3 0.6 0.6 0.9 0.9 0.3 0.3 0.6 0.6 0.9 0.9 0.2 0.2 0.4 0.4 0.4 0.4 0 0 0 0.1 0 0.1l0-2.8c0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.2 0-0.4 0-0.2 0-0.5 0-0.8 0-0.2 0-0.3 0-0.5 0zM4.1 18.2c-0.1 0-0.3 0-0.3 0-0.1 0-0.1 0-0.2 0 0 0-0.1 0-0.1 0 0 0 0 0 0 0.1 0 0 0 0.1 0 0.2 0 0.1 0 0.4 0 0.8 0 0.5 0 0.8 0 1 0 0.1 0 0.1 0 0.2 0 0 0 0 0.1 0.1 0 0 0.2 0 0.4 0 0.2 0 0.5 0 0.7 0 0.3 0 0.5 0 0.7 0 0.2 0 0.3 0 0.3 0 0 0 0-0.2 0-0.4 0-0.2 0-0.5 0-0.7 0-0.3 0-0.5 0-0.7 0-0.2 0-0.3 0-0.4 0 0-0.1 0-0.3 0-0.2 0-0.5 0-0.8 0-0.2 0-0.4 0-0.6 0zm11.9 0.9c0 0-0.1 0-0.2 0.1-0.1 0-0.1 0-0.1 0.1 0 0-0.1 0.1-0.1 0.1 0 0 0 0.1 0 0.1 0 0.1 0 0.1 0 0.2l0 0.2-0.7 0c-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0 0 0 0.1 0 0.2 0 0.1 0 0.3 0 0.5l0 0.7-2.8 0 0-0.7c0-0.3 0-0.5 0-0.6 0-0.1 0-0.1 0-0.1 0 0 0 0 0-0.1 0 0-0.1 0-0.3 0-0.1 0-0.3 0-0.5 0-0.2 0-0.4 0-0.5 0-0.1 0-0.2 0-0.2 0 0 0 0 0.1 0 0.2 0 0.1 0 0.3 0 0.5 0 0.2 0 0.4 0 0.5 0 0.1 0 0.2 0 0.3 0 0 0 0 0.1 0 0 0 0.1 0 0.1 0 0.1 0 0.3 0 0.6 0l0.7 0 0 0.6c0 0.2 0 0.4 0 0.5 0 0.1 0 0.2 0 0.2 0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.1 0-0.2 0l7.7 0c-0.1 0-0.2 0-0.2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.1 0-0.1 0-0.1 0-0.3 0-0.5 0-0.3 0-0.4 0-0.5 0 0 0-0.1 0-0.1 0 0 0-0.1-0.1-0.1l-0.1-0.1-2.7 0 0-1.3 0.5 0c0.3 0 0.4 0 0.5 0 0 0 0.1 0 0.1 0 0 0 0 0 0-0.1 0 0-0.1-0.1-0.1-0.2-0.1-0.1-0.2-0.2-0.3-0.3-0.1-0.1-0.2-0.2-0.3-0.3-0.1-0.1-0.1-0.1-0.2-0.1z"></path></g></defs></svg></iron-iconset-svg><dom-module id="quantum-show-share-links"><template><style>:host{display:block;}granite-alert{margin:10px 0;display:none;}*[show]{display:block;}.item_vert{@apply --layout-vertical;}.item_horizontal{@apply --layout-horizontal;}#icon_qrcode{margin-right:10px;cursor:pointer;}paper-dialog{padding-top:30px;}#closeButton{position:absolute;justify-content:flex-end;right:16px;top:16px;margin:0 !important;padding:0 !important;transition:color 0.5s cubic-bezier(.25, .8, .25, 1);color:var(--google-grey-300);}</style><paper-dialog id="qrcode"><paper-button id="closeButton" on-tap="_closeQRCode"><iron-icon icon="close"></iron-icon></paper-button><h2>Share {{linkType}} QRCode</h2><granite-qrcode-generator mode="octet" data="{{defaultQuantum}}#/shared-result/{{snapshotId}}" auto=""></granite-qrcode-generator></paper-dialog><granite-alert level="danger" show$="{{error}}"><div class="item_vert"><h4>Share {{linkType}} error</h4></div></granite-alert><granite-alert level="success" show$="{{snapshotId}}"><div class="item_horizontal"><div class="item_vert"><h4>Share {{linkType}}</h4><div class="item_horizontal"><iron-icon id="icon_qrcode" icon="quantum:qrcode" on-tap="_openQRCode"></iron-icon>Link: <a href$="./#/shared-code/{{snapshotId}}" target="_blank">{{urlRoot}}#/shared-code/{{snapshotId}}</a></div><div class="item">Deletion link: <a href$="./#/delete-shared-code/{{snapshotId}}/{{snapshotSecret}}" target="_blank">{{urlRoot}}#/delete-shared-code/{{snapshotId}}/{{snapshotSecret}}</a></div></div></div></granite-alert></template><script>class QuantumShowShareLinks extends Warp10QuantumModuleMixin(Polymer.Element){static get is(){return'quantum-show-share-links'}static get properties(){return{snapshotId:{type:String,value:''},snapshotSecret:{type:String,value:''},linkType:{type:String,value:''},error:{type:Boolean,value:!1},urlRoot:{type:String,value:''}}}_openQRCode(){this.$.qrcode.open()}_closeQRCode(){this.$.qrcode.close()}}customElements.define(QuantumShowShareLinks.is,QuantumShowShareLinks);</script></dom-module><iron-iconset-svg size="24" name="quantum-icons"><svg><defs><g id="check"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></g><g id="room"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></g><g id="timeline"><path d="M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2z"></path></g><g id="share"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"></path></g></defs></svg></iron-iconset-svg></div>"""<script>ace.define("ace/mode/warpscript_keywords",function(a,b){"use strict";b.KeywordMap={"constant.language":"NULL|NaN|E|e|PI|pi|NOW|MAXLONG|MINLONG|TRUE|true|FALSE|false","keyword.control":"ASSERT|BREAK|FAIL|FOR|FOREACH|FORSTEP|IFT|IFTE|RETURN|UNTIL|WHILE","keyword.other":"bucketizer.count|bucketizer.count.exclude-nulls|bucketizer.count.include-nulls|bucketizer.count.nonnull|bucketizer.first|bucketizer.join|bucketizer.join.forbid-nulls|bucketizer.last|bucketizer.max|bucketizer.max.forbid-nulls|bucketizer.mean|bucketizer.mean.exclude-nulls|bucketizer.median|bucketizer.min|bucketizer.min.forbid-nulls|bucketizer.percentile|bucketizer.sum|bucketizer.sum.forbid-nulls|filter.byclass|filter|.bylabels|filter.last.eq|filter.last.ge|filter.last.gt|filter.last.le|filter.last.lt|filter.last.ne|mapper.abs|mapper.add|mapper.ceil|mapper.count|mapper.count.exclude-nulls|mapper.count.include-nulls|mapper.count.nonnull|mapper.day|mapper.delta|mapper.dotproduct|mapper.dotproduct.positive|mapper.dotproduct.sigmoid|mapper.dotproduct.tanh|mapper.eq|mapper.exp|mapper.first|mapper.floor|mapper.ge|mapper.geo.approximate|mapper.geo.clear|mapper.geo.outside|mapper.geo.within|mapper.gt|mapper.hdist|mapper.highest|mapper.hour|mapper.hspeed|mapper.join|mapper.join.forbid-nulls|mapper.kernel.cosine|mapper.kernel.epanechnikov|mapper.kernel.gaussian|mapper.kernel.logistic|mapper.kernel.quartic|mapper.kernel.silverman|mapper.kernel.triangular|mapper.kernel.tricube|mapper.kernel.triweight|mapper.kernel.uniform|mapper.last|mapper.le|mapper.log|mapper.lowest|mapper.lt|mapper.max|mapper.max.forbid-nulls|mapper.max.x|mapper.mean|mapper.mean.exclude-nulls|mapper.median|mapper.min|mapper.min.forbid-nulls|mapper.min.x|mapper.minute|mapper.month|mapper.mul|mapper.ne|mapper.npdf|mapper.percentile|mapper.pow|mapper.product|mapper.rate|mapper.replace|mapper.round|mapper.sd|mapper.sd.forbid-nulls|mapper.second|mapper.sigmoid|mapper.sum|mapper.sum.forbid-nulls|mapper.tanh|mapper.tick|mapper.toboolean|mapper.todouble|mapper.tolong|mapper.tostring|mapper.truecourse|mapper.var|mapper.var.forbid-nulls|mapper.vdist|mapper.vspeed|mapper.weekday|mapper.year|max.tick.sliding.window|max.time.sliding.window|op.add|op.and|op.div|op.eq|op.ge|op.gt|op.le|op.lt|op.mask|op.mul|op.ne|op.or|op.sub|reducer.argmax|reducer.argmin|reducer.count|reducer.count.exclude-nulls|reducer.count.include-nulls|reducer.count.nonnull|reducer.join|reducer.join.forbid-nulls|reducer.join.nonnull|reducer.max|reducer.max.forbid-nulls|reducer.max.nonnull|reducer.mean|reducer.mean.exclude-nulls|reducer.median|reducer.min|reducer.min.forbid-nulls|reducer.min.nonnull|reducer.percentile|reducer.product|reducer.sd|reducer.sd.forbid-nulls|reducer.shannonentropy.0|reducer.shannonentropy.1|reducer.sum|reducer.sum.forbid-nulls|reducer.sum.nonnull|reducer.var|reducer.var.forbid-nulls","support.function":"->B64|->B64URL|->HEX|->JSON|->LIST|->MAP|->Q|->SET|ABS|ACOS|ADDVALUE|AND|APPEND|APPLY|ASIN|ATAN|ATBUCKET|ATINDEX|ATTICK|ATTRIBUTES|AUTHENTICATE|B64->|B64URL->|BUCKETCOUNT|BUCKETIZE|BUCKETSPAN|CBRT|CEIL|CHUNK|CLEAR|CLEARTOMARK|CLONE|CLONEEMPTY|CLONEREVERSE|COMMONTICKS|COMPACT|CONTAINS|CONTAINSKEY|CONTAINSVALUE|CONTINUE|COPYGEO|COPYSIGN|CORRELATE|COS|COSH|COUNTTOMARK|CROP|CSTORE|CUDF|DEBUGOFF|DEBUGON|DEDUP|DEF|DEFINED|DEPTH|DIFFERENCE|DISCORDS|DOC|DOCMODE|DOUBLEEXPONENTIALSMOOTHING|DROP|DROPN|DTW|DUP|DUPN|DURATION|DWTSPLIT|ELAPSED|ELEVATIONS|ESDTEST|EVAL|EVALSECURE|EVERY|EXP|EXPM1|FDWT|FETCH|FFT|FFTAP|FILLNEXT|FILLPREVIOUS|FILLTICKS|FILLVALUE|FILTER|FIND|FINDSETS|FINDSTATS|FIRSTTICK|FLATTEN|FLOOR|FORGET|FROMBITS|FROMHEX|FUSE|GEO.INTERSECTS|GEO.WITHIN|GEO_INTERSECTION|GEO_SUBTRACTION|GEO_UNION|GEO_WKT|GET|GROOVY|GRUBBSTEST|HASH|HAVERSINE|HEX->|HUMANDURATION|HYBRIDTEST|HYBRIDTEST2|HYPOT|IDENT|IDWT|IEEEREMAINDER|IFFT|INTEGRATE|INTERPOLATE|INTERSECTION|ISNULL|ISNaN|ISO8601|ISODURATION|ISONORMALIZE|JOIN|JS|JSON->|JSONLOOSE|JSONSTRICT|KEYLIST|LABELS|LASTBUCKET|LASTSORT|LASTTICK|LBOUNDS|LFLATMAP|LIMIT|LIST->|LMAP|LOAD|LOCATIONOFFSET|LOCATIONS|LOCSTRINGS|LOG|LOG10|LOG1P|LOWESS|LSORT|LUA|MACROBUCKETIZER|MACROFILTER|MACROMAPPER|MACROREDUCER|MAKEGTS|MAP->|MAP|MAPID|MARK|MATCH|MAX|MAXBUCKETS|MAXDEPTH|MAXGTS|MAXOPS|MAXSYMBOLS|MERGE|META|METASORT|MIN|MONOTONIC|MSGFAIL|MSORT|MSTU|MUSIGMA|NAME|NBOUNDS|NDEBUGON|NEWGTS|NEXTAFTER|NEXTUP|NONEMPTY|NOOP|NORMALIZE|NOT|NOTAFTER|NOTBEFORE|NOTIMINGS|NOW|NPDF|NRETURN|NSUMSUMSQ|ONLYBUCKETS|OPS|OR|PAPPLY|PARSESELECTOR|PARTITION|PATTERNDETECTION|PATTERNS|PFILTER|PICK|PROBABILITY|PUT|PYTHON|Q->|QCONJUGATE|QDIVIDE|QMULTIPLY|QROTATE|QROTATION|QUANTIZE|R|R->|RAND|RANGE|RANGECOMPACT|REDUCE|RELABEL|REMOVE|RENAME|RESET|RESETS|REV|REVERSE|RINT|RLOWESS|ROLL|ROLLD|ROT|ROTATIONQ|ROUND|RSORT|RUBY|RUN|RVALUESORT|SECUREKEY|SET|SET->|SETATTRIBUTES|SHRINK|SIGNUM|SIN|SINGLEEXPONENTIALSMOOTHING|SINH|SIZE|SORT|SPLIT|SQRT|STACKATTRIBUTE|STANDARDIZE|STL|STLESDTEST|STOP|STORE|STRICTMAPPER|STRICTPARTITION|STU|SUBLIST|SUBMAP|SUBSTRING|SWAP|SWITCH|TAN|TANH|TEMPLATE|THRESHOLDTEST|TICKINDEX|TICKLIST|TIMECLIP|TIMEMODULO|TIMESCALE|TIMESHIFT|TIMESPLIT|TIMINGS|TOBITS|TODEGREES|TODOUBLE|TOHEX|TOKENINFO|TOLONG|TOLOWER|TORADIANS|TOSELECTOR|TOSTRING|TOTIMESTAMP|TOUPPER|TRIM|TSELEMENTS|TYPEOF|UDF|ULP|UNBUCKETIZE|UNION|UNIQUE|UNSECURE|UNWRAP|UPDATE|URLDECODE|URLENCODE|UUID|VALUEDEDUP|VALUEHISTOGRAM|VALUELIST|VALUES|VALUESORT|VALUESPLIT|WEBCALL|WRAP|ZIP|ZSCORE|ZSCORETEST"}}),ace.define("ace/mode/warpscript_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules","ace/mode/warpscript_keywords"],function(a,b){"use strict";var c=a("../lib/oop"),d=a("./text_highlight_rules").TextHighlightRules,e=a("./warpscript_keywords").KeywordMap,f=function(){this.keywordMapper=this.createKeywordMapper(e,"identifier",!1),this.$rules={start:[{token:"comment",regex:/\/\//,next:"line_comment"},{token:"string.quoted.single",regex:/'[^']*'/},{token:"constant.numeric",regex:/[+-]?\d+(\.\d+)?([eE][+-]?\d+)?\b/},{token:"support.variable",regex:/\@[a-zA-Z0-9_$]*\b/},{token:this.keywordMapper,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b",caseInsensitive:!1},{token:"keyword.operator",regex:/!=|!|%|&|&&|\*|\*\*|\+|\-|\/|<|<=|==|>|>=|\[|\]|\[\]|\^|\{\}|\{|\}|\||\|\||~=/},{token:"paren.lparen",regex:/[\[\{]/},{token:"paren.rparen",regex:/[\]\}]/},{token:"text",regex:/\s+/}],line_comment:[{token:"comment",regex:"$|^",next:"start"},{defaultToken:"comment",caseInsensitive:!0}]}};c.inherits(f,d),b.WarpScriptHighlightRules=f}),ace.define("ace/mode/warpscript_completions",["require","exports","module","ace/token_iterator","ace/mode/warpscript_keywords"],function(a,b){"use strict";var c=a("./warpscript_keywords").KeywordMap,d=[];for(var e in c)d=d.concat(c[e].split(/\|/));d=d.sort();var f=function(){};(function(){this.getCompletions=function(a,b,c,e){console.debug("[mode-warpscript] getCompletions - keywordList",d);var f=[];for(var g in d)-1<d[g].search(e)&&f.push(d[g]);var h=f.map(function(a){return{caption:a,snippet:a,meta:"WARPSCRIPT",score:Number.MAX_VALUE}});return console.debug("[mode-warpscript] getCompletions - matching words",h),h}}).call(f.prototype),b.WarpScriptCompletions=f}),ace.define("ace/mode/warpscript",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/warpscript_highlight_rules","ace/range","ace/mode/warpscript_completions"],function(a,b){"use strict";var c=a("../lib/oop"),d=a("./text").Mode,e=a("./warpscript_highlight_rules").WarpScriptHighlightRules,f=a("./warpscript_completions").WarpScriptCompletions,g=a("../range").Range,h=function(){console.debug("[mode-warpscript] Mode initializing"),this.HighlightRules=e,this.$completer=new f};c.inherits(h,d),function(){this.lineCommentStart="*",this.$id="ace/mode/warpscript",this.getCompletions=function(a,b,c,d){var e=this.$completer.getCompletions(a,b,c,d);return console.debug("[mode-warpscript] completer response",e),e}}.call(h.prototype),b.Mode=h});</script><script>ace.define("ace/theme/eclipse",["require","exports","module","ace/lib/dom"],function(a,b){"use strict";b.isDark=!1,b.cssText=".ace-eclipse .ace_gutter {background: #ebebeb;border-right: 1px solid rgb(159, 159, 159);color: rgb(136, 136, 136);}.ace-eclipse .ace_print-margin {width: 1px;background: #ebebeb;}.ace-eclipse {background-color: #FFFFFF;color: black;}.ace-eclipse .ace_fold {background-color: rgb(60, 76, 114);}.ace-eclipse .ace_cursor {color: black;}.ace-eclipse .ace_storage,.ace-eclipse .ace_keyword,.ace-eclipse .ace_variable {color: rgb(127, 0, 85);}.ace-eclipse .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-eclipse .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-eclipse .ace_function {color: rgb(60, 76, 114);}.ace-eclipse .ace_string {color: rgb(42, 0, 255);}.ace-eclipse .ace_comment {color: rgb(113, 150, 130);}.ace-eclipse .ace_comment.ace_doc {color: rgb(63, 95, 191);}.ace-eclipse .ace_comment.ace_doc.ace_tag {color: rgb(127, 159, 191);}.ace-eclipse .ace_constant.ace_numeric {color: darkblue;}.ace-eclipse .ace_tag {color: rgb(25, 118, 116);}.ace-eclipse .ace_type {color: rgb(127, 0, 127);}.ace-eclipse .ace_xml-pe {color: rgb(104, 104, 91);}.ace-eclipse .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-eclipse .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-eclipse .ace_meta.ace_tag {color:rgb(25, 118, 116);}.ace-eclipse .ace_invisible {color: #ddd;}.ace-eclipse .ace_entity.ace_other.ace_attribute-name {color:rgb(127, 0, 127);}.ace-eclipse .ace_marker-layer .ace_step {background: rgb(255, 255, 0);}.ace-eclipse .ace_active-line {background: rgb(232, 242, 254);}.ace-eclipse .ace_gutter-active-line {background-color : #DADADA;}.ace-eclipse .ace_marker-layer .ace_selected-word {border: 1px solid rgb(181, 213, 255);}.ace-eclipse .ace_indent-guide {background: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==\") right repeat-y;}",b.cssClass="ace-eclipse";var c=a("../lib/dom");c.importCssString(b.cssText,b.cssClass)});</script><script>ace.define("ace/snippets/text",["require","exports","module"],function(a,b){"use strict";b.snippetText=void 0,b.scope="text"});</script><dom-module id="quantum-warpscript"><template><style>:host{display:block;padding:30px;--app-primary-color:var(--google-blue-500);--app-secondary-color:black;--app-background-color:white;--app-on-background-color:white;}.title{margin-bottom:10px;}ace-widget{--ace-widget-editor:{box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);};}.ace-editor{font-size:18px;}.top-10{margin-top:10px;}.left{float:left;}.right{float:right;}.btn[hidden],
      quantum-permalink-generator[hidden],
      quantum-response-container[hidden]{display:none;}.overlayBox{display:flex;flex-flow:row;justify-content:center;font-size:1.2em;}.overlayContent{}.hotkey-key{background-color:#333;border:1px solid #333;border-radius:5px;box-shadow:0 1px 0 #666 inset, 0 1px 0 #bbb;color:#fff;display:inline-block;font-size:1em;margin-right:5px;padding:5px 9px;text-align:center;}granite-alert[hidden]{display:none;}paper-button{background-color:var(--app-primary-color);color:var(--app-on-background-color);margin:5px;}granite-spinner{z-index:100;}.toolbar{@apply --layout-horizontal;@apply --layout-center;@apply --layout-end-justified;margin-bottom:10px;}.toolbar > *{height:24px;}.toolbar iron-icon{color:var(--app-primary-color);cursor:pointer;margin-left:10px;}.toolbar paper-tooltip{width:120px;text-align:center;}.toolbar iron-icon#saveDialogButton,
      .toolbar granite-file-saver iron-icon,
      .toolbar iron-icon#helpButton{--iron-icon-height:18px;--iron-icon-width:24px;}</style><style>.button_bar{@apply --layout-horizontal;@apply --layout-center;@apply --layout-wrap;@apply --layout-justified;}.item{margin-top:8px;margin-bottom:8px;}.item_list{@apply --layout-horizontal;@apply --layout-center;@apply --layout-wrap;}.item_name{color:var(--paper-grey-600);font-family:'Roboto', 'Noto', sans-serif;-webkit-font-smoothing:antialiased;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:12px;font-weight:400;letter-spacing:0.011em;line-height:20px;}.item_value{@apply --layout-horizontal;@apply --layout-center;@apply --layout-wrap;}.item_vert{@apply --layout-vertical;}.item_horizontal{@apply --layout-horizontal;@apply --layout-wrap;}.clearfix:before,
      .clearfix:after{content:" ";display:table;}.clearfix:after{clear:both;}.title{text-transform:capitalize;}paper-dialog{width:80vw;background:white;transition:box-shadow 0.5s cubic-bezier(.25, .8, .25, 1);box-shadow:0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);overflow:auto;border-radius:2px;padding:15px;--app-primary-color:var(--google-blue-500);--app-secondary-color:black;--app-background-color:white;--app-on-background-color:white;}paper-dialog .closeDialog{margin:0 !important;position:absolute;justify-content:flex-end;right:16px;top:16px;transition:color 0.5s cubic-bezier(.25, .8, .25, 1);color:var(--google-grey-300);cursor:pointer;}paper-dialog .header{@apply --layout-horizontal;@apply --layout-center;margin-top:30px !important;}paper-dialog .actions{margin-left:0;@apply --layout-horizontal;@apply --layout-center;@apply --layout-center-justified;}paper-button iron-icon{padding-right:10px;}</style><h2 class="title">WarpScript</h2><iron-a11y-keys target="[[_target]]" keys="e" on-keys-pressed="_hotkeyExecute"></iron-a11y-keys><iron-a11y-keys target="[[_target]]" keys="v" on-keys-pressed="_hotkeyViz"></iron-a11y-keys><iron-a11y-keys target="[[_target]]" keys="h ?:keypress" on-keys-pressed="_hotkeyHelp"></iron-a11y-keys><warp10-simple-overlay id="warpscript-ide-keyboard-shortcuts-overlay"><div class="overlay-box"><h4>Keyboard Shortcuts:</h4><p><span class="hotkey-key">?</span>, <span class="hotkey-key">h</span> Show / hide this help menu</p><p><span class="hotkey-key">Esc</span> Close dialogs</p><p><span class="hotkey-key">e</span> Execute WarpScript</p><p><span class="hotkey-key">v</span> visualize response</p><p><span class="hotkey-key">Ctrl+Space</span> Editor autocompletion</p></div></warp10-simple-overlay><quantum-local-collection-writer id="collectionWriter" warpscript="[[warpscript]]" on-keydown="_dontBubble" debug="[[debug]]" modal=""></quantum-local-collection-writer><quantum-local-collection-reader id="collectionReader" warpscript="[[warpscript]]" debug="[[debug]]" on-warpscript-choosen="_inputFileRead" on-keydown="_dontBubble"></quantum-local-collection-reader><warp10-warpscript-caller id="warpscriptcaller" debug="[[debug]]" url="{{_baseUrl}}" warpscript="{{warpscriptScript}}" on-response="_handleResponse" on-error="_handleError" loading="{{loading}}"></warp10-warpscript-caller><iron-ajax id="shareCodeRequest" url="{{czdBackend.url}}{{czdBackend.execEndpoint}}" content-type="application/x-www-form-urlencoded; charset=UTF-8" method="POST" body="{{_codeToShare}}" handle-as="text" on-response="_handleShareCodeResponse" on-error="_handleShareCodeError" loading="{{loading}}" debounce-duration="{{debounceDuration}}"></iron-ajax><iron-ajax id="shareResponseRequest" url="{{czdBackend.url}}{{czdBackend.execEndpoint}}" content-type="application/x-www-form-urlencoded; charset=UTF-8" method="POST" body="{{_responseToShare}}" handle-as="text" on-response="_handleShareResponseResponse" on-error="_handleShareResponseError" loading="{{loading}}" debounce-duration="{{debounceDuration}}"></iron-ajax><paper-dialog id="saveDialog"><div class="closeDialog" on-tap="_closeSaveDialog"><iron-icon icon="close"></iron-icon></div><h2 class="header">Save your WarpScript</h2><div class="actions"><granite-file-saver filename="{{_filename}}" id="warpscriptFileSaver" text="{{warpscript}}" on-file-saved="_closeSaveDialog"><paper-button>To a file</paper-button></granite-file-saver><paper-button id="collectionSaveButton" on-click="saveCollection">To in-browser storage</paper-button></div></paper-dialog><paper-dialog id="loadDialog"><div class="closeDialog" on-tap="_closeLoadDialog"><iron-icon icon="close"></iron-icon></div><h2 class="header">Load a WarpScript</h2><div class="actions"><granite-file-reader id="warpscriptFileReader" accept=".mc2" read-as="text" on-file-read="_inputFileRead"><paper-button>From a file</paper-button></granite-file-reader><paper-button id="collectionReadButton" on-click="readCollection">From in-browser storage</paper-button></div></paper-dialog><div class="toolbar"><div><iron-icon id="saveDialogButton" icon="file-download" on-tap="_openSaveDialog"></iron-icon></div><div><iron-icon id="loadDialogButton" icon="open-in-browser" on-click="_openLoadDialog"></iron-icon></div><div><iron-icon id="helpButton" icon="help" on-click="_hotkeyHelp"></iron-icon></div></div><paper-tooltip id="saveDialogButtonTooltip" for="saveDialogButton" fit-to-visible-bounds="">Save WarpScript</paper-tooltip><paper-tooltip id="loadDialogButtonTooltip" for="loadDialogButton" fit-to-visible-bounds="">Load WaprScript</paper-tooltip><paper-tooltip id="helpButtonTooltip" for="helpButton" fit-to-visible-bounds="">Help</paper-tooltip><ace-widget id="editor" theme="ace/theme/eclipse" mode="ace/mode/warpscript" softtabs="true" wrap="true" value="{{warpscript}}" placeholder="Type your WarpScript here..." initial-focus=""></ace-widget><granite-spinner active="{{loading}}" size="200" hover=""></granite-spinner><quantum-permalink-generator warpscript="{{warpscript}}" backend="{{backend}}" debug="[[debug]]" hidden$="{{!showPermalink}}"></quantum-permalink-generator><div class="top-10 button_bar"><div class="item_list"><template is="dom-if" if="{{!hidePlot}}"><div class="item_value"><paper-button on-click="viz" disabled$="{{loading}}" hidden$="{{!_hasAResponse}}"><iron-icon icon="quantum-icons:timeline"></iron-icon>Visualize</paper-button></div></template><div class="item_value"><paper-button id="btn_share_response" on-click="shareResponse" disabled$="{{_shareResponseDisabled}}" hidden$="{{!_hasAResponse}}"><iron-icon icon="quantum-icons:share"></iron-icon>Share response</paper-button></div></div><div class="item_list"><div class="item_value"><paper-button id="btn_share_code" class="btn btn-primary btn-lg" on-click="shareCode" disabled$="{{_shareCodeDisabled}}" hidden$="{{!_hasAResponse}}"><iron-icon icon="quantum-icons:share"></iron-icon>Share code</paper-button></div><div class="item_value"><paper-button id="btn_execute" class="btn btn-primary btn-lg" on-click="execute" disabled$="{{loading}}"><iron-icon icon="quantum-icons:check"></iron-icon>Execute</paper-button></div></div></div><template is="dom-if" if="{{_hasAResponse}}"><quantum-show-share-links link-type="response" error="{{_shareResponseError}}" debug="[[debug]]" snapshot-id="{{_lastSharedResponse.snapshotId}}" snapshot-secret="{{_lastSharedResponse.snapshotSecret}}" url-root="{{_sharingUrlRoot}}"></quantum-show-share-links></template><template is="dom-if" if="{{!_warpscriptChangedAfterExecution}}"><quantum-show-share-links link-type="code" error="{{_shareCodeError}}" debug="[[debug]]" snapshot-id="{{_lastSharedCode.snapshotId}}" snapshot-secret="{{_lastSharedCode.snapshotSecret}}" url-root="{{_sharingUrlRoot}}"></quantum-show-share-links><div class="top-10 clearfix"></div></template><template is="dom-if" if="{{_elapsedTimeShown}}"><div class="clearfix"></div><div class="top-10"><div class="right">Your script execution took {{_formattedElapsedTime}} serverside, fetched {{_fetched}} datapoints and performed {{_operations}} WarpScript operations.</div></div></template><div class="clearfix"></div><div class="top-10"><quantum-response-container id="response_container" response="{{stack}}" debug="[[debug]]" received="{{received}}" hidden$="{{!_hasAResponse}}"></quantum-response-container><granite-alert level="danger" hidden$="{{!_hasAnError}}">{{errorMsg}}</granite-alert></div></template><script>class QuantumWarpscript extends Warp10QuantumModuleMixin(Polymer.Element){static get is(){return'quantum-warpscript'}static get properties(){return{application:{type:String},warpscript:{type:String,value:'',observer:'_onWarpscriptChange'},selected:{type:String,observer:'_onSelectedChanged'},stack:{type:Array,notify:!0},_target:{type:Object,value:function(){return document.body}},elapsed:{type:Number,value:-1},_formattedElapsedTime:{type:String,computed:'_formatElapsedTime(elapsed)'},_elapsedTimeShown:{type:Boolean,computed:'_isElapsedTimeShown(elapsed)'},showPermalink:{type:Boolean,value:!1},hidePlot:{type:Boolean,value:!1},params:{type:Object,value:function(){return{}}},_hasAResponse:{type:Boolean,value:!1},_hasAnError:{type:Boolean,value:!1},_baseUrl:{type:String,computed:'_getBaseUrl(backend)'},_lastSharedCode:{type:String,value:''},_shareCodeDisabled:{type:Boolean,computed:'_isShareCodeDisabled(_warpscriptChangedAfterExecution, loading,_lastSharedCode)'},_shareCodeError:{type:Object,value:null},_lastSharedResponse:{type:String,value:''},_shareResponseDisabled:{type:Boolean,computed:'_isShareResponseDisabled(_warpscriptChangedAfterExecution,loading,_lastSharedResponse)'},_shareResponseError:{type:Object,value:null},_warpscriptChangedAfterExecution:{type:Boolean,value:!0},debug:{type:Boolean,value:!1}}}ready(){super.ready(),this.collectionWriter=this.$.collectionWriter,document.querySelector('body').appendChild(this.collectionWriter),this.collectionReader=this.$.collectionReader,document.querySelector('body').appendChild(this.collectionReader)}connectedCallback(){super.connectedCallback(),this.$.editor.addEventListener('editor-content',this.editorChangeAction.bind(this)),this.showPermalink&&!this._updateLocationDebouncer&&(this.debouncer=window.setTimeout(()=>{this._updateLocation(),this._updateLocationDebouncer=!1}))}_formatElapsedTime(){return 1e3>this.elapsed?''+this.elapsed+' ns':1e6>this.elapsed?''+(this.elapsed/1e3).toFixed(3)+' \u03BCs':1e9>this.elapsed?''+(this.elapsed/1e6).toFixed(3)+' ms':''+(this.elapsed/1e9).toFixed(3)+' s'}_isElapsedTimeShown(){return 0<this.elapsed}_getBaseUrl(){return this.backend.url+this.backend.execEndpoint}_isShareCodeDisabled(){return!!(this.loading||this._lastSharedCode&&this._lastSharedCode.snapshotId||this._warpscriptChangedAfterExecution)}_isShareResponseDisabled(){return!!(this.loading||this._lastSharedResponse&&this._lastSharedResponse.snapshotId)}_onWarpscriptChange(a){this.debug&&console.debug('[quantum-warpscript] _onWarpscriptChange',a),this._warpscriptChangedAfterExecution=!0,this._lastSharedCode=!1,this.showPermalink&&!this._updateLocationDebouncer&&(this.debouncer=window.setTimeout(()=>{this._updateLocation(),this._updateLocationDebouncer=!1}));let b=new Date().toISOString();this._filename='WarpsSript-'+b.slice(0,4)+b.slice(5,7)+b.slice(8,10)+b.slice(11,13)+b.slice(14,16)+b.slice(17,19)+'.mc2'}_onSelectedChanged(a){return a===this.name?void(this._target=document.body,this.params&&{}!==this.params&&this._getInfoFromParams(),this.debug&&console.debug('[quantum-warpscript] _onSelectedChanged',{selected:a,name:this.name,target:this._target})):void(this._target=null)}_handleResponse(a,b){console.log(a,b);b.stack&&b.stack instanceof Array&&(this.elapsed=b.options.elapsed,this._fetched=b.options.fetched,this._operations=b.options.operations,this.debug&&console.debug('[quantum-warpscript] _handleResponse',b.options),this.stack=b.stack,this._hasAResponse=!0,this._hasAnError=!1,this._warpscriptChangedAfterExecution=!1,this._lastSharedResponse='',this.$.response_container.responseChanged(),this.debug&&console.debug('[quantum-warpscript] _handleResponse',{stack:this.stack,elapsed:this.elapsed,_dataToPlot:this._dataToPlot}))}_handleError(a,b){this.debug&&console.debug('[quantum-warpscript] _handleError',b),b.errorLine&&b.errorMsg?(this.errorMsg='ERROR line #'+b.errorLine+': '+b.errorMsg,this.debug&&console.debug('[quantum-warpscript] _handleError',this.errorMsg)):b.request.xhr.responseText.match(/<pre>\s*(.*)\s*<\/prse>/)?this.errorMsg=b.request.xhr.responseText.match(/<pre>\s*(.*)\s*<\/prse>/)[1]:b.request.xhr.statusText&&''!==b.request.xhr.statusText?this.errorMsg=b.request.statusText:this.errorMsg='Unable to reach '+b.request.url,this.debug&&console.debug('[quantum-warpscript] _handleError',{error:b,errorMsg:this.errorMsg}),this.elapsed=b.elapsed,this._fetched=b.fetched,this._operations=b.operations,this._hasAResponse=!1,this._hasAnError=!0,this.debug&&console.debug('[quantum-warpscript] _handleError - _hasAResponse',this._hasAResponse)}editorChangeAction(a){this.warpscript=a.detail.value,this.debug&&console.debug('[quantum-warpscript] editorChangeAction',this.warpscript)}_handleShareCodeResponse(a,b){let c=looseJSON.parse(b.response)[1],d=looseJSON.parse(b.response)[0];console.debug('[quantum-warpscript] _handleShareCodeResponse',{snapshotId:c,snapshotSecret:d}),this._shareCodeError=null,this._lastSharedCode={snapshotId:c,snapshotSecret:d}}_handleShareCodeError(a,b){this.debug&&console.debug('[quantum-warpscript] _handleShareCodeError',b),this._lastSharedCode={},this._shareCodeError=b}_handleShareResponseResponse(a,b){let c=looseJSON.parse(b.response)[1],d=looseJSON.parse(b.response)[0];this.debug&&console.debug('[quantum-warpscript] _handleShareResponseResponse',b.response),this._shareResponseError=null,this._lastSharedResponse={snapshotId:c,snapshotSecret:d}}_handleShareResponseError(a,b){this.debug&&console.debug('[quantum-warpscript] _handleShareResponseError',b.response),this._lastSharedResponse={},this._shareResponseError=b}_inputFileRead(a,b){this.$.loadDialog.cancel(),this.debug&&console.debug('[quantum-warpscript] _fileChosen',a,b),this.warpscript=b}_dontBubble(a){this.debug&&console.debug('[quantum-warpscript] _dontBubble'),a.stopPropagation()}execute(){this.debug&&console.debug('[quantum-warpscript] Execute',this.warpscript),this.showPermalink&&this._updateLocation(),this.warpscriptScript=this.warpscript,this.$.warpscriptcaller.generateRequest()}viz(){this.debug&&console.debug('[quantum-warpscript] Viz',this.stack),this.stack.length&&this.dispatchEvent(new CustomEvent('plot',{detail:{warpscript:this.warpscript,stack:this.stack}}))}shareCode(){let a='// backend: '+JSON.stringify(this.backend)+'\n\n'+this.warpscript;this._codeToShare=`<% '${encodeURI(a).replace(/'/g,'%27').replace(/"/g,'%28').replace(/\+/g,'%2B')}' %> @orbit/snapshot/store`,this.$.shareCodeRequest.generateRequest()}shareResponse(){let a='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(a){let b=0|16*Math.random(),c='x'===a?b:8|3&b;return c.toString(16)});this._responseToShare=`<% SNAPSHOT 'snapshot' STORE
        '<%25 !$snapshot %25>' EVAL @orbit/snapshot/store STOP %>
        'STOP' DEF <% STOP %> '${a}' DEF ${this.warpscript} ${a}`,this.$.shareResponseRequest.generateRequest()}saveCollection(){this.$.saveDialog.cancel(),this.collectionWriter.open()}readCollection(){this.$.loadDialog.cancel(),this.collectionReader.open()}_openSaveDialog(){this.$.saveDialog.open()}_closeSaveDialog(){this.$.saveDialog.cancel()}_openLoadDialog(){this.$.loadDialog.open()}_closeLoadDialog(){this.$.loadDialog.cancel()}_updateLocation(){this.selected===this.application&&(this.debug&&console.debug('[quantum-warpscript] _updateLocation'),this.root.querySelector('quantum-permalink-generator').updateLocation(this.application))}_getInfoFromParams(){this.params.warpscript!==void 0&&'string'===typeof this.params.warpscript&&(this.warpscript===this.params.warpscript?this.debug&&console.debug('[quantum-warpscript] _getInfoFromParams - Warpscript didn\'t change'):(this.debug&&console.debug('[quantum-warpscript] _getInfoFromParams - Warpscript changed'),this.warpscript=this.params.warpscript)),this.params.stack!==void 0&&0<this.params.stack.length&&(this.stack=this.params.stack,this._hasAResponse=!0,this._hasAnError=!1,this._warpscriptChangedAfterExecution=!1,this._lastSharedResponse='',this.$.response_container.responseChanged()),this.params.backend!==void 0&&(this.backend=this.params.backend),this.showPermalink&&this._updateLocation()}_hotkeyExecute(a){let b=Polymer.dom(a.detail.keyboardEvent);this.debug&&console.debug('[quantum-warpscript] _hotkeyExec',b.rootTarget);let c=b.rootTarget.nodeName;'TEXTAREA'!==c&&'INPUT'!==c&&this.execute()}_hotkeyViz(a){let b=Polymer.dom(a.detail.keyboardEvent);this.debug&&console.debug('[quantum-warpscript] _hotkeyViz',b.rootTarget);let c=b.rootTarget.nodeName;'TEXTAREA'!==c&&'INPUT'!==c&&this.viz()}_hotkeyHelp(a){let b=Polymer.dom(a.detail.keyboardEvent);this.debug&&console.debug('[quantum-warpscript] _hotkeyHelp',b.rootTarget);let c;c=b.rootTarget?b.rootTarget.nodeName:'','TEXTAREA'!==c&&'INPUT'!==c&&(this.debug&&console.debug('[quantum-warpscript] _hotkeyHelp'),this.root.querySelector('#warpscript-ide-keyboard-shortcuts-overlay').opened?this.root.querySelector('#warpscript-ide-keyboard-shortcuts-overlay').close():this.root.querySelector('#warpscript-ide-keyboard-shortcuts-overlay').open())}}customElements.define(QuantumWarpscript.is,QuantumWarpscript);</script></dom-module></body></html>